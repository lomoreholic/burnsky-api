<!DOCTYPE html>
<html>
<head>
    <title>圖表調試</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        #testChart {
            width: 600px;
            height: 400px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1>圖表調試頁面</h1>
    <div id="status"></div>
    <canvas id="testChart"></canvas>

    <script>
        async function testChart() {
            const statusDiv = document.getElementById('status');
            
            try {
                // 測試 Chart.js 是否可用
                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.js 未載入');
                }
                statusDiv.innerHTML += '<p>✅ Chart.js 已載入</p>';
                
                // 測試 API
                const response = await fetch('/api/warning-dashboard-data');
                if (!response.ok) {
                    throw new Error(`API 錯誤: ${response.status}`);
                }
                statusDiv.innerHTML += '<p>✅ API 可用</p>';
                
                const data = await response.json();
                statusDiv.innerHTML += '<p>✅ 數據獲取成功</p>';
                statusDiv.innerHTML += `<p>月度數據條目: ${data.monthly_timeline.length}</p>`;
                
                // 測試圖表創建
                const ctx = document.getElementById('testChart').getContext('2d');
                
                const monthLabels = data.monthly_timeline.map(item => item.month);
                const totalData = data.monthly_timeline.map(item => item.total);
                const highData = data.monthly_timeline.map(item => item.high);
                
                statusDiv.innerHTML += `<p>標籤數據: ${monthLabels.join(', ')}</p>`;
                statusDiv.innerHTML += `<p>總數據: ${totalData.join(', ')}</p>`;
                statusDiv.innerHTML += `<p>高數據: ${highData.join(', ')}</p>`;
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: monthLabels,
                        datasets: [{
                            label: '警告數量',
                            data: totalData,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            fill: true,
                            tension: 0.4
                        }, {
                            label: '高嚴重度警告',
                            data: highData,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            fill: false,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                
                statusDiv.innerHTML += '<p>✅ 圖表創建成功</p>';
                
            } catch (error) {
                statusDiv.innerHTML += `<p>❌ 錯誤: ${error.message}</p>`;
                console.error('調試錯誤:', error);
            }
        }
        
        window.onload = testChart;
    </script>
</body>
</html>
