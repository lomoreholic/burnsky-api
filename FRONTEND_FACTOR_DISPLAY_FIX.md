# 前端詳細分析因子顯示修正

## 修正日期
2026年1月21日

## 問題
前端 index.html 中「詳細分析因子」顯示的最大分數與後端 unified_scorer.py 修正後的配置不一致。

---

## 修正前後對比

| 因子 | 前端顯示（錯誤） | 後端實際 | 修正後前端 | 狀態 |
|------|------------------|----------|------------|------|
| 時間 | 18分 | 18分 | 18分 | ✅ 已一致 |
| **溫度** | **18分** ❌ | 15分 | **15分** ✅ | 已修正 |
| **濕度** | **22分** ❌ | 20分 | **20分** ✅ | 已修正 |
| **能見度** | **18分** ❌ | 20分 | **20分** ✅ | 已修正 |
| **雲層** | **30分** ❌ | 35分 | **35分** ✅ | 已修正 |
| **UV** | **12分** ❌ | 2分 | **2分** ✅ | 已修正 |
| 風速 | 15分 | 15分 | 15分 | ✅ 已一致 |
| 空氣 | 15分 | 15分 | 15分 | ✅ 已一致 |
| **氣壓** | - | 10分 | - | ⚠️ 前端無顯示 |

---

## 詳細修正內容

### 1. 時間因子 ✅
**修正前說明：**
```
基於真實日出/日落時間評分，降低比重避免過度依賴時機：
黃金30分鐘內（18分）、1小時內（14分）、2小時內（10分）、其他時段（3分）
```

**修正後說明：**
```
基於真實日出/日落時間評分（12%權重）：
黃金30分鐘內（15-18分）、1小時內（12分）、2小時內（8分）、其他時段（4分）
```

**改善：** 更新了實際評分範圍，反映 advanced_predictor.py 的真實邏輯

---

### 2. 溫度因子 ✅
**修正前：**
- 最大分數：**18分** ❌
- 說明：理想溫度範圍25-32°C（18分），適合溫度20-35°C（12分）...

**修正後：**
- 最大分數：**15分** ✅
- 說明：影響燒天顏色飽和度（10%權重）：理想26-31°C（15分）、良好24-33°C（12分）、可接受20-35°C（7分）、邊緣15-38°C（3分）

**改善：**
- 分數與後端 unified_scorer.py 一致
- 溫度範圍更精確（26-31°C vs 25-32°C）
- 增加了因子權重說明（10%）

---

### 3. 濕度因子 ✅
**修正前：**
- 最大分數：**22分** ❌
- 說明：最佳濕度範圍50-70%（22分），良好範圍40-80%（16分）...

**修正後：**
- 最大分數：**20分** ✅
- 說明：影響大氣層顏色（13.3%權重）：理想55-70%（20分）、良好50-75%（16分）、可接受45-80%（12分）、邊緣40-85%（7分）、極端<40%或>85%（3分）

**改善：**
- 分數與後端一致
- 濕度範圍更精確（55-70% vs 50-70%）
- 增加了更多評分層級
- 增加了因子權重說明（13.3%）

---

### 4. 能見度因子 ✅
**修正前：**
- 最大分數：**18分** ❌
- 說明：基於降雨量與天氣警告評估：無降雨（18分）、少量降雨（14分）、中等降雨（9分）、大雨（4分），有警告扣5分

**修正後：**
- 最大分數：**20分** ✅
- 說明：影響拍攝清晰度（13.3%權重）：無降雨（20分）、極輕微<2mm（15分）、輕微<5mm（10分）、中度<10mm（6分）、大雨<20mm（3分）、暴雨≥20mm（1分）

**改善：**
- 分數與後端一致（權重從10%提高到13.3%）
- 移除了「天氣警告扣5分」說明（簡化）
- 增加了6個細分等級（原4個）
- 增加了因子權重說明（13.3%）

---

### 5. 雲層分析因子 ✅ **最關鍵修正**
**修正前：**
- 最大分數：**30分** ❌
- 說明：最關鍵因子！進階雲層類型分析：高空雲（卷雲、卷層雲）+12分，中低雲適量+10分，多雲有陽光+8分，少雲+6分，厚雲或雨雲扣分

**修正後：**
- 最大分數：**35分** ✅
- 說明：最關鍵因子（23.3%權重）！已修正邏輯：部分有陽光（35分）、短暫有陽光（32分）、大致多雲（28分）、多雲（25分）、大致天晴（18分）、密雲/陰天（12分）、天晴/晴朗（3分）❗️無雲=無燒天

**改善：**
- 分數與後端一致（權重從16.7%提高到23.3%）
- **完全重寫說明，反映已修正的雲層評分邏輯**
- 明確指出「無雲=無燒天」的關鍵概念
- 列出8個具體天氣描述及對應分數
- 移除了過時的「高空雲+12分」等舊邏輯

---

### 6. UV指數因子 ✅ **最大變化**
**修正前：**
- 最大分數：**12分** ❌
- 說明：UV強度評分：極高8+（12分）、高6-7（9分）、中等3-5（6分）、低0-2（2分），適中UV有利於大氣光學效果

**修正後：**
- 最大分數：**2分** ✅
- 說明：僅供參考（1.3%權重）：UV≥5（2分）、3-4（1.5分）、1-2（1分）、<1（0.5分）。UV不是燒天決定性因素，僅作為陽光強度參考

**改善：**
- 分數與後端一致（權重從6.7%大幅降至1.3%）
- 明確標示「僅供參考」
- 說明UV不是決定性因素
- 評分範圍縮小至0.5-2分

---

### 7. 風速因子 ✅
**前端顯示（正確）：**
- 最大分數：15分
- 說明：風速對燒天影響：無風/輕風（15分）、微風（11分）、和風（8分）、強風（5分）、烈風（1分）。適度風速有助雲層形態變化，過強會吹散雲層

**後端配置：**
- 最大分數：15分 ✅
- 評分邏輯：6-12km/h（15分）、4-16km/h（12分）、2-20km/h（9分）、≤25km/h（5分）、≤30km/h（2分）、>30km/h（1分）

**狀態：** 分數一致，說明合理

---

### 8. 空氣品質因子 ✅
**前端顯示（正確）：**
- 最大分數：15分
- 說明：空氣品質對燒天影響：AQHI 1-3（15分）空氣清澈透明、4-6（12分）一般品質、7-9（8分）污染影響色彩、10+（4分）嚴重污染大幅影響燒天品質

**後端配置：**
- 最大分數：15分 ✅
- 評分邏輯：≤3（15分）、≤6（12分）、≤7（8分）、≤10（5分）、>10（2分）

**狀態：** 分數一致，說明合理

---

### 9. 氣壓因子 ⚠️
**前端：** 無獨立顯示卡片
**後端：** 最大分數10分，預設3分

**說明：** 前端未單獨顯示氣壓因子，這是合理的，因為氣壓對燒天的影響相對較小（6.7%權重），且HKO API不提供氣壓數據。

---

## 修改文件

### templates/index.html
**行號：** 1937-1978

**修改次數：** 6處

1. 時間因子說明更新
2. 溫度因子：18分 → 15分，說明更新
3. 濕度因子：22分 → 20分，說明更新
4. 能見度因子：18分 → 20分，說明更新
5. 雲層因子：30分 → 35分，說明完全重寫
6. UV因子：12分 → 2分，說明更新

---

## 影響範圍

### 用戶端顯示
✅ 所有「詳細分析因子」卡片的最大分數現已正確
✅ 因子說明更準確反映實際評分邏輯
✅ 增加了權重百分比說明，更易理解

### 開發者端
✅ 前後端數據一致性
✅ 減少用戶困惑（為何顯示18分卻只得15分？）
✅ 文檔與代碼同步

---

## 驗證步驟

1. ✅ 檢查 unified_scorer.py 的 factor_max_scores 配置
2. ✅ 對比 index.html 的 factorNames 配置
3. ✅ 逐項修正所有不一致的地方
4. ✅ 更新所有說明文字
5. ⏳ 重啟服務器測試前端顯示

---

## 總結

### 修正完成度：✅ 100%
- 6個因子分數錯誤 → 全部修正
- 所有說明文字更新
- 增加權重百分比顯示

### 關鍵改善：
1. **雲層因子**：說明完全重寫，反映已修正的邏輯（無雲=低分）
2. **UV因子**：權重大幅降低，明確標示「僅供參考」
3. **能見度因子**：權重提高，細分為6個等級
4. **所有因子**：增加權重百分比說明（如「23.3%權重」）

### 用戶體驗提升：
- 前端顯示與後端評分完全一致
- 說明更清晰易懂
- 避免「為何顯示30分卻只得到35分」的困惑

---

**修正前後對比總表：**

```
因子        前端    後端    修正    權重變化
時間        18  →   18  →   18      16.7% → 12%
溫度        18  →   15  →   15      維持 10%
濕度        22  →   20  →   20      維持 13.3%
能見度      18  →   20  →   20      10% → 13.3%
雲層        30  →   35  →   35      16.7% → 23.3% ⭐
UV          12  →   2   →   2       6.7% → 1.3% ⭐
風速        15  →   15  →   15      維持 10%
空氣        15  →   15  →   15      維持 10%
氣壓        -   →   10  →   -       維持 6.7%
───────────────────────────────────────
總計       148      150     148     (差2分為氣壓，前端不顯示)
```

⭐ = 重大變化
