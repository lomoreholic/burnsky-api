# 前後端一致性驗證報告

## 如何驗證前後端一致

### 方法1: 查看代碼配置 ✅

#### 後端配置位置
**檔案**: `unified_scorer.py`  
**行號**: 29-41

```python
'factor_max_scores': {
    'time': 18,           # 時間因子 (12%)
    'temperature': 15,    # 溫度因子 (10%)
    'humidity': 20,       # 濕度因子 (13.3%)
    'visibility': 20,     # 能見度因子 (13.3%) ⬆️
    'cloud': 35,          # 雲層因子 (23.3%) ⬆️最重要
    'pressure': 10,       # 氣壓因子 (6.7%)
    'uv': 2,              # UV指數因子 (1.3%) ⬇️
    'wind': 15,           # 風速因子 (10%)
    'air_quality': 15     # 空氣品質因子 (10%)
}
```

#### 前端配置位置
**檔案**: `templates/index.html`  
**行號**: 1937-1978

```javascript
const factorNames = {
    'time_factor': { maxScore: 18 },              // ✅ 一致
    'temperature_factor': { maxScore: 15 },       // ✅ 一致
    'humidity_factor': { maxScore: 20 },          // ✅ 一致
    'visibility_factor': { maxScore: 20 },        // ✅ 一致
    'cloud_analysis_factor': { maxScore: 35 },    // ✅ 一致
    'uv_factor': { maxScore: 2 },                 // ✅ 一致
    'wind_factor': { maxScore: 15 },              // ✅ 一致
    'air_quality_factor': { maxScore: 15 }        // ✅ 一致
};
```

---

### 方法2: 啟動服務器實際查看 🌐

#### 步驟:
```bash
# 1. 啟動開發伺服器
cd /Users/chuntokennethkwong/Documents/燒天/burnsky-api-1
python3 run_dev.py

# 2. 打開瀏覽器
open http://localhost:5001

# 3. 在首頁向下滾動到「📊 詳細分析因子」區塊

# 4. 查看每個因子卡片右上角的分數顯示
```

#### 你會看到:
```
📊 詳細分析因子
─────────────────────────────────────

[🌅 實時時間因子]        [15/18分]  ← 18是最大分數
[🌡️ 溫度因子]           [12/15分]  ← 15是最大分數
[💧 濕度因子]           [16/20分]  ← 20是最大分數
[👁️ 能見度因子]        [20/20分]  ← 20是最大分數
[☁️ 雲層分析因子]       [35/35分]  ← 35是最大分數 ⭐
[☀️ UV指數因子]         [2/2分]    ← 2是最大分數 ⭐
[💨 風速因子]           [12/15分]  ← 15是最大分數
[🌫️ 空氣品質因子]      [15/15分]  ← 15是最大分數
```

---

### 方法3: 查看 API 響應 🔍

```bash
# 發送API請求
curl http://localhost:5001/api/burnsky-prediction/sunset/2 | python3 -m json.tool

# 查看返回的 factors 欄位
{
  "factors": {
    "time_factor": {
      "score": 15,
      "max_score": 18,    ← 確認這裡是18
      ...
    },
    "cloud_analysis_factor": {
      "score": 35,
      "max_score": 35,    ← 確認這裡是35
      ...
    },
    "uv_factor": {
      "score": 2,
      "max_score": 2,     ← 確認這裡是2
      ...
    }
  }
}
```

---

## 對比表格

| 因子 | 後端 (unified_scorer.py) | 前端 (index.html) | API響應 | 狀態 |
|------|-------------------------|-------------------|---------|------|
| 時間 | 18分 (line 32) | 18分 (line 1939) | max_score: 18 | ✅ |
| 溫度 | 15分 (line 33) | 15分 (line 1943) | max_score: 15 | ✅ |
| 濕度 | 20分 (line 34) | 20分 (line 1948) | max_score: 20 | ✅ |
| 能見度 | 20分 (line 35) | 20分 (line 1953) | max_score: 20 | ✅ |
| **雲層** | **35分** (line 36) | **35分** (line 1958) | max_score: 35 | ✅ ⭐ |
| 氣壓 | 10分 (line 37) | (不顯示) | max_score: 10 | ⚠️ |
| **UV** | **2分** (line 38) | **2分** (line 1963) | max_score: 2 | ✅ ⭐ |
| 風速 | 15分 (line 39) | 15分 (line 1968) | max_score: 15 | ✅ |
| 空氣 | 15分 (line 40) | 15分 (line 1973) | max_score: 15 | ✅ |

---

## 關鍵修正點

### 1. 雲層因子 (最重要) ⭐
- **修正前**: 25分 (16.7%)
- **修正後**: 35分 (23.3%)
- **提高**: +10分 (+40%)
- **說明**: 雲層是燒天最關鍵因素，提高權重

### 2. UV因子 (大幅降低) ⭐
- **修正前**: 10分 (6.7%)
- **修正後**: 2分 (1.3%)
- **降低**: -8分 (-80%)
- **說明**: UV對燒天影響極小，僅作參考

### 3. 能見度因子 (提高)
- **修正前**: 15分 (10%)
- **修正後**: 20分 (13.3%)
- **提高**: +5分 (+33%)
- **說明**: 能見度影響拍攝品質

### 4. 時間因子 (降低)
- **修正前**: 25分 (16.7%)
- **修正後**: 18分 (12%)
- **降低**: -7分 (-28%)
- **說明**: 時間重要但非決定性

---

## 實際案例演示

### 場景1: 晴空萬里（無雲）

**修正前評分:**
```
雲層: 25/25分 (滿分) ❌ 錯誤！
總分: 145/150 (97%)
```

**修正後評分:**
```
雲層: 3/35分  (8.6%) ✅ 正確！
總分: 104/150 (69%)
```

### 場景2: 理想燒天（多雲有陽光）

**修正前評分:**
```
雲層: 20/25分 (80%)
總分: 130/150 (87%)
```

**修正後評分:**
```
雲層: 35/35分 (滿分) ✅ 正確！
總分: 137/150 (91%)
```

---

## 驗證命令

```bash
# 快速驗證
cd /Users/chuntokennethkwong/Documents/燒天/burnsky-api-1

# 1. 檢查後端配置
grep -A 10 "factor_max_scores" unified_scorer.py

# 2. 檢查前端配置
grep -A 30 "const factorNames" templates/index.html

# 3. 啟動並測試
python3 run_dev.py &
sleep 5
curl -s http://localhost:5001/api/burnsky-prediction/sunset/2 | \
  python3 -c "import sys,json; d=json.load(sys.stdin); \
  print('時間:', d['factors']['time_factor']['max_score']); \
  print('雲層:', d['factors']['cloud_analysis_factor']['max_score']); \
  print('UV:', d['factors']['uv_factor']['max_score'])"
```

---

## 結論

✅ **前後端配置已完全同步**

- 所有8個顯示因子的最大分數在前後端完全一致
- API響應的 max_score 與前端顯示一致
- 用戶看到的分數與後端計算邏輯完全匹配

🎯 **修正效果**

- 雲層權重提高40%，正確反映其重要性
- UV權重降低80%，避免過度影響
- 總分配置更科學合理
- 評分系統更準確反映燒天機率

📊 **如何持續驗證**

1. 每次修改後端配置後，同步更新前端 `factorNames`
2. 啟動服務器實際查看首頁顯示
3. 檢查API響應的 `max_score` 欄位
4. 對比「X/Y分」中的Y值是否符合預期
