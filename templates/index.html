<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO åŸºæœ¬æ¨™ç±¤ -->
    <title>ç‡’å¤©é æ¸¬ç³»çµ± | é¦™æ¸¯æ—¥è½ç«ç‡’é›²é æ¸¬ | BurnSky AI äººå·¥æ™ºèƒ½å¤©æ°£åˆ†æ</title>
    <meta name="description" content="é¦™æ¸¯æœ€ç²¾æº–çš„ç‡’å¤©é æ¸¬ç³»çµ±ï¼çµåˆAIäººå·¥æ™ºèƒ½èˆ‡æ°£è±¡æ•¸æ“šï¼Œå¯¦æ™‚é æ¸¬æ—¥è½ç«ç‡’é›²æ©Ÿç‡ã€‚æä¾›è©³ç´°åˆ†æå› å­ã€å¤©æ°£æ•¸æ“šå’Œæ‹æ”å»ºè­°ï¼Œæ˜¯æ”å½±æ„›å¥½è€…çš„å¿…å‚™å·¥å…·ã€‚æ”¯æ´ç¶­æ¸¯ã€å¤ªå¹³å±±é ‚ç­‰æœ€ä½³æ‹æ”åœ°é»æ¨è–¦ã€‚">
    <meta name="keywords" content="ç‡’å¤©é æ¸¬,ç«ç‡’é›²,æ—¥è½,é¦™æ¸¯å¤©æ°£,æ”å½±,å¤©ç©º,é›²å±¤åˆ†æ,AIé æ¸¬,äººå·¥æ™ºèƒ½,å¤©æ°£é å ±,BurnSky,ç¶­æ¸¯æ—¥è½,å¤ªå¹³å±±ç‡’å¤©,é¦™æ¸¯ç‡’å¤©æ™‚é–“,ç«ç‡’é›²é æ¸¬app,å¯¦æ™‚å¤©æ°£é æ¸¬,æ”å½±å¤©æ°£,æ—¥è½æ”å½±,é¦™æ¸¯æ”å½±åœ°é»,å¤©æ°£åˆ†æ,ç‡’å¤©æ©Ÿç‡">
    <meta name="author" content="BurnSky Team">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="language" content="zh-TW">
    <meta name="revisit-after" content="1 days">
    <meta name="rating" content="general">
    <meta name="distribution" content="global">
    <meta name="geo.region" content="HK">
    <meta name="geo.placename" content="Hong Kong">
    <meta name="geo.position" content="22.3193;114.1694">
    <meta name="ICBM" content="22.3193, 114.1694">
    
    <!-- Open Graph ç¤¾äº¤åª’é«”æ¨™ç±¤ -->
    <meta property="og:title" content="ç‡’å¤©é æ¸¬ç³»çµ± | é¦™æ¸¯æ—¥è½ç«ç‡’é›²AIé æ¸¬">
    <meta property="og:description" content="é¦™æ¸¯æœ€ç²¾æº–çš„ç‡’å¤©é æ¸¬ç³»çµ±ï¼çµåˆAIèˆ‡æ°£è±¡æ•¸æ“šï¼Œå¯¦æ™‚é æ¸¬æ—¥è½ç«ç‡’é›²æ©Ÿç‡ï¼Œæä¾›å°ˆæ¥­æ‹æ”å»ºè­°ã€‚">
    <meta property="og:image" content="https://burnsky-api.onrender.com/static/burnsky-og-image.jpg">
    <meta property="og:url" content="https://burnsky-api.onrender.com">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="BurnSky ç‡’å¤©é æ¸¬ç³»çµ±">
    <meta property="og:locale" content="zh_TW">
    
    <!-- Twitter Card æ¨™ç±¤ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ç‡’å¤©é æ¸¬ç³»çµ± | é¦™æ¸¯æ—¥è½ç«ç‡’é›²AIé æ¸¬">
    <meta name="twitter:description" content="é¦™æ¸¯æœ€ç²¾æº–çš„ç‡’å¤©é æ¸¬ç³»çµ±ï¼çµåˆAIèˆ‡æ°£è±¡æ•¸æ“šï¼Œå¯¦æ™‚é æ¸¬æ—¥è½ç«ç‡’é›²æ©Ÿç‡ã€‚">
    <meta name="twitter:image" content="https://burnsky-api.onrender.com/static/burnsky-og-image.jpg">
    <meta name="twitter:site" content="@BurnSkyHK">
    
    <!-- ç¶²ç«™é©—è­‰æ¨™ç±¤ -->
    <meta name="google-site-verification" content="8nMW3lXIw2vxGw9fqBBcJV27fZQBPLjKnKVZyVVFzJs">
    <meta name="google-adsense-account" content="ca-pub-3552699426860096">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3552699426860096"
         crossorigin="anonymous"></script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4KLPHLD5EQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-4KLPHLD5EQ');
    </script>
    
    <!-- çµæ§‹åŒ–æ•¸æ“š - JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "BurnSky ç‡’å¤©é æ¸¬ç³»çµ±",
        "description": "é¦™æ¸¯æœ€ç²¾æº–çš„ç‡’å¤©é æ¸¬ç³»çµ±ï¼ŒçµåˆAIäººå·¥æ™ºèƒ½èˆ‡æ°£è±¡æ•¸æ“šï¼Œå¯¦æ™‚é æ¸¬æ—¥è½ç«ç‡’é›²æ©Ÿç‡",
        "url": "https://burnsky-api.onrender.com",
        "applicationCategory": "Weather Application",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "HKD"
        },
        "creator": {
            "@type": "Organization",
            "name": "BurnSky Team",
            "url": "https://burnsky-api.onrender.com"
        },
        "keywords": "ç‡’å¤©é æ¸¬,ç«ç‡’é›²,æ—¥è½,é¦™æ¸¯å¤©æ°£,æ”å½±,AIé æ¸¬",
        "inLanguage": "zh-TW",
        "isAccessibleForFree": true,
        "potentialAction": {
            "@type": "UseAction",
            "target": "https://burnsky-api.onrender.com"
        }
    }
    </script>
    
    <!-- FAQ çµæ§‹åŒ–æ•¸æ“š -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "ä»€éº¼æ˜¯ç‡’å¤©ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "ç‡’å¤©æ˜¯æŒ‡æ—¥å‡ºæˆ–æ—¥è½æ™‚å¤©ç©ºå‘ˆç¾æ©™ç´…è‰²ç«ç‡’èˆ¬è‰²å½©çš„å¤©æ°£ç¾è±¡ï¼Œé€šå¸¸ç™¼ç”Ÿåœ¨ç‰¹å®šçš„å¤§æ°£æ¢ä»¶ä¸‹ï¼Œæ˜¯æ”å½±æ„›å¥½è€…æœ€å–œæ„›çš„è‡ªç„¶æ™¯è§€ä¹‹ä¸€ã€‚"
                }
            },
            {
                "@type": "Question", 
                "name": "ç‡’å¤©é æ¸¬çš„æº–ç¢ºç‡å¦‚ä½•ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "æˆ‘å€‘çš„AIé æ¸¬ç³»çµ±çµåˆé¦™æ¸¯å¤©æ–‡å°æ•¸æ“šå’Œæ©Ÿå™¨å­¸ç¿’ç®—æ³•ï¼Œæº–ç¢ºç‡ç´„é”85%ã€‚é æ¸¬æœƒè€ƒæ…®é›²å±¤åšåº¦ã€æ¿•åº¦ã€é¢¨é€Ÿã€ç©ºæ°£å“è³ªç­‰å¤šé …å› ç´ ã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "æœ€ä½³çš„ç‡’å¤©æ‹æ”åœ°é»åœ¨å“ªè£¡ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "é¦™æ¸¯æœ€ä½³ç‡’å¤©æ‹æ”åœ°é»åŒ…æ‹¬ç¶­å¤šåˆ©äºæ¸¯ã€å¤ªå¹³å±±é ‚ã€çŸ³æ¾³ã€ç…å­å±±ç­‰ã€‚ä¸åŒåœ°é»é©åˆä¸åŒæ™‚é–“ï¼Œç³»çµ±æœƒæ ¹æ“šç•¶æ—¥æ¢ä»¶æ¨è–¦æœ€ä½³æ‹æ”ä½ç½®ã€‚"
                }
            },
            {
                "@type": "Question",
                "name": "å¦‚ä½•çŸ¥é“ä»Šå¤©æœƒä¸æœƒæœ‰ç‡’å¤©ï¼Ÿ",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "ä½¿ç”¨æˆ‘å€‘çš„ç‡’å¤©é æ¸¬ç³»çµ±ï¼Œè¼¸å…¥ç¶²å€å³å¯çœ‹åˆ°ç•¶æ—¥çš„ç‡’å¤©æ©Ÿç‡è©•åˆ†ã€é æ¸¬ç­‰ç´šå’Œè©³ç´°åˆ†æã€‚ç³»çµ±æ¯å°æ™‚æ›´æ–°æ•¸æ“šï¼Œæä¾›æœ€å³æ™‚çš„é æ¸¬ã€‚"
                }
            }
        ]
    }
    </script>
    
    <!-- æœ¬åœ°å•†æ¥­çµæ§‹åŒ–æ•¸æ“š -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "BurnSky ç‡’å¤©é æ¸¬ç³»çµ±",
        "description": "é¦™æ¸¯å°ˆæ¥­ç‡’å¤©é æ¸¬æœå‹™ï¼Œç‚ºæ”å½±æ„›å¥½è€…æä¾›ç²¾æº–çš„ç«ç‡’é›²é æ¸¬",
        "url": "https://burnsky-api.onrender.com",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "é¦™æ¸¯",
            "addressRegion": "Hong Kong",
            "addressCountry": "HK"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": "22.3193",
            "longitude": "114.1694"
        },
        "areaServed": {
            "@type": "Place",
            "name": "é¦™æ¸¯"
        },
        "serviceType": "å¤©æ°£é æ¸¬æœå‹™",
        "priceRange": "å…è²»"
    }
    </script>
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://burnsky-api.onrender.com">
    
    <!-- ç¶²ç«™åœ–æ¨™ -->
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
    
    <!-- é è¼‰å…¥é‡è¦è³‡æº -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        /* Toast é€šçŸ¥æ¨£å¼ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }

        .toast {
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            border-left: 4px solid;
            min-width: 280px;
        }

        .toast.error { border-left-color: #ff6b6b; }
        .toast.success { border-left-color: #51cf66; }
        .toast.info { border-left-color: #339af0; }
        .toast.warning { border-left-color: #feca57; }

        .toast-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
            color: #333;
        }

        .toast-message {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
        }

        .toast-close {
            cursor: pointer;
            font-size: 1.2rem;
            color: #999;
            transition: color 0.2s;
            flex-shrink: 0;
        }

        .toast-close:hover {
            color: #333;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .toast.hiding {
            animation: slideOutRight 0.3s ease-out forwards;
        }

        @media (max-width: 768px) {
            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .toast {
                min-width: auto;
            }
        }

        /* å…¨å±€è¼‰å…¥æŒ‡ç¤ºå™¨ */
        .global-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .global-loading-overlay.active {
            display: flex;
        }

        .global-loading-content {
            background: white;
            border-radius: 16px;
            padding: 30px 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1rem;
            color: #666;
            margin-top: 10px;
        }

        .loading-progress {
            font-size: 0.85rem;
            color: #999;
            margin-top: 8px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        @media (max-width: 1240px) {
            .container {
                max-width: calc(100% - 40px);
                margin: 0 auto;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
                max-width: calc(100% - 20px);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        /* æ‰‹æ©Ÿç‰ˆæ¨™é¡Œç²¾ç°¡ */
        @media (max-width: 768px) {
            .header {
                margin-bottom: 20px;
                padding: 0 10px;
            }
            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 6px;
            }
            .header p {
                font-size: 0.9rem;
                margin-bottom: 0;
            }
            #currentTime {
                font-size: 0.85rem !important;
                margin-top: 8px !important;
            }
        }

        .main-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            margin: 0 auto 30px auto;
            border: 1px solid rgba(255,255,255,0.2);
            width: 100%;
            max-width: 900px;
            box-sizing: border-box;
        }

        @media (max-width: 768px) {
            .main-card {
                padding: 16px;
                border-radius: 16px;
                max-width: 100%;
                margin-bottom: 16px;
            }
        }

        .prediction-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .score-display {
            position: relative;
            display: inline-block;
            margin-bottom: 30px;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #ff6b6b 0%, #feca57 25%, #48dbfb 50%, #0abde3 75%, #ff6b6b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
        }

        /* æ‰‹æ©Ÿç‰ˆè©•åˆ†åœ“åœˆç¸®å° */
        @media (max-width: 768px) {
            .prediction-section {
                margin-bottom: 20px;
            }
            .score-display {
                margin-bottom: 16px;
            }
            .score-circle {
                width: 140px;
                height: 140px;
            }
            .score-inner {
                width: 110px !important;
                height: 110px !important;
            }
            .score-number {
                font-size: 2rem !important;
            }
            .score-label {
                font-size: 0.75rem !important;
            }
        }

        .score-inner {
            width: 160px;
            height: 160px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 4px 20px rgba(0,0,0,0.1);
        }

        .score-number {
            font-size: 3rem;
            font-weight: bold;
            color: #333;
            line-height: 1;
        }

        .score-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .prediction-level {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 15px;
            padding: 15px 30px;
            border-radius: 15px;
            display: inline-block;
        }

        /* æ‰‹æ©Ÿç‰ˆé æ¸¬ç­‰ç´šç²¾ç°¡ */
        @media (max-width: 768px) {
            .prediction-level {
                font-size: 1.2rem;
                padding: 10px 20px;
                margin-bottom: 10px;
                border-radius: 12px;
            }
        }

        .level-high { background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: white; }
        .level-medium { background: linear-gradient(45deg, #feca57, #ff9ff3); color: white; }
        .level-low { background: linear-gradient(45deg, #48dbfb, #0abde3); color: white; }

        .probability {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .probability {
                font-size: 1rem;
                margin-bottom: 12px;
            }
        }

        .refresh-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        /* åªåœ¨éè§¸æ§è¨­å‚™ä¸Šå•Ÿç”¨ hover æ•ˆæœ */
        @media (hover: hover) and (pointer: fine) {
            .refresh-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            }
        }

        /* æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•å„ªåŒ– */
        @media (max-width: 768px) {
            .refresh-btn {
                padding: 12px 25px;
                font-size: 1rem;
                width: 100%;
                max-width: 200px;
            }
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 0;
            width: 100%;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        /* ç¸®æ”¾æ§åˆ¶æ¨£å¼ */
        .toggle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 5px 0;
            border-radius: 8px;
            transition: background-color 0.2s ease;
        }

        .toggle-header:hover {
            background-color: rgba(102, 126, 234, 0.05);
        }

        .toggle-icon {
            font-size: 1.2rem;
            color: #667eea;
            transition: transform 0.3s ease;
            user-select: none;
        }

        @media (max-width: 768px) {
            .analysis-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                margin: 0;
                padding: 0;
            }
        }

        .factor-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        /* åªåœ¨éè§¸æ§è¨­å‚™ä¸Šå•Ÿç”¨ hover æ•ˆæœ */
        @media (hover: hover) and (pointer: fine) {
            .factor-card {
                cursor: pointer;
            }
            
            .factor-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            }
            
            .factor-card:hover .factor-description {
                opacity: 1;
                max-height: 600px; /* é€²ä¸€æ­¥å¢åŠ é«˜åº¦ */
                transform: translateY(0);
                padding-top: 10px; /* å¢åŠ é ‚éƒ¨é–“è· */
            }
        }

        /* æ‰‹æ©Ÿç‰ˆé»æ“Šåˆ‡æ›åŠŸèƒ½ */
        @media (max-width: 768px) {
            .factor-card {
                cursor: pointer;
                position: relative;
            }
            
            .factor-card::after {
                content: 'ğŸ‘† é»æ“ŠæŸ¥çœ‹è©³æƒ…';
                position: absolute;
                bottom: 10px;
                right: 15px;
                font-size: 0.7rem;
                color: #999;
                opacity: 0.8;
            }
            
            .factor-card.expanded::after {
                content: 'ğŸ‘† é»æ“Šæ”¶èµ·';
            }
            
            .factor-card.expanded .factor-description {
                opacity: 1 !important;
                max-height: none !important;
                transform: translateY(0) !important;
                margin-top: 15px;
            }
        }

        .factor-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .factor-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .factor-score {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* é›²å±¤åšåº¦åˆ†æå¡ç‰‡ç‰¹æ®Šæ¨£å¼ */
        .cloud-analysis-card .factor-description {
            font-size: 0.9rem; /* ç¨å¾®ç¸®å°å­—é«” */
            line-height: 1.5; /* ç·Šæ¹Šè¡Œè· */
        }
        
        @media (hover: hover) and (pointer: fine) {
            .cloud-analysis-card:hover .factor-description {
                max-height: 800px; /* é›²å±¤åˆ†æå¡ç‰‡å°ˆç”¨çš„æ›´å¤§é«˜åº¦ */
            }
        }

        .factor-description {
            color: #666;
            line-height: 1.6;
            font-size: 0.95rem;
            opacity: 0;
            max-height: 0;
            transform: translateY(-10px);
            transition: opacity 0.4s ease, max-height 0.4s ease, transform 0.4s ease; /* å¢åŠ éæ¸¡æ™‚é–“ */
            overflow: hidden;
        }

        .summary-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .summary-section {
                padding: 16px;
                border-radius: 14px;
                margin-top: 16px;
            }
        }

        .summary-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 18px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .summary-title {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }
        }

        .summary-item {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 8px;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .summary-item {
                padding: 10px 12px;
                font-size: 0.85rem;
                border-radius: 10px;
                margin-bottom: 6px;
            }
        }

        .weather-section {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .weather-section {
                padding: 16px;
                border-radius: 14px;
                margin-top: 16px;
            }
        }

        .weather-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .weather-title {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }
        }

        .weather-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            max-width: 900px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .weather-data {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }

        .weather-card {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        @media (max-width: 768px) {
            .weather-card {
                padding: 12px 8px;
                border-radius: 12px;
            }
        }

        /* åªåœ¨éè§¸æ§è¨­å‚™ä¸Šå•Ÿç”¨ hover æ•ˆæœ */
        @media (hover: hover) and (pointer: fine) {
            .weather-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 12px 40px rgba(0,0,0,0.2);
            }
        }

        /* æ‰‹æ©Ÿç‰ˆå¤©æ°£å¡ç‰‡é»æ“Šæ•ˆæœ */
        @media (max-width: 768px) {
            .weather-card {
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .weather-card:active {
                transform: scale(0.98);
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }
        }

        .weather-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .weather-icon {
                font-size: 1.6rem;
                margin-bottom: 6px;
            }
        }

        .weather-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .weather-value {
                font-size: 1.2rem;
                margin-bottom: 4px;
            }
        }

        .weather-label {
            color: #666;
            font-size: 0.95rem;
            font-weight: 500;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .weather-label {
                font-size: 0.75rem;
                line-height: 1.2;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .loading {
                padding: 24px;
            }
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @media (max-width: 768px) {
            .spinner {
                width: 36px;
                height: 36px;
                border-width: 3px;
                margin-bottom: 12px;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 20px;
        }

        /* ğŸ”¥ ç‡’å¤©é€²åº¦æ¢æ¨£å¼ */
        .burnsky-progress-container {
            padding: 20px;
            background: linear-gradient(135deg, rgba(102,126,234,0.05) 0%, rgba(118,75,162,0.05) 100%);
            border-radius: 16px;
            border: 1px solid rgba(102,126,234,0.1);
        }
        
        @media (max-width: 768px) {
            .burnsky-progress-container {
                padding: 14px;
                border-radius: 12px;
            }
            .burnsky-progress-container .progress-score-display span:first-child {
                font-size: 2.8rem !important;
            }
            .progress-bar-wrapper {
                height: 20px !important;
            }
        }
        
        .progress-bar-fill {
            background-size: 200% 100%;
            animation: progressShimmer 2s ease-in-out infinite;
        }
        
        @keyframes progressShimmer {
            0%, 100% { background-position: 0% 0%; }
            50% { background-position: 100% 0%; }
        }
        
        /* é€²åº¦æ¢å‹•æ…‹ç™¼å…‰æ•ˆæœ */
        .progress-glow {
            animation: progressGlow 1.5s ease-in-out infinite;
        }
        
        @keyframes progressGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(255,107,107,0.3); }
            50% { box-shadow: 0 0 15px rgba(255,107,107,0.6); }
        }

        /* ğŸ“· Webcam é è¦½å€åŸŸæ¨£å¼ */
        .webcam-preview-section {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            border-radius: 16px;
            padding: 16px;
        }
        
        @media (max-width: 768px) {
            .webcam-preview-section {
                padding: 12px;
                border-radius: 12px;
            }
        }
        
        .webcam-preview-container {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 8px;
        }
        
        .webcam-preview-container::-webkit-scrollbar {
            height: 4px;
        }
        
        .webcam-preview-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }
        
        .webcam-preview-container::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }
        
        .webcam-preview-card {
            flex: 0 0 auto;
            width: 180px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            overflow: hidden;
            scroll-snap-align: start;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        @media (max-width: 768px) {
            .webcam-preview-card {
                width: 150px;
            }
        }
        
        .webcam-preview-card:active {
            transform: scale(0.98);
        }
        
        .webcam-preview-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            background: #1a1a1a;
        }
        
        @media (max-width: 768px) {
            .webcam-preview-img {
                height: 85px;
            }
        }
        
        .webcam-preview-info {
            padding: 8px 10px;
            color: white;
        }
        
        .webcam-preview-name {
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .webcam-preview-score {
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 2px;
        }
        
        .webcam-score-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            margin-left: 4px;
        }

        /* ç‡’å¤©æŒ‡æ•¸å°ç…§è¡¨å‹•ç•« */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 6px 20px rgba(255,255,255,0.3), 0 0 0 3px rgba(255,255,255,0.5);
            }
            50% {
                box-shadow: 0 8px 25px rgba(255,255,255,0.4), 0 0 0 5px rgba(255,255,255,0.7);
            }
            100% {
                box-shadow: 0 6px 20px rgba(255,255,255,0.3), 0 0 0 3px rgba(255,255,255,0.5);
            }
        }

        .score-reference-header:hover {
            background: linear-gradient(45deg, #7c8ff0, #8b5aa8) !important;
        }

        .score-reference-header:hover div {
            left: 100% !important;
        }

        /* æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media (max-width: 768px) {
            .score-range-item {
                font-size: 0.85rem !important;
            }
            
            .score-range-item div {
                min-width: 50px !important;
            }
            
            .score-reference-card {
                max-width: 100% !important;
                margin: 15px auto !important;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .header p {
                font-size: 1.1rem;
                margin-bottom: 20px;
            }
            
            .main-card {
                padding: 25px;
                border-radius: 16px;
                max-width: 100%;
            }
            
            .score-circle {
                width: 150px;
                height: 150px;
            }
            
            .score-inner {
                width: 120px;
                height: 120px;
            }
            
            .score-number {
                font-size: 2.2rem;
            }
            
            .prediction-level {
                font-size: 1.5rem;
                padding: 12px 20px;
            }
            
            .refresh-btn {
                padding: 12px 25px;
                font-size: 1rem;
                width: 100%;
                max-width: 200px;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                margin: 0;
                padding: 0;
            }
            
            .weather-data {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }
        }

        /* è­¦å‘Šæ­·å²åˆ†ææ¨£å¼ */
        .toggle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 10px 0;
            border-bottom: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .toggle-header:hover {
            border-bottom-color: #667eea;
        }

        .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }

        .tab-navigation {
            border-bottom: 2px solid #e9ecef;
        }

        .tab-btn {
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: #667eea !important;
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-btn.active {
            color: #667eea !important;
            border-bottom-color: #667eea !important;
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-content {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .warning-overview-grid {
            margin-bottom: 25px;
        }

        .warning-summary-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .warning-summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .chart-container {
            transition: transform 0.2s ease;
        }

        .chart-container:hover {
            transform: translateY(-1px);
        }

        .accuracy-metrics {
            margin-bottom: 25px;
        }

        .metric-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .insight-card {
            transition: transform 0.2s ease;
        }

        .insight-card:hover {
            transform: translateY(-1px);
        }

        /* æ‰‹æ©Ÿç‰ˆè­¦å‘Šåˆ†æèª¿æ•´ */
        @media (max-width: 768px) {
            .tab-navigation {
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            .tab-btn {
                min-width: 120px;
                flex-shrink: 0;
            }

            .warning-overview-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .accuracy-metrics {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .chart-container {
                padding: 15px;
            }

            #warningTimelineChart,
            #warningCategoryChart,
            #seasonalChart,
            #accuracyChart {
                min-height: 250px;
            }
        }

        /* è­¦å‘Šé …ç›®æ¨£å¼ */
        .warning-item {
            margin-bottom: 12px;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
        }

        .warning-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 8px;
        }

        .warning-impacts,
        .warning-adjustments {
            margin: 8px 0;
            padding: 8px 12px;
            border-radius: 6px;
        }

        .warnings-summary-header {
            margin-bottom: 15px;
        }

        .warnings-summary {
            margin-top: 15px;
        }

        /* å‹•ç•«æ•ˆæœ */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* ç…§ç‰‡ä¸Šå‚³å€åŸŸæ¨£å¼ */
        #photoUploadForm input[type="file"] {
            transition: border-color 0.3s ease;
        }
        
        #photoUploadForm input[type="file"]:hover {
            border-color: #667eea;
        }
        
        #photoUploadForm input[type="file"]:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        #photoUploadForm input[type="range"] {
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
        }
        
        #photoUploadForm input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #photoUploadForm input[type="range"]::-webkit-slider-thumb:hover {
            background: #5a6fd8;
            transform: scale(1.1);
        }
        
        #photoUploadForm input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        /* è¡¨å–®é©—è­‰æ¨£å¼ */
        .form-error {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1) !important;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆæ”¹é€² */
        @media (max-width: 768px) {
            #photoUploadForm {
                padding: 15px;
            }
            
            #photoUploadForm input,
            #photoUploadForm textarea,
            #photoUploadForm button {
                font-size: 16px; /* é˜²æ­¢iOSç¸®æ”¾ */
            }
            
            #photoUploadForm .grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }

        /* ğŸŒ… æ—¥å‡ºæ—¥è½å€’æ•¸è¨ˆæ™‚å™¨æ¨£å¼ */
        .sun-countdown-container {
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .sun-countdown-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .sun-countdown-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(255, 107, 107, 0.4);
        }
        
        /* å€’æ•¸è¨ˆæ™‚é–ƒçˆå‹•ç•« - é»ƒé‡‘æ™‚æ®µ */
        @keyframes goldenPulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
            }
            50% { 
                box-shadow: 0 0 0 10px rgba(255, 215, 0, 0);
            }
        }
        
        .golden-hour-active {
            animation: goldenPulse 1.5s ease-in-out infinite;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF6B6B 100%) !important;
        }
        
        /* å€’æ•¸è¨ˆæ™‚æ•¸å­—å‹•ç•« */
        @keyframes countdownTick {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .countdown-tick {
            animation: countdownTick 0.3s ease-out;
        }
        
        /* æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 768px) {
            .sun-countdown-card {
                padding: 15px 18px;
            }
            
            .sun-countdown-card > div:first-child {
                flex-direction: column;
                gap: 12px;
            }
            
            .sun-info {
                flex-direction: row !important;
                justify-content: center;
                gap: 15px;
                min-width: 100% !important;
            }
            
            .sun-info > div:first-child {
                font-size: 1.5rem !important;
                margin-bottom: 0 !important;
            }
            
            .countdown-core {
                order: -1;
                min-width: 100% !important;
            }
            
            #countdownTimer {
                font-size: 1.8rem !important;
            }
            
            #sunriseTime, #sunsetTime {
                font-size: 1.2rem !important;
            }
            
            #photoAdvice {
                font-size: 0.85rem;
                padding: 10px 12px;
            }
        }
        
        /* æ·±è‰²æ¨¡å¼æ”¯æ´ */
        @media (prefers-color-scheme: dark) {
            .sun-countdown-card {
                background: linear-gradient(135deg, #c0392b 0%, #8e44ad 50%, #2c3e50 100%) !important;
            }
        }
    </style>
    {% include 'nav_styles.html' %}
</head>
<body>
    {% include 'nav_fragment.html' %}
    
    <div class="container">
        <header class="header">
            <h1>ğŸ”¥ ç‡’å¤©é æ¸¬ç³»çµ±</h1>
            <p>åŸºæ–¼é¦™æ¸¯å¤©æ–‡å°æ•¸æ“šçš„æ™ºèƒ½ç‡’å¤©é æ¸¬</p>
            <div id="currentTime" style="font-size: 1rem; color: #666; margin-top: 12px; font-weight: 500;"></div>
        </header>
        
        <!-- éºµåŒ…å±‘çµæ§‹åŒ–æ•¸æ“š -->
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": [
                {
                    "@type": "ListItem",
                    "position": 1,
                    "name": "é¦–é ",
                    "item": "https://burnsky-api.onrender.com/"
                },
                {
                    "@type": "ListItem",
                    "position": 2,
                    "name": "ç‡’å¤©é æ¸¬",
                    "item": "https://burnsky-api.onrender.com/predict"
                }
            ]
        }
        </script>
        
        <!-- ä¸»è¦æ‡‰ç”¨ç¨‹å¼å…§å®¹ -->
        <main class="main-card" role="main">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨åˆ†æå¤©æ°£æ•¸æ“š...</p>
            </div>

            <div id="content" style="display: none; text-align: center;">
                    <!-- ğŸ”¥ ç‡’å¤©æ©Ÿç‡é€²åº¦æ¢ -->
                    <div class="burnsky-progress-container" id="burnskyProgress" style="margin: 0 auto 20px; max-width: 400px;">
                        <div class="progress-score-display" style="text-align: center; margin-bottom: 12px;">
                            <span id="progressScore" style="font-size: 3.5rem; font-weight: 800; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">--</span>
                            <span style="font-size: 1.2rem; color: #999; margin-left: 4px;">åˆ†</span>
                        </div>
                        
                        <!-- æ¼¸è®Šé€²åº¦æ¢ -->
                        <div class="progress-bar-wrapper" style="position: relative; height: 24px; background: #e9ecef; border-radius: 12px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                            <div id="progressBarFill" class="progress-bar-fill" style="height: 100%; width: 0%; border-radius: 12px; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1), background 0.5s ease; background: linear-gradient(90deg, #74b9ff 0%, #48dbfb 25%, #feca57 50%, #fd9644 75%, #ff6b6b 100%); position: relative;">
                                <div class="progress-shine" style="position: absolute; top: 0; left: 0; right: 0; height: 50%; background: linear-gradient(180deg, rgba(255,255,255,0.4) 0%, transparent 100%); border-radius: 12px 12px 0 0;"></div>
                            </div>
                            <!-- åˆ»åº¦æ¨™è¨˜ -->
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; justify-content: space-between; padding: 0 2px; pointer-events: none;">
                                <div style="width: 1px; height: 100%; background: rgba(0,0,0,0.1);"></div>
                                <div style="width: 1px; height: 100%; background: rgba(0,0,0,0.1);"></div>
                                <div style="width: 1px; height: 100%; background: rgba(0,0,0,0.1);"></div>
                                <div style="width: 1px; height: 100%; background: rgba(0,0,0,0.1);"></div>
                                <div style="width: 1px; height: 100%; background: rgba(0,0,0,0.1);"></div>
                            </div>
                        </div>
                        
                        <!-- åˆ»åº¦æ•¸å­— -->
                        <div style="display: flex; justify-content: space-between; margin-top: 6px; font-size: 0.7rem; color: #999;">
                            <span>0</span>
                            <span>25</span>
                            <span>50</span>
                            <span>75</span>
                            <span>100</span>
                        </div>
                        
                        <!-- æ©Ÿç‡ç­‰ç´šæ¨™ç±¤ -->
                        <div id="progressLevelBadge" style="margin-top: 10px; display: inline-block; padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: #e9ecef; color: #666;">
                            è¼‰å…¥ä¸­...
                        </div>
                    </div>
                    
                    <div class="prediction-level" id="predictionLevel" aria-live="polite" style="display: none;">è¼‰å…¥ä¸­...</div>
                    <div class="probability" id="probability" aria-live="polite">è¨ˆç®—ä¸­...</div>
                    
                    <!-- ğŸŒ… æ—¥å‡ºæ—¥è½å€’æ•¸è¨ˆæ™‚å™¨ (æ‰‹æ©Ÿå„ªåŒ–ç‰ˆ) -->
                    <div id="sunCountdownContainer" class="sun-countdown-container" style="margin: 16px auto; max-width: 600px;">
                        <div class="sun-countdown-card" style="background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 50%, #ee5a52 100%); border-radius: 14px; padding: 14px 16px; box-shadow: 0 6px 20px rgba(255, 107, 107, 0.25); color: white;">
                            <!-- å€’æ•¸è¨ˆæ™‚æ ¸å¿ƒ (æ‰‹æ©Ÿç‰ˆç½®é ‚çªå‡º) -->
                            <div class="countdown-core" style="text-align: center; padding: 10px 16px; background: rgba(255,255,255,0.15); border-radius: 10px; backdrop-filter: blur(5px); margin-bottom: 12px;">
                                <div id="countdownLabel" style="font-size: 0.8rem; opacity: 0.95; margin-bottom: 4px;">è·é›¢æ—¥è½é‚„æœ‰</div>
                                <div id="countdownTimer" style="font-size: 1.8rem; font-weight: bold; font-family: 'SF Mono', 'Monaco', monospace; letter-spacing: 1px;">
                                    --:--:--
                                </div>
                                <div id="countdownStatus" style="font-size: 0.7rem; margin-top: 4px; opacity: 0.85;">
                                    <span id="statusIcon">â³</span> <span id="statusText">è¼‰å…¥ä¸­...</span>
                                </div>
                            </div>
                            
                            <!-- æ—¥å‡ºæ—¥è½æ™‚é–“ (æ©«æ’ç·Šæ¹Š) -->
                            <div style="display: flex; justify-content: space-around; align-items: center;">
                                <div class="sun-info" style="text-align: center;">
                                    <span style="font-size: 1.2rem;">ğŸŒ„</span>
                                    <span style="font-size: 0.75rem; opacity: 0.9; margin: 0 4px;">æ—¥å‡º</span>
                                    <span id="sunriseTime" style="font-size: 1.1rem; font-weight: bold;">--:--</span>
                                </div>
                                <div style="width: 1px; height: 24px; background: rgba(255,255,255,0.3);"></div>
                                <div class="sun-info" style="text-align: center;">
                                    <span style="font-size: 1.2rem;">ğŸŒ…</span>
                                    <span style="font-size: 0.75rem; opacity: 0.9; margin: 0 4px;">æ—¥è½</span>
                                    <span id="sunsetTime" style="font-size: 1.1rem; font-weight: bold;">--:--</span>
                                </div>
                            </div>
                            
                            <!-- æ‹æ”å»ºè­° (ç²¾ç°¡) -->
                            <div id="photoAdvice" style="margin-top: 10px; padding: 8px 12px; background: rgba(255,255,255,0.18); border-radius: 8px; font-size: 0.8rem; text-align: center;">
                                ğŸ“¸ <span id="photoAdviceText">è¼‰å…¥æ‹æ”å»ºè­°...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç‡’å¤©æŒ‡æ•¸å°ç…§è¡¨ (æ‰‹æ©Ÿç‰ˆæ‘ºç–Š) -->
                    <div class="score-reference-card" style="margin: 12px auto; max-width: 500px;">
                        <div class="score-reference-header" onclick="toggleScoreReference()" style="cursor: pointer; padding: 10px 16px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border-radius: 10px; text-align: center; user-select: none;">
                            <span style="font-weight: 600; font-size: 0.9rem;">ğŸ“Š ç‡’å¤©æŒ‡æ•¸å°ç…§</span>
                            <span id="scoreReferenceToggleIcon" style="float: right;">ğŸ”½</span>
                        </div>
                        <div id="scoreReferenceContent" style="display: none; background: white; border: 2px solid #667eea; border-top: none; border-radius: 0 0 10px 10px; padding: 12px;">
                            <div class="score-ranges" style="display: grid; gap: 6px; font-size: 0.8rem;">
                                <div style="display: flex; align-items: center; padding: 6px 10px; border-radius: 6px; background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: white;">
                                    <div style="font-weight: bold; width: 50px;">80-100</div>
                                    <div style="flex: 1;">ğŸ”¥ æ¥µé«˜</div>
                                    <div style="font-size: 0.7rem; opacity: 0.9;">å¿…æ‹</div>
                                </div>
                                <div style="display: flex; align-items: center; padding: 6px 10px; border-radius: 6px; background: linear-gradient(45deg, #fd9644, #e55a4e); color: white;">
                                    <div style="font-weight: bold; width: 50px;">65-79</div>
                                    <div style="flex: 1;">ğŸŒ… é«˜</div>
                                    <div style="font-size: 0.7rem; opacity: 0.9;">æ¨è–¦</div>
                                </div>
                                <div style="display: flex; align-items: center; padding: 6px 10px; border-radius: 6px; background: linear-gradient(45deg, #feca57, #ff9ff3); color: white;">
                                    <div style="font-weight: bold; width: 50px;">50-64</div>
                                    <div style="flex: 1;">â›… ä¸­ç­‰</div>
                                    <div style="font-size: 0.7rem; opacity: 0.9;">å¯è©¦</div>
                                </div>
                                <div style="display: flex; align-items: center; padding: 6px 10px; border-radius: 6px; background: linear-gradient(45deg, #48dbfb, #0abde3); color: white;">
                                    <div style="font-weight: bold; width: 50px;">30-49</div>
                                    <div style="flex: 1;">ğŸŒ¤ï¸ è¼ƒä½</div>
                                    <div style="font-size: 0.7rem; opacity: 0.9;">ç¢°é‹æ°£</div>
                                </div>
                                <div style="display: flex; align-items: center; padding: 6px 10px; border-radius: 6px; background: linear-gradient(45deg, #74b9ff, #0984e3); color: white;">
                                    <div style="font-weight: bold; width: 50px;">0-29</div>
                                    <div style="flex: 1;">â„ï¸ æ¥µä½</div>
                                    <div style="font-size: 0.7rem; opacity: 0.9;">ä¸å»ºè­°</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- é æ¸¬æ§åˆ¶é … (æ‰‹æ©Ÿç‰ˆç²¾ç°¡) -->
                    <div class="prediction-controls" style="margin: 16px 0; display: flex; gap: 10px; justify-content: center; align-items: stretch; flex-wrap: wrap;">
                        <select id="predictionType" style="padding: 10px 14px; border-radius: 10px; border: 2px solid #ddd; font-size: 0.9rem; flex: 1; min-width: 120px; max-width: 150px;" aria-label="é æ¸¬é¡å‹">
                            <option value="sunset">ğŸŒ… æ—¥è½</option>
                            <option value="sunrise">ğŸŒ„ æ—¥å‡º</option>
                        </select>
                        <select id="advanceHours" style="padding: 10px 14px; border-radius: 10px; border: 2px solid #ddd; font-size: 0.9rem; flex: 1; min-width: 120px; max-width: 150px;" aria-label="æå‰æ™‚é–“">
                            <option value="0" selected>â° å³æ™‚</option>
                            <option value="1">1å°æ™‚å¾Œ</option>
                            <option value="2">2å°æ™‚å¾Œ</option>
                            <option value="3">3å°æ™‚å¾Œ</option>
                            <option value="6">6å°æ™‚å¾Œ</option>
                            <option value="12">12å°æ™‚å¾Œ</option>
                        </select>
                    </div>
                    
                    <button class="refresh-btn" onclick="loadPrediction()" aria-label="é‡æ–°é æ¸¬">
                        ğŸ”„ é‡æ–°é æ¸¬
                    </button>
                </section>

                <!-- å¤©æ°£æ•¸æ“šå€åŸŸ -->
                <section class="weather-section" aria-labelledby="weather-title" style="margin-top: 20px;">
                    <h2 class="weather-title" id="weather-title">ğŸŒ¦ï¸ å¤©æ°£æ•¸æ“š</h2>
                    
                    <div class="weather-data" id="weatherData" role="region" aria-live="polite">
                        <!-- å¤©æ°£æ•¸æ“šå°‡å‹•æ…‹è¼‰å…¥ -->
                        <!-- å¤©æ°£è­¦å‘Šå¡ç‰‡å°‡åœ¨é€™è£¡å‹•æ…‹æ·»åŠ  -->
                    </div>
                </section>

                <!-- ğŸ“· å³æ™‚æ”å½±æ©Ÿé è¦½å€åŸŸ -->
                <section class="webcam-preview-section" aria-labelledby="webcam-preview-title" style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h2 id="webcam-preview-title" style="color: white; margin: 0; font-size: 1.1rem; font-weight: 600;">ğŸ“· å³æ™‚å¤©ç©ºå¯¦æ³</h2>
                        <a href="/webcam-analysis" style="color: rgba(255,255,255,0.9); font-size: 0.8rem; text-decoration: none;">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
                    </div>
                    
                    <div class="webcam-preview-container" id="webcamPreview">
                        <div class="webcam-preview-loading" style="text-align: center; padding: 30px; color: rgba(255,255,255,0.8);">
                            <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 10px;"></div>
                            è¼‰å…¥æ”å½±æ©Ÿ...
                        </div>
                    </div>
                </section>

                <!-- æ™ºèƒ½åˆ†ææ‘˜è¦å€åŸŸ -->
                <section class="summary-section" aria-labelledby="summary-title">
                    <h2 class="summary-title" id="summary-title">ğŸ’¡ æ™ºèƒ½åˆ†ææ‘˜è¦</h2>
                    <div id="analysisSummary" role="region" aria-live="polite">
                        <!-- åˆ†ææ‘˜è¦å°‡å‹•æ…‹è¼‰å…¥ -->
                    </div>
                </section>

                <!-- ç”¨æˆ¶åé¥‹å€åŸŸ -->
                <section class="main-card" aria-labelledby="feedback-title" style="margin-top: 30px; background: #fff3cd; border-left: 4px solid #ffc107;" id="feedbackSection">
                    <h2 id="feedback-title" style="color: #856404; margin: 0 0 15px 0; font-size: 1.4rem;">ğŸ“¸ å¯¦éš›ç‡’å¤©å¦‚ä½•ï¼Ÿ</h2>
                    <p style="margin: 0 0 20px 0; font-size: 1rem; color: #856404;">æ‚¨çš„åé¥‹å¹«åŠ©æˆ‘å€‘æ”¹é€²é æ¸¬æº–ç¢ºç‡</p>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #856404;">å¯¦éš›ç‡’å¤©è©•åˆ† (0-100)ï¼š</label>
                        <input type="range" id="userRating" min="0" max="100" value="50" 
                               style="width: 100%; height: 8px; margin-bottom: 10px; border-radius: 4px;"
                               oninput="document.getElementById('ratingValue').textContent = this.value">
                        <div style="text-align: center; font-size: 2rem; font-weight: bold; color: #856404; margin-bottom: 10px;">
                            <span id="ratingValue">50</span> åˆ†
                        </div>
                        <div style="text-align: center; font-size: 0.9rem; color: #666; margin-top: 5px;">
                            <span id="ratingDescription">æ‹–å‹•æ»‘å¡Šè¨­ç½®æ‚¨çš„è©•åˆ†</span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #856404;">è£œå……èªªæ˜ï¼ˆé¸å¡«ï¼‰ï¼š</label>
                        <textarea id="feedbackComment" rows="3" 
                                  style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; resize: vertical; font-size: 1rem;"
                                  placeholder="ä¾‹å¦‚ï¼šå¯¦éš›é¡è‰²æ›´è±å¯Œã€é›²å±¤è¼ƒé æœŸåšã€èƒ½è¦‹åº¦æ¯”é æœŸå¥½..."></textarea>
                    </div>
                    
                    <button onclick="submitFeedback()" 
                            style="background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 12px; cursor: pointer; font-size: 1.1rem; font-weight: 600; width: 100%; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40, 167, 69, 0.4)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.3)'">
                        âœ… æäº¤åé¥‹
                    </button>
                    
                    <div style="margin-top: 15px; padding: 12px; background: rgba(255, 255, 255, 0.7); border-radius: 8px; font-size: 0.9rem; color: #666; text-align: center;">
                        ğŸ’¡ æ‚¨çš„åé¥‹å°‡ç”¨æ–¼è¨ˆç®—ç³»çµ±çš„çœŸå¯¦æº–ç¢ºç‡ï¼Œå¹«åŠ©æ”¹é€²é æ¸¬ç®—æ³•
                    </div>
                </section>

                <!-- åˆ†æå› å­å€åŸŸ -->
                <section class="main-card" aria-labelledby="factors-title" style="margin-top: 30px;" id="factorsSection">
                    <div class="toggle-header" onclick="toggleFactorsSection()">
                        <h2 id="factors-title" style="text-align: left; color: #333; margin: 0; font-size: 1.4rem;">ğŸ“Š è©³ç´°åˆ†æå› å­</h2>
                        <div id="factorsToggleIcon" class="toggle-icon">ğŸ”½</div>
                    </div>
                    <div class="analysis-grid" id="analysisGrid" role="region" aria-live="polite" style="margin-top: 30px;">
                        <!-- åˆ†æå› å­å°‡å‹•æ…‹è¼‰å…¥ -->
                    </div>
                </section>

                <!-- ç‡’å¤©æ­·å²çµ±è¨ˆå€åŸŸ -->
                <section class="main-card" aria-labelledby="burnsky-history-title" style="margin-top: 30px;" id="burnskyHistorySection">
                    <div class="toggle-header" onclick="toggleBurnskyHistorySection()">
                        <h2 id="burnsky-history-title" style="text-align: left; color: #333; margin: 0; font-size: 1.4rem;">ğŸ“Š ç‡’å¤©æ­·å²çµ±è¨ˆ</h2>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="color: #999; font-size: 0.85rem;">éå»30å¤©é æ¸¬å›é¡§</span>
                            <div id="burnskyHistoryToggleIcon" class="toggle-icon">ğŸ”½</div>
                        </div>
                    </div>
                    <div id="burnskyHistoryContent" role="region" aria-live="polite" style="margin-top: 30px; display: none;">
                        <!-- é¸é …å¡å°èˆª -->
                        <div class="tab-navigation" style="display: flex; justify-content: center; margin-bottom: 25px; border-bottom: 2px solid #e9ecef;">
                            <button class="tab-btn active" onclick="switchBurnskyTab('overview')" data-tab="overview" style="padding: 12px 24px; border: none; background: none; color: #667eea; font-weight: 600; border-bottom: 2px solid #667eea; cursor: pointer; transition: all 0.3s ease;">
                                ğŸ“Š çµ±è¨ˆç¸½è¦½
                            </button>
                            <button class="tab-btn" onclick="switchBurnskyTab('trends')" data-tab="trends" style="padding: 12px 24px; border: none; background: none; color: #666; font-weight: 600; border-bottom: 2px solid transparent; cursor: pointer; transition: all 0.3s ease;">
                                ğŸ“ˆ è©•åˆ†è¶¨å‹¢
                            </button>
                            <button class="tab-btn" onclick="switchBurnskyTab('comparison')" data-tab="comparison" style="padding: 12px 24px; border: none; background: none; color: #666; font-weight: 600; border-bottom: 2px solid transparent; cursor: pointer; transition: all 0.3s ease;">
                                ğŸŒ… æ—¥å‡ºæ—¥è½å°æ¯”
                            </button>
                            <button class="tab-btn" onclick="switchBurnskyTab('insights')" data-tab="insights" style="padding: 12px 24px; border: none; background: none; color: #666; font-weight: 600; border-bottom: 2px solid transparent; cursor: pointer; transition: all 0.3s ease;">
                                ğŸ’¡ æ•¸æ“šæ´å¯Ÿ
                            </button>
                        </div>

                        <!-- çµ±è¨ˆç¸½è¦½é¸é …å¡ -->
                        <div id="overviewTab" class="tab-content active" style="display: block;">
                            <div class="burnsky-overview-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 25px;">
                                <div class="burnsky-summary-card" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                                    <div style="font-size: 2.5rem; margin-bottom: 10px;">ğŸ“Š</div>
                                    <div style="font-size: 2.2rem; font-weight: bold; margin-bottom: 8px;" id="totalPredictions">-</div>
                                    <div style="opacity: 0.95; font-size: 1rem; font-weight: 500;">ç¸½é æ¸¬æ¬¡æ•¸</div>
                                </div>
                                <div class="burnsky-summary-card" style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);">
                                    <div style="font-size: 2.5rem; margin-bottom: 10px;">ğŸ”¥</div>
                                    <div style="font-size: 2.2rem; font-weight: bold; margin-bottom: 8px;" id="highScoreCount">-</div>
                                    <div style="opacity: 0.95; font-size: 1rem; font-weight: 500;">é«˜åˆ†é æ¸¬ (â‰¥70)</div>
                                </div>
                                <div class="burnsky-summary-card" style="background: linear-gradient(135deg, #a855f7, #ec4899); color: white; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3);">
                                    <div style="font-size: 2.5rem; margin-bottom: 10px;">ğŸ’œ</div>
                                    <div style="font-size: 2.2rem; font-weight: bold; margin-bottom: 8px;" id="mediumScoreCount">-</div>
                                    <div style="opacity: 0.95; font-size: 1rem; font-weight: 500;">ä¸­åˆ†é æ¸¬ (50-69)</div>
                                </div>
                                <div class="burnsky-summary-card" style="background: linear-gradient(135deg, #feca57, #ff9ff3); color: white; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(254, 202, 87, 0.3);">
                                    <div style="font-size: 2.5rem; margin-bottom: 10px;">ğŸ¯</div>
                                    <div style="font-size: 2.2rem; font-weight: bold; margin-bottom: 8px;" id="successRate">-</div>
                                    <div style="opacity: 0.95; font-size: 1rem; font-weight: 500;">é«˜åˆ†æˆåŠŸç‡</div>
                                </div>
                            </div>
                            
                            <!-- è©•åˆ†åˆ†å¸ƒåœ– -->
                            <div class="chart-container" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <h3 style="color: #333; margin-bottom: 15px; text-align: center;">ğŸ“Š è©•åˆ†åˆ†å¸ƒæ¦‚è¦½</h3>
                                <div id="scoreDistributionChart" style="height: 300px; position: relative;">
                                    <canvas id="scoreDistChartCanvas" style="width: 100%; height: 100%;"></canvas>
                                </div>
                            </div>
                            
                            <!-- é æ¸¬é¡å‹çµ±è¨ˆ -->
                            <div class="chart-container" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <h3 style="color: #333; margin-bottom: 15px; text-align: center;">ğŸŒ… é æ¸¬é¡å‹çµ±è¨ˆ</h3>
                                <div id="predictionTypeChart" style="height: 300px; position: relative;">
                                    <canvas id="typeChartCanvas" style="width: 100%; height: 100%;"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- è©•åˆ†è¶¨å‹¢é¸é …å¡ -->
                        <div id="trendsTab" class="tab-content" style="display: none;">
                            <div class="chart-container" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <h3 style="color: #333; margin-bottom: 15px; text-align: center;">ğŸ“ˆ æ¯æ—¥è©•åˆ†è¶¨å‹¢</h3>
                                <div id="dailyTrendChart" style="height: 400px; position: relative;">
                                    <canvas id="trendChartCanvas" style="width: 100%; height: 100%;"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- æ—¥å‡ºæ—¥è½å°æ¯”é¸é …å¡ -->
                        <div id="comparisonTab" class="tab-content" style="display: none;">
                            <div class="comparison-metrics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                                <div class="metric-card" style="background: white; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                    <div style="font-size: 1.5rem; margin-bottom: 10px;">ğŸŒ…</div>
                                    <div style="font-size: 1.3rem; font-weight: bold; color: #FF6B6B; margin-bottom: 5px;" id="sunriseAvg">-</div>
                                    <div style="color: #666;">æ—¥å‡ºå¹³å‡è©•åˆ†</div>
                                </div>
                                <div class="metric-card" style="background: white; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                    <div style="font-size: 1.5rem; margin-bottom: 10px;">ğŸŒ‡</div>
                                    <div style="font-size: 1.3rem; font-weight: bold; color: #4ECDC4; margin-bottom: 5px;" id="sunsetAvg">-</div>
                                    <div style="color: #666;">æ—¥è½å¹³å‡è©•åˆ†</div>
                                </div>
                                <div class="metric-card" style="background: white; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                    <div style="font-size: 1.5rem; margin-bottom: 10px;">ğŸ†</div>
                                    <div style="font-size: 1.3rem; font-weight: bold; color: #FFB6C1; margin-bottom: 5px;" id="betterType">-</div>
                                    <div style="color: #666;">è¡¨ç¾è¼ƒä½³</div>
                                </div>
                            </div>
                            
                            <div class="chart-container" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                <h3 style="color: #333; margin-bottom: 15px; text-align: center;">ğŸŒ… vs ğŸŒ‡ è©•åˆ†å°æ¯”</h3>
                                <div id="comparisonChart" style="height: 350px; position: relative;">
                                    <canvas id="comparisonChartCanvas" style="width: 100%; height: 100%;"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- æ•¸æ“šæ´å¯Ÿé¸é …å¡ -->
                        <div id="insightsTab" class="tab-content" style="display: none;">
                            <div id="burnskyInsightsContent" style="display: grid; gap: 20px;">
                                <div class="insight-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                    <h4 style="color: #333; margin-bottom: 15px; display: flex; align-items: center;">
                                        <span style="margin-right: 10px;">ğŸ¯</span>
                                        æœ€ä½³æ‹æ”æ™‚æ®µ
                                    </h4>
                                    <div id="bestHoursInsight" style="color: #666; line-height: 1.6;">
                                        è¼‰å…¥ä¸­...
                                    </div>
                                </div>
                                
                                <div class="insight-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                    <h4 style="color: #333; margin-bottom: 15px; display: flex; align-items: center;">
                                        <span style="margin-right: 10px;">ğŸ“Š</span>
                                        çµ±è¨ˆç¸½çµ
                                    </h4>
                                    <div id="statisticsSummary" style="color: #666; line-height: 1.6;">
                                        è¼‰å…¥ä¸­...
                                    </div>
                                </div>
                                
                                <div class="insight-card" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                    <h4 style="color: #333; margin-bottom: 15px; display: flex; align-items: center;">
                                        <span style="margin-right: 10px;">ğŸ’¡</span>
                                        AI åˆ†æå»ºè­°
                                    </h4>
                                    <div id="aiInsights" style="color: #666; line-height: 1.6;">
                                        è¼‰å…¥ä¸­...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <div class="last-updated" id="lastUpdated">
                    <!-- æœ€å¾Œæ›´æ–°æ™‚é–“ -->
                </div>
            </div>
        </div>
        
        <!-- è©³ç´°å…è²¬è²æ˜ -->
        <div class="main-card" style="max-width: 800px;">
            <h3 style="color: #495057; font-size: 1.1rem; margin-bottom: 15px; text-align: center;">ğŸ“ ä½¿ç”¨æ¢æ¬¾èˆ‡å…è²¬è²æ˜</h3>
            <div style="color: #6c757d; font-size: 0.9rem; line-height: 1.6;">
                <p style="text-align: center;"><strong>æœ¬ç‡’å¤©é æ¸¬ç³»çµ±èªªæ˜ï¼š</strong></p>
                <ul style="padding-left: 20px; margin: 10px 0; text-align: left;">
                    <li><strong>åƒ…ä¾›åƒè€ƒï¼š</strong>æ‰€æœ‰é æ¸¬çµæœåƒ…ä¾›åƒè€ƒå’Œå¨›æ¨‚ç”¨é€”ï¼Œä¸æ‡‰ä½œç‚ºé‡è¦æ±ºç­–çš„å”¯ä¸€ä¾æ“šã€‚</li>
                    <li><strong>æ•¸æ“šä¾†æºï¼š</strong>é æ¸¬åŸºæ–¼é¦™æ¸¯å¤©æ–‡å°å…¬é–‹æ•¸æ“šï¼Œä½†å¤©æ°£è®ŠåŒ–è¤‡é›œï¼Œå¯¦éš›æƒ…æ³å¯èƒ½æœ‰æ‰€ä¸åŒã€‚</li>
                    <li><strong>æŠ€è¡“é™åˆ¶ï¼š</strong>æ©Ÿå™¨å­¸ç¿’æ¨¡å‹å’Œå‚³çµ±ç®—æ³•éƒ½æœ‰å…¶å±€é™æ€§ï¼Œç„¡æ³•ä¿è­‰100%æº–ç¢ºæ€§ã€‚</li>
                    <li><strong>å€‹äººè²¬ä»»ï¼š</strong>ç”¨æˆ¶æ‡‰çµåˆå¯¦éš›è§€å¯Ÿã€å®˜æ–¹å¤©æ°£é å ±å’Œå€‹äººåˆ¤æ–·ä¾†åšæ±ºå®šã€‚</li>
                    <li><strong>å…è²¬æ¢æ¬¾ï¼š</strong>åƒå§‹å‰µæ„åŠç³»çµ±é–‹ç™¼è€…ä¸å°å› ä½¿ç”¨æœ¬é æ¸¬çµæœè€Œç”¢ç”Ÿçš„ä»»ä½•ç›´æ¥æˆ–é–“æ¥æå¤±æ‰¿æ“”è²¬ä»»ã€‚</li>
                </ul>
                <p style="text-align: center; margin-top: 15px; font-style: italic;">
                    ğŸŒ… äº«å—å¤§è‡ªç„¶çš„ç¾æ™¯ï¼Œä½†è«‹ä»¥å®‰å…¨å’Œå¯¦éš›è§€å¯Ÿç‚ºå…ˆï¼
                </p>
                
                <p style="text-align: center; margin-top: 10px; font-size: 0.8rem; color: #868e96;">
                    Â© 2025 åƒå§‹å‰µæ„ | ç‡’å¤©é æ¸¬ç³»çµ±<br>
                    <a href="/privacy" style="color: #868e96; text-decoration: none; margin: 0 5px;">éš±ç§æ”¿ç­–</a> | 
                    <a href="/terms" style="color: #868e96; text-decoration: none; margin: 0 5px;">ä½¿ç”¨æ¢æ¬¾</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // é¦™æ¸¯æ™‚å€è™•ç†å‡½æ•¸
        // å¼·åˆ¶åˆ·æ–°å‡½æ•¸ - æ¸…é™¤æ‰€æœ‰ç·©å­˜
        function forceRefresh() {
            // æ¸…é™¤ç€è¦½å™¨ç·©å­˜
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            // æ·»åŠ éš¨æ©Ÿåƒæ•¸å¼·åˆ¶æ›´æ–°
            const timestamp = Date.now();
            window.location.href = window.location.href.split('?')[0] + '?t=' + timestamp;
        }

        function getHongKongTime() {
            return new Date().toLocaleString('zh-TW', {
                timeZone: 'Asia/Hong_Kong',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
        }

        function getHongKongTimeShort() {
            return new Date().toLocaleString('zh-TW', {
                timeZone: 'Asia/Hong_Kong',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
        }

        // ==================== ğŸŒ… æ—¥å‡ºæ—¥è½å€’æ•¸è¨ˆæ™‚å™¨ ====================
        let sunCountdownInterval = null;
        let currentSunTimes = null;
        let currentPredictionTypeForCountdown = 'sunset';
        let currentBurnskyScore = 0;
        
        /**
         * ğŸ”¥ æ›´æ–°ç‡’å¤©é€²åº¦æ¢
         * @param {number} score - ç‡’å¤©åˆ†æ•¸ (0-100)
         * @param {string} level - é æ¸¬ç­‰ç´šæ–‡å­—
         */
        function updateBurnskyProgress(score, level) {
            const progressScore = document.getElementById('progressScore');
            const progressBarFill = document.getElementById('progressBarFill');
            const progressLevelBadge = document.getElementById('progressLevelBadge');
            
            if (!progressScore || !progressBarFill) return;
            
            // å‹•æ…‹æ›´æ–°åˆ†æ•¸ (å¸¶å‹•ç•«)
            animateNumber(progressScore, score);
            
            // æ›´æ–°é€²åº¦æ¢å¯¬åº¦
            setTimeout(() => {
                progressBarFill.style.width = `${score}%`;
            }, 100);
            
            // æ ¹æ“šåˆ†æ•¸è¨­ç½®é¡è‰²å’Œç­‰ç´š
            let bgColor, textColor, levelText, emoji;
            if (score >= 80) {
                bgColor = 'linear-gradient(135deg, #ff6b6b, #ee5a52)';
                textColor = '#fff';
                levelText = 'æ¥µé«˜æ©Ÿç‡';
                emoji = 'ğŸ”¥';
            } else if (score >= 65) {
                bgColor = 'linear-gradient(135deg, #fd9644, #e55a4e)';
                textColor = '#fff';
                levelText = 'é«˜æ©Ÿç‡';
                emoji = 'ğŸŒ…';
            } else if (score >= 50) {
                bgColor = 'linear-gradient(135deg, #feca57, #ff9ff3)';
                textColor = '#fff';
                levelText = 'ä¸­ç­‰æ©Ÿç‡';
                emoji = 'â›…';
            } else if (score >= 30) {
                bgColor = 'linear-gradient(135deg, #48dbfb, #0abde3)';
                textColor = '#fff';
                levelText = 'è¼ƒä½æ©Ÿç‡';
                emoji = 'ğŸŒ¤ï¸';
            } else {
                bgColor = 'linear-gradient(135deg, #74b9ff, #0984e3)';
                textColor = '#fff';
                levelText = 'æ©Ÿç‡æ¥µä½';
                emoji = 'â„ï¸';
            }
            
            // æ›´æ–°ç­‰ç´šæ¨™ç±¤
            if (progressLevelBadge) {
                progressLevelBadge.style.background = bgColor;
                progressLevelBadge.style.color = textColor;
                progressLevelBadge.innerHTML = `${emoji} ${levelText}`;
            }
            
            // é«˜åˆ†æ™‚æ·»åŠ ç™¼å…‰æ•ˆæœ
            if (score >= 70) {
                progressBarFill.classList.add('progress-glow');
            } else {
                progressBarFill.classList.remove('progress-glow');
            }
        }
        
        /**
         * æ•¸å­—å‹•ç•«æ•ˆæœ
         */
        function animateNumber(element, targetValue) {
            const duration = 1000;
            const startValue = parseInt(element.textContent) || 0;
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // ç·©å‹•å‡½æ•¸
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const currentValue = Math.round(startValue + (targetValue - startValue) * easeOut);
                
                element.textContent = currentValue;
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }
        
        /**
         * ğŸ“· è¼‰å…¥ Webcam é è¦½
         */
        async function loadWebcamPreview() {
            const container = document.getElementById('webcamPreview');
            if (!container) return;
            
            try {
                const response = await fetch('/api/webcam/current');
                if (!response.ok) throw new Error('è¼‰å…¥å¤±æ•—');
                const data = await response.json();
                
                if (!data.webcam_data || Object.keys(data.webcam_data).length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.6); font-size: 0.85rem;">æš«ç„¡æ”å½±æ©Ÿè³‡æ–™</div>';
                    return;
                }
                
                // å‹•æ…‹ç”Ÿæˆ HKO åœ–ç‰‡ URL
                function getHkoImageUrl(camId) {
                    // å¾ HK_XXX å–å¾— xxx (å°å¯«) å’Œ XXX (å¤§å¯«)
                    const code = camId.replace('HK_', '');
                    const lowerCode = code.toLowerCase();
                    return `https://www.hko.gov.hk/wxinfo/aws/hko_mica/${lowerCode}/latest_${code}.jpg`;
                }
                
                // å„ªå…ˆé¡¯ç¤ºçš„æ”å½±æ©Ÿï¼ˆç‡’å¤©ç†±é–€åœ°é» - åªé¡¯ç¤ºé€™äº›ï¼‰
                const priorityLocations = ['HK_LFS', 'HK_WGL', 'HK_CP1', 'HK_VPB', 'HK_TPK', 'HK_CCH', 'HK_HKO', 'HK_WLP'];
                
                // åªé¸å–å„ªå…ˆåœ°é»ä¸­å­˜åœ¨æ–¼ API è³‡æ–™çš„æ”å½±æ©Ÿ
                const sortedWebcams = priorityLocations
                    .filter(id => data.webcam_data[id])
                    .map(id => ({ id, ...data.webcam_data[id] }))
                    .slice(0, 8); // æœ€å¤šé¡¯ç¤º 8 å€‹
                
                let html = '';
                for (const webcam of sortedWebcams) {
                    const imgUrl = getHkoImageUrl(webcam.id);
                    const score = webcam.sunset_potential || 0;
                    const name = webcam.name || webcam.id;
                    
                    // è©•åˆ†é¡è‰²
                    let badgeColor = '#74b9ff';
                    if (score >= 7) badgeColor = '#ff6b6b';
                    else if (score >= 5) badgeColor = '#fd9644';
                    else if (score >= 3) badgeColor = '#feca57';
                    
                    html += `
                        <a href="/webcam-analysis" class="webcam-preview-card" style="text-decoration: none;">
                            <img src="${imgUrl}" 
                                 alt="${name}" 
                                 class="webcam-preview-img"
                                 loading="lazy"
                                 onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 60%22><rect fill=%22%23333%22 width=%22100%22 height=%2260%22/><text x=%2250%22 y=%2235%22 text-anchor=%22middle%22 fill=%22%23666%22 font-size=%2210%22>ğŸ“·</text></svg>'">
                            <div class="webcam-preview-info">
                                <div class="webcam-preview-name">${name}</div>
                                <div class="webcam-preview-score">
                                    ç‡’å¤©æ½›åŠ›
                                    <span class="webcam-score-badge" style="background: ${badgeColor}; color: white;">${score.toFixed(1)}</span>
                                </div>
                            </div>
                        </a>
                    `;
                }
                
                container.innerHTML = html || '<div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.6);">æš«ç„¡è³‡æ–™</div>';
                
            } catch (error) {
                console.error('ğŸ“· Webcam é è¦½è¼‰å…¥å¤±æ•—:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.6); font-size: 0.85rem;">
                        ç„¡æ³•è¼‰å…¥æ”å½±æ©Ÿ
                        <br><a href="/webcam-analysis" style="color: #74b9ff; font-size: 0.8rem;">å‰å¾€å®Œæ•´é é¢ â†’</a>
                    </div>
                `;
            }
        }
        
        /**
         * æ›´æ–°æ—¥å‡ºæ—¥è½å€’æ•¸è¨ˆæ™‚å™¨
         * @param {Object} sunTimes - åŒ…å« sunrise å’Œ sunset æ™‚é–“çš„ç‰©ä»¶
         * @param {string} predictionType - é æ¸¬é¡å‹ ('sunrise' æˆ– 'sunset')
         * @param {number} burnskyScore - ç‡’å¤©é æ¸¬åˆ†æ•¸
         */
        function updateSunCountdown(sunTimes, predictionType, burnskyScore) {
            currentSunTimes = sunTimes;
            currentPredictionTypeForCountdown = predictionType || 'sunset';
            currentBurnskyScore = burnskyScore || 0;
            
            // æ›´æ–°æ—¥å‡ºæ—¥è½æ™‚é–“é¡¯ç¤º
            document.getElementById('sunriseTime').textContent = sunTimes.sunrise || '--:--';
            document.getElementById('sunsetTime').textContent = sunTimes.sunset || '--:--';
            
            // æ¸…é™¤èˆŠçš„è¨ˆæ™‚å™¨
            if (sunCountdownInterval) {
                clearInterval(sunCountdownInterval);
            }
            
            // å•Ÿå‹•æ–°çš„è¨ˆæ™‚å™¨
            updateCountdownDisplay();
            sunCountdownInterval = setInterval(updateCountdownDisplay, 1000);
        }
        
        /**
         * æ›´æ–°å€’æ•¸è¨ˆæ™‚é¡¯ç¤º
         */
        function updateCountdownDisplay() {
            if (!currentSunTimes) return;
            
            const now = new Date();
            // ç²å–é¦™æ¸¯æ™‚é–“
            const hkNow = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Hong_Kong' }));
            
            // è§£ææ—¥å‡ºæ—¥è½æ™‚é–“
            const [sunriseHour, sunriseMin] = currentSunTimes.sunrise.split(':').map(Number);
            const [sunsetHour, sunsetMin] = currentSunTimes.sunset.split(':').map(Number);
            
            // å‰µå»ºä»Šæ—¥çš„æ—¥å‡ºæ—¥è½æ™‚é–“
            const todaySunrise = new Date(hkNow);
            todaySunrise.setHours(sunriseHour, sunriseMin, 0, 0);
            
            const todaySunset = new Date(hkNow);
            todaySunset.setHours(sunsetHour, sunsetMin, 0, 0);
            
            // è¨ˆç®—æœ€ä½³ç‡’å¤©æ™‚é–“ï¼ˆæ—¥è½å‰40åˆ†é˜ï¼Œæ—¥å‡ºå¾Œ10åˆ†é˜ï¼‰
            const goldenHourSunset = new Date(todaySunset.getTime() - 40 * 60 * 1000);
            const goldenHourSunrise = new Date(todaySunrise.getTime() + 10 * 60 * 1000);
            
            let targetTime, targetLabel, isGoldenHour = false;
            let statusIcon = 'â³';
            let statusText = '';
            let photoAdvice = '';
            
            // åˆ¤æ–·ç•¶å‰æ‡‰è©²å€’æ•¸åˆ°å“ªå€‹æ™‚é–“é»
            const predictionType = currentPredictionTypeForCountdown;
            
            if (predictionType === 'sunrise') {
                // æ—¥å‡ºæ¨¡å¼
                if (hkNow < todaySunrise) {
                    // é‚„æœªåˆ°æ—¥å‡º
                    if (hkNow >= new Date(todaySunrise.getTime() - 60 * 60 * 1000)) {
                        // æ—¥å‡ºå‰1å°æ™‚å…§
                        isGoldenHour = true;
                        statusIcon = 'ğŸŒ„';
                        statusText = 'æº–å‚™å‡ºç™¼æ‹æ”æ—¥å‡ºç‡’å¤©ï¼';
                    } else {
                        statusIcon = 'ğŸŒ™';
                        statusText = 'ç­‰å¾…æ—¥å‡ºæ™‚åˆ»';
                    }
                    targetTime = todaySunrise;
                    targetLabel = 'è·é›¢æ—¥å‡ºé‚„æœ‰';
                    photoAdvice = getPhotoAdvice('before_sunrise', currentBurnskyScore);
                } else if (hkNow < goldenHourSunrise) {
                    // æ—¥å‡ºä¸­ï¼Œé»ƒé‡‘æ™‚æ®µ
                    isGoldenHour = true;
                    targetTime = goldenHourSunrise;
                    targetLabel = 'é»ƒé‡‘æ™‚æ®µå‰©é¤˜';
                    statusIcon = 'ğŸ”¥';
                    statusText = 'æœ€ä½³æ—¥å‡ºç‡’å¤©æ‹æ”æ™‚é–“ï¼';
                    photoAdvice = getPhotoAdvice('golden_hour_sunrise', currentBurnskyScore);
                } else {
                    // æ—¥å‡ºå·²é
                    targetTime = new Date(todaySunrise.getTime() + 24 * 60 * 60 * 1000);
                    targetLabel = 'è·é›¢æ˜æ—¥æ—¥å‡º';
                    statusIcon = 'â˜€ï¸';
                    statusText = 'ä»Šæ—¥æ—¥å‡ºå·²é';
                    photoAdvice = getPhotoAdvice('after_sunrise', currentBurnskyScore);
                }
            } else {
                // æ—¥è½æ¨¡å¼ï¼ˆé è¨­ï¼‰
                if (hkNow < goldenHourSunset) {
                    // é‚„æœªåˆ°é»ƒé‡‘æ™‚æ®µ
                    if (hkNow >= new Date(goldenHourSunset.getTime() - 60 * 60 * 1000)) {
                        // é»ƒé‡‘æ™‚æ®µå‰1å°æ™‚å…§
                        statusIcon = 'ğŸ¯';
                        statusText = 'å³å°‡é€²å…¥æœ€ä½³æ‹æ”æ™‚é–“';
                    } else {
                        statusIcon = 'â³';
                        statusText = 'ç­‰å¾…é»ƒé‡‘æ™‚æ®µ';
                    }
                    targetTime = goldenHourSunset;
                    targetLabel = 'è·é›¢é»ƒé‡‘æ™‚æ®µ';
                    photoAdvice = getPhotoAdvice('before_sunset', currentBurnskyScore);
                } else if (hkNow < todaySunset) {
                    // é»ƒé‡‘æ™‚æ®µä¸­ï¼
                    isGoldenHour = true;
                    targetTime = todaySunset;
                    targetLabel = 'é»ƒé‡‘æ™‚æ®µå‰©é¤˜';
                    statusIcon = 'ğŸ”¥';
                    statusText = 'ç¾åœ¨æ˜¯æœ€ä½³ç‡’å¤©æ‹æ”æ™‚é–“ï¼';
                    photoAdvice = getPhotoAdvice('golden_hour_sunset', currentBurnskyScore);
                } else if (hkNow < new Date(todaySunset.getTime() + 30 * 60 * 1000)) {
                    // æ—¥è½å¾Œ30åˆ†é˜å…§ï¼ˆé¤˜æš‰æœŸï¼‰
                    isGoldenHour = true;
                    targetTime = new Date(todaySunset.getTime() + 30 * 60 * 1000);
                    targetLabel = 'é¤˜æš‰æ™‚æ®µå‰©é¤˜';
                    statusIcon = 'ğŸŒ†';
                    statusText = 'æŠŠæ¡é¤˜æš‰æœ€å¾Œæ™‚åˆ»ï¼';
                    photoAdvice = getPhotoAdvice('afterglow', currentBurnskyScore);
                } else {
                    // æ—¥è½å·²é
                    const tomorrowSunset = new Date(todaySunset.getTime() + 24 * 60 * 60 * 1000);
                    const tomorrowGoldenHour = new Date(tomorrowSunset.getTime() - 40 * 60 * 1000);
                    targetTime = tomorrowGoldenHour;
                    targetLabel = 'è·é›¢æ˜æ—¥é»ƒé‡‘æ™‚æ®µ';
                    statusIcon = 'ğŸŒ™';
                    statusText = 'ä»Šæ—¥æ—¥è½å·²éï¼Œæ˜å¤©ç¹¼çºŒ';
                    photoAdvice = getPhotoAdvice('after_sunset', currentBurnskyScore);
                }
            }
            
            // è¨ˆç®—å‰©é¤˜æ™‚é–“
            const diff = targetTime - hkNow;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            // æ ¼å¼åŒ–æ™‚é–“
            const timeStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // æ›´æ–° DOM
            document.getElementById('countdownLabel').textContent = targetLabel;
            
            const timerElement = document.getElementById('countdownTimer');
            timerElement.textContent = timeStr;
            
            // æ·»åŠ é–ƒçˆå‹•ç•«æ•ˆæœ
            if (seconds === 0) {
                timerElement.classList.add('countdown-tick');
                setTimeout(() => timerElement.classList.remove('countdown-tick'), 300);
            }
            
            document.getElementById('statusIcon').textContent = statusIcon;
            document.getElementById('statusText').textContent = statusText;
            document.getElementById('photoAdviceText').textContent = photoAdvice;
            
            // æ›´æ–°å¡ç‰‡æ¨£å¼ï¼ˆé»ƒé‡‘æ™‚æ®µç‰¹æ•ˆï¼‰
            const card = document.querySelector('.sun-countdown-card');
            if (isGoldenHour) {
                card.classList.add('golden-hour-active');
            } else {
                card.classList.remove('golden-hour-active');
            }
        }
        
        /**
         * æ ¹æ“šæƒ…å¢ƒå’Œåˆ†æ•¸ç”Ÿæˆæ‹æ”å»ºè­°
         */
        function getPhotoAdvice(situation, score) {
            const advices = {
                before_sunrise: {
                    high: 'é«˜æ©Ÿç‡ç‡’å¤©ï¼å»ºè­°æå‰30åˆ†é˜åˆ°é”æ‹æ”åœ°é»ï¼Œæº–å‚™å¥½å™¨æ',
                    medium: 'æœ‰æ©Ÿæœƒå‡ºç¾ç‡’å¤©ï¼Œå¯ä»¥å˜—è©¦æ—©èµ·æ‹æ”',
                    low: 'ä»Šæ—¥æ—¥å‡ºç‡’å¤©æ©Ÿç‡è¼ƒä½ï¼Œä½†ä»å¯èƒ½æœ‰é©šå–œ'
                },
                golden_hour_sunrise: {
                    high: 'ğŸ”¥ ç¾åœ¨æ˜¯æœ€ä½³æ‹æ”æ™‚æ©Ÿï¼å¿«æ•æ‰é€™ç¾éº—ç¬é–“ï¼',
                    medium: 'é»ƒé‡‘æ™‚æ®µé€²è¡Œä¸­ï¼Œç•™æ„å¤©ç©ºè®ŠåŒ–',
                    low: 'æŒçºŒè§€å¯Ÿï¼Œæˆ–è¨±æœƒæœ‰æ„å¤–æ”¶ç©«'
                },
                after_sunrise: {
                    high: 'ä»Šæ—¥æœ‰é«˜æ©Ÿç‡ç‡’å¤©ï¼Œå¯é—œæ³¨æ—¥è½æ™‚æ®µ',
                    medium: 'ä»Šæ—¥å¤©æ°£é©ä¸­ï¼Œæ—¥è½å¯èƒ½æœ‰ç‡’å¤©',
                    low: 'æ˜æ—¥æ—¥å‡ºå†è¦‹ï¼'
                },
                before_sunset: {
                    high: 'é«˜æ©Ÿç‡ç‡’å¤©ï¼å»ºè­°æå‰40åˆ†é˜åˆ°é”æœ€ä½³æ‹æ”åœ°é»',
                    medium: 'æœ‰ç‡’å¤©æ©Ÿæœƒï¼Œå»ºè­°æº–å‚™ç›¸æ©Ÿå¾…å‘½',
                    low: 'æ©Ÿç‡è¼ƒä½ï¼Œä½†å¤©æ°£ç¬æ¯è¬è®Šï¼Œå¯æŒçºŒè§€å¯Ÿ'
                },
                golden_hour_sunset: {
                    high: 'ğŸ”¥ çµ•ä½³ç‡’å¤©æ™‚åˆ»ï¼æŠŠæ¡æ¯ä¸€ç§’ï¼',
                    medium: 'âš¡ ç•™æ„å¤©ç©ºé¡è‰²è®ŠåŒ–ï¼Œéš¨æ™‚æº–å‚™æ‹æ”',
                    low: 'ğŸ² ç¢°ç¢°é‹æ°£ï¼Œèªªä¸å®šæœ‰é©šå–œï¼'
                },
                afterglow: {
                    high: 'âœ¨ é¤˜æš‰ä¾ç„¶ç²¾å½©ï¼Œç¹¼çºŒæ‹æ”ï¼',
                    medium: 'é¤˜æš‰æ¼¸é€€ï¼Œå¯å˜—è©¦é•·æ›å…‰',
                    low: 'å¤•é™½è¥¿ä¸‹ï¼Œæ˜æ—¥å†ä¾†'
                },
                after_sunset: {
                    high: 'æ˜æ—¥ç‡’å¤©æ©Ÿç‡ä¾ç„¶é«˜ï¼Œè¨˜å¾—è¨­å¥½é¬§é˜ï¼',
                    medium: 'ä»Šæ—¥ç²¾å½©çµæŸï¼Œæ˜æ—¥ç¹¼çºŒé—œæ³¨',
                    low: 'å¥½å¥½ä¼‘æ¯ï¼Œæ˜å¤©å†çœ‹å¤©æ°£'
                }
            };
            
            const level = score >= 65 ? 'high' : (score >= 40 ? 'medium' : 'low');
            return advices[situation]?.[level] || 'æŒçºŒé—œæ³¨å¤©æ°£è®ŠåŒ–';
        }
        
        // é é¢å¸è¼‰æ™‚æ¸…ç†è¨ˆæ™‚å™¨
        window.addEventListener('beforeunload', function() {
            if (sunCountdownInterval) {
                clearInterval(sunCountdownInterval);
            }
        });

        // ==================== API å·¥å…·å‡½æ•¸ ====================
        // çµ±ä¸€çš„APIè¼‰å…¥å’ŒéŒ¯èª¤è™•ç†å·¥å…·
        const APIUtils = {
            // Toast é€šçŸ¥å®¹å™¨
            toastContainer: null,
            
            // åˆå§‹åŒ–Toastå®¹å™¨
            initToastContainer() {
                if (!this.toastContainer) {
                    this.toastContainer = document.createElement('div');
                    this.toastContainer.className = 'toast-container';
                    document.body.appendChild(this.toastContainer);
                }
            },
            
            // é¡¯ç¤ºToasté€šçŸ¥
            showToast(message, type = 'info', duration = 5000) {
                this.initToastContainer();
                
                const icons = {
                    error: 'âŒ',
                    success: 'âœ…',
                    info: 'â„¹ï¸',
                    warning: 'âš ï¸'
                };
                
                const titles = {
                    error: 'éŒ¯èª¤',
                    success: 'æˆåŠŸ',
                    info: 'æç¤º',
                    warning: 'è­¦å‘Š'
                };
                
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="toast-icon">${icons[type] || icons.info}</div>
                    <div class="toast-content">
                        <div class="toast-title">${titles[type] || titles.info}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <div class="toast-close" onclick="this.parentElement.remove()">Ã—</div>
                `;
                
                this.toastContainer.appendChild(toast);
                
                // è‡ªå‹•ç§»é™¤
                setTimeout(() => {
                    toast.classList.add('hiding');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            },
            
            // å…¨å±€è¼‰å…¥ç‹€æ…‹
            loadingOverlay: null,
            loadingCount: 0,
            
            // é¡¯ç¤ºå…¨å±€è¼‰å…¥
            showGlobalLoading(message = 'æ­£åœ¨è¼‰å…¥æ•¸æ“š...') {
                if (!this.loadingOverlay) {
                    this.loadingOverlay = document.createElement('div');
                    this.loadingOverlay.className = 'global-loading-overlay';
                    this.loadingOverlay.innerHTML = `
                        <div class="global-loading-content">
                            <div class="loading-spinner"></div>
                            <div class="loading-text">${message}</div>
                            <div class="loading-progress" id="loadingProgress"></div>
                        </div>
                    `;
                    document.body.appendChild(this.loadingOverlay);
                }
                
                this.loadingCount++;
                this.loadingOverlay.classList.add('active');
            },
            
            // éš±è—å…¨å±€è¼‰å…¥
            hideGlobalLoading() {
                this.loadingCount = Math.max(0, this.loadingCount - 1);
                if (this.loadingCount === 0 && this.loadingOverlay) {
                    this.loadingOverlay.classList.remove('active');
                }
            },
            
            // æ›´æ–°è¼‰å…¥é€²åº¦
            updateLoadingProgress(current, total) {
                const progressEl = document.getElementById('loadingProgress');
                if (progressEl) {
                    progressEl.textContent = `è¼‰å…¥ä¸­ ${current}/${total}`;
                }
            },
            
            // çµ±ä¸€çš„APIè«‹æ±‚è™•ç†
            async fetchAPI(url, options = {}) {
                const defaultOptions = {
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                };
                
                try {
                    const response = await fetch(url, { ...defaultOptions, ...options });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error(`APIè«‹æ±‚å¤±æ•— (${url}):`, error);
                    throw error;
                }
            },
            
            // ä¸¦è¡Œè¼‰å…¥å¤šå€‹API
            async loadParallel(requests) {
                const results = await Promise.allSettled(requests.map(req => {
                    if (typeof req === 'function') {
                        return req();
                    }
                    return this.fetchAPI(req.url, req.options);
                }));
                
                return results.map((result, index) => {
                    if (result.status === 'fulfilled') {
                        return { success: true, data: result.value };
                    } else {
                        const reqInfo = requests[index];
                        const url = typeof reqInfo === 'function' ? 'å‡½æ•¸è«‹æ±‚' : reqInfo.url;
                        console.error(`è«‹æ±‚å¤±æ•— (${url}):`, result.reason);
                        return { success: false, error: result.reason };
                    }
                });
            }
        };

        /**
         * ğŸŒ… æ ¹æ“šç•¶å‰æ™‚é–“å’Œå¤©æ–‡å°æ—¥å‡ºæ—¥è½æ™‚é–“è‡ªå‹•åˆ¤æ–·æ‡‰è©²é æ¸¬æ—¥å‡ºé‚„æ˜¯æ—¥è½
         * - æ—¥è½å¾Œ30åˆ†é˜ ~ éš”æ—¥æ—¥å‡ºå¾Œ30åˆ†é˜ï¼šé æ¸¬æ—¥å‡º
         * - å…¶ä»–æ™‚é–“ï¼šé æ¸¬æ—¥è½
         */
        let cachedSunTimes = null;
        
        async function fetchSunTimes() {
            try {
                const response = await fetch('/api/sun-times');
                if (response.ok) {
                    const data = await response.json();
                    cachedSunTimes = data;
                    console.log('ğŸŒ… å¾å¤©æ–‡å°ç²å–æ—¥å‡ºæ—¥è½æ™‚é–“:', data);
                    return data;
                }
            } catch (e) {
                console.warn('ç„¡æ³•ç²å–æ—¥å‡ºæ—¥è½æ™‚é–“ï¼Œä½¿ç”¨ä¼°ç®—å€¼');
            }
            return null;
        }
        
        function getAutoPredictionType() {
            const now = new Date();
            const hkNow = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Hong_Kong' }));
            const currentHour = hkNow.getHours();
            const currentMinute = hkNow.getMinutes();
            const currentTimeMinutes = currentHour * 60 + currentMinute;
            
            // å¦‚æœæœ‰å¤©æ–‡å°æ•¸æ“šï¼Œä½¿ç”¨ç²¾ç¢ºæ™‚é–“
            if (cachedSunTimes && cachedSunTimes.sunset && cachedSunTimes.sunrise) {
                const [sunsetH, sunsetM] = cachedSunTimes.sunset.split(':').map(Number);
                const [sunriseH, sunriseM] = cachedSunTimes.sunrise.split(':').map(Number);
                
                const sunsetMinutes = sunsetH * 60 + sunsetM;
                const sunriseMinutes = sunriseH * 60 + sunriseM;
                
                // æ—¥è½å¾Œ30åˆ†é˜ ~ éš”æ—¥æ—¥å‡ºå¾Œ30åˆ†é˜ = é æ¸¬æ—¥å‡º
                // å³ï¼šcurrentTime > sunset+30 OR currentTime < sunrise+30
                const sunsetThreshold = sunsetMinutes + 30;
                const sunriseThreshold = sunriseMinutes + 30;
                
                if (currentTimeMinutes > sunsetThreshold || currentTimeMinutes < sunriseThreshold) {
                    return 'sunrise';
                }
                return 'sunset';
            }
            
            // å‚™ç”¨ï¼šç°¡å–®ä¼°ç®—
            const month = hkNow.getMonth() + 1;
            let sunsetHour = 18;
            if (month >= 5 && month <= 8) sunsetHour = 19;
            else if (month >= 11 || month <= 2) sunsetHour = 17;
            
            let sunriseHour = 6;
            if (month >= 5 && month <= 8) sunriseHour = 5;
            
            if (currentHour >= sunsetHour + 1 || currentHour < sunriseHour + 1) {
                return 'sunrise';
            }
            return 'sunset';
        }
        
        /**
         * ğŸ”„ åˆå§‹åŒ–æ™‚è‡ªå‹•è¨­ç½®é æ¸¬é¡å‹ï¼ˆå…ˆç²å–å¤©æ–‡å°æ™‚é–“ï¼‰
         */
        async function initAutoPredictionType() {
            // å…ˆå˜—è©¦ç²å–å¤©æ–‡å°æ—¥å‡ºæ—¥è½æ™‚é–“
            if (!cachedSunTimes) {
                await fetchSunTimes();
            }
            
            const predictionTypeElement = document.getElementById('predictionType');
            if (predictionTypeElement) {
                const autoType = getAutoPredictionType();
                predictionTypeElement.value = autoType;
                
                const sunInfo = cachedSunTimes 
                    ? `(æ—¥å‡º:${cachedSunTimes.sunrise} æ—¥è½:${cachedSunTimes.sunset})`
                    : '(ä¼°ç®—)';
                console.log(`ğŸŒ… è‡ªå‹•åˆ‡æ›é æ¸¬é¡å‹: ${autoType === 'sunrise' ? 'æ—¥å‡º' : 'æ—¥è½'} ${sunInfo}`);
            }
        }

        async function loadPrediction() {
            const loading = document.getElementById('loading');
            const content = document.getElementById('content');
            
            // ç²å–é æ¸¬é¸é …
            const predictionTypeElement = document.getElementById('predictionType');
            const advanceHoursElement = document.getElementById('advanceHours');
            
            const predictionType = predictionTypeElement ? predictionTypeElement.value : 'general';
            const advanceHours = advanceHoursElement ? advanceHoursElement.value : '0';
            
            loading.style.display = 'block';
            content.style.display = 'none';
            
            try {
                // æ ¹æ“šé æ¸¬é¡å‹é¸æ“‡ API ç«¯é»
                let apiUrl = '/predict';
                const cacheBuster = Date.now(); // é˜²æ­¢ç·©å­˜
                if (predictionType === 'sunrise') {
                    apiUrl = `/predict/sunrise?advance_hours=${advanceHours}&_=${cacheBuster}`;
                } else if (predictionType === 'sunset') {
                    apiUrl = `/predict/sunset?advance_hours=${advanceHours}&_=${cacheBuster}`;
                } else {
                    // é è¨­ä½¿ç”¨é€šç”¨é æ¸¬ç«¯é»
                    apiUrl = `/predict?advance=${advanceHours}&_=${cacheBuster}`;
                }
                
                const data = await APIUtils.fetchAPI(apiUrl);
                
                // å¦‚æœå°ç…§è¡¨å·²å±•é–‹ï¼Œæ›´æ–°é«˜äº®
                const scoreReferenceContent = document.getElementById('scoreReferenceContent');
                if (scoreReferenceContent && scoreReferenceContent.style.display === 'block') {
                    setTimeout(() => {
                        highlightCurrentScoreRange();
                    }, 100);
                }
                
                // æ›´æ–°é æ¸¬ç­‰ç´š
                const levelElement = document.getElementById('predictionLevel');
                levelElement.textContent = data.prediction_level;
                
                // è¨­ç½®ç­‰ç´šæ¨£å¼
                levelElement.className = 'prediction-level';
                if (data.burnsky_score >= 70) {
                    levelElement.classList.add('level-high');
                } else if (data.burnsky_score >= 40) {
                    levelElement.classList.add('level-medium');
                } else {
                    levelElement.classList.add('level-low');
                }
                
                // ğŸ”¥ æ›´æ–°ç‡’å¤©é€²åº¦æ¢
                updateBurnskyProgress(data.burnsky_score, data.prediction_level);
                
                // æ›´æ–°æ©Ÿç‡
                let probabilityText = `é æ¸¬æ©Ÿç‡: ${data.probability}`;
                
                // å¦‚æœæœ‰æå‰é æ¸¬ï¼Œé¡¯ç¤ºå¤©æ°£æ•¸æ“šä¾†æº
                if (data.advance_hours > 0) {
                    if (data.original_weather_data) {
                        probabilityText += ` <span style="color: #007acc; font-size: 0.85em;">ğŸ”® ä½¿ç”¨${data.advance_hours}å°æ™‚å¾Œæ¨ç®—æ•¸æ“š</span>`;
                    } else {
                        probabilityText += ` <span style="color: #28a745; font-size: 0.85em;">â° ${data.advance_hours}å°æ™‚æå‰é æ¸¬</span>`;
                    }
                }
                
                document.getElementById('probability').innerHTML = probabilityText;
                
                // æ›´æ–°åˆ†æå› å­
                updateAnalysisFactors(data.analysis_details);
                
                // æ›´æ–°å³æ™‚å¤©æ°£è­¦å‘Š
                updateCurrentWarnings(data.analysis_details);
                
                // æ›´æ–°å¤©æ°£æ•¸æ“š
                updateWeatherData(data.weather_data);
                
                // æ›´æ–°ç©ºæ°£å“è³ªæ•¸æ“š
                if (data.analysis_details && data.analysis_details.air_quality_factor) {
                    updateAirQualityData(data.analysis_details.air_quality_factor);
                }
                
                // æ›´æ–°åˆ†ææ‘˜è¦ - ä¿®å¾©æ•¸æ“šè·¯å¾‘
                updateAnalysisSummary(data.analysis_summary || (data.analysis_details && data.analysis_details.analysis_summary));
                
                // æ›´æ–°æ™‚é–“ - å¼·åˆ¶ä½¿ç”¨é¦™æ¸¯æ™‚å€
                document.getElementById('lastUpdated').textContent = 
                    `æœ€å¾Œæ›´æ–°: ${getHongKongTime()} (é¦™æ¸¯æ™‚é–“)`;
                
                // ğŸŒ… æ›´æ–°æ—¥å‡ºæ—¥è½å€’æ•¸è¨ˆæ™‚å™¨
                if (data.sun_times) {
                    updateSunCountdown(data.sun_times, data.prediction_type, data.burnsky_score);
                }
                
                // ä¿å­˜é æ¸¬åˆ†æ•¸ä»¥ä¾›ç”¨æˆ¶åé¥‹ä½¿ç”¨
                currentPredictedScore = data.burnsky_score;
                currentPredictionTimestamp = new Date().toISOString();
                console.log('âœ… é æ¸¬åˆ†æ•¸å·²ä¿å­˜:', {
                    score: currentPredictedScore,
                    timestamp: currentPredictionTimestamp,
                    level: data.prediction_level
                });
                
                loading.style.display = 'none';
                content.style.display = 'block';
                
                // ğŸ“· è¼‰å…¥ Webcam é è¦½
                loadWebcamPreview();
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥é æ¸¬æ•¸æ“šå¤±æ•—:', error);
                APIUtils.showToast('ç„¡æ³•è¼‰å…¥é æ¸¬æ•¸æ“šï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥', 'error');
                
                loading.innerHTML = `
                    <div style="color: #ff6b6b;">
                        <h3>è¼‰å…¥å¤±æ•—</h3>
                        <p>ç„¡æ³•å–å¾—é æ¸¬æ•¸æ“šï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥æˆ–ç¨å¾Œå†è©¦</p>
                        <button class="refresh-btn" onclick="loadPrediction()" style="margin-top: 15px;">
                            ğŸ”„ é‡æ–°è¼‰å…¥
                        </button>
                    </div>
                `;
                throw error; // é‡æ–°æ‹‹å‡ºéŒ¯èª¤ä»¥ä¾¿ä¸Šå±¤è™•ç†
            }
        }

        function updateAnalysisFactors(details) {
            const grid = document.getElementById('analysisGrid');
            grid.innerHTML = '';
            
            if (!details) {
                grid.innerHTML = '<p style="text-align: center; color: #666;">æš«ç„¡åˆ†æå› å­æ•¸æ“š</p>';
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºç°¡åŒ–çš„æ¸¬è©¦æ•¸æ“šæ ¼å¼
            if (Array.isArray(details)) {
                // ç°¡åŒ–æ•¸æ“šæ ¼å¼ (æ¸¬è©¦æœå‹™å™¨)
                details.forEach(factor => {
                    if (factor.factor && factor.score !== undefined) {
                        const factorCard = document.createElement('div');
                        factorCard.className = 'factor-card';
                        factorCard.style.cssText = `
                            background: white;
                            border-radius: 16px;
                            padding: 20px;
                            margin-bottom: 15px;
                            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                            transition: all 0.3s ease;
                            position: relative;
                            overflow: hidden;
                        `;
                        
                        let impactIcon = 'ğŸ“Š';
                        if (factor.impact === 'positive') impactIcon = 'âœ…';
                        else if (factor.impact === 'negative') impactIcon = 'âš ï¸';
                        
                        let scoreColor = '#48dbfb';
                        if (factor.score >= 80) scoreColor = '#ff6b6b';
                        else if (factor.score >= 60) scoreColor = '#feca57';
                        
                        factorCard.innerHTML = `
                            <div class="factor-header">
                                <div class="factor-name">${impactIcon} ${factor.factor}</div>
                                <div class="factor-score" style="background: ${scoreColor};">${factor.score}</div>
                            </div>
                            <div class="factor-description" style="
                                color: #666;
                                line-height: 1.6;
                                font-size: 0.95rem;
                                margin-top: 10px;
                            ">
                                ${factor.description || 'ç„¡è©³ç´°èªªæ˜'}
                            </div>
                        `;
                        
                        grid.appendChild(factorCard);
                    }
                });
                return;
            }
            
            // åŸæœ‰çš„è¤‡é›œæ•¸æ“šæ ¼å¼è™•ç†
            const factorNames = {
                'time_factor': { 
                    name: 'å¯¦æ™‚æ™‚é–“å› å­', 
                    icon: 'ğŸŒ…', 
                    maxScore: 18,
                    explanation: 'åŸºæ–¼çœŸå¯¦æ—¥å‡º/æ—¥è½æ™‚é–“è©•åˆ†ï¼ˆ12%æ¬Šé‡ï¼‰ï¼šé»ƒé‡‘30åˆ†é˜å…§ï¼ˆ15-18åˆ†ï¼‰ã€1å°æ™‚å…§ï¼ˆ12åˆ†ï¼‰ã€2å°æ™‚å…§ï¼ˆ8åˆ†ï¼‰ã€å…¶ä»–æ™‚æ®µï¼ˆ4åˆ†ï¼‰'
                },
                'temperature_factor': { 
                    name: 'æº«åº¦å› å­', 
                    icon: 'ğŸŒ¡ï¸', 
                    maxScore: 15,
                    explanation: 'å½±éŸ¿ç‡’å¤©é¡è‰²é£½å’Œåº¦ï¼ˆ10%æ¬Šé‡ï¼‰ï¼šç†æƒ³26-31Â°Cï¼ˆ15åˆ†ï¼‰ã€è‰¯å¥½24-33Â°Cï¼ˆ12åˆ†ï¼‰ã€å¯æ¥å—20-35Â°Cï¼ˆ7åˆ†ï¼‰ã€é‚Šç·£15-38Â°Cï¼ˆ3åˆ†ï¼‰'
                },
                'humidity_factor': { 
                    name: 'æ¿•åº¦å› å­', 
                    icon: 'ğŸ’§', 
                    maxScore: 20,
                    explanation: 'å½±éŸ¿å¤§æ°£å±¤é¡è‰²ï¼ˆ13.3%æ¬Šé‡ï¼‰ï¼šç†æƒ³55-70%ï¼ˆ20åˆ†ï¼‰ã€è‰¯å¥½50-75%ï¼ˆ16åˆ†ï¼‰ã€å¯æ¥å—45-80%ï¼ˆ12åˆ†ï¼‰ã€é‚Šç·£40-85%ï¼ˆ7åˆ†ï¼‰ã€æ¥µç«¯<40%æˆ–>85%ï¼ˆ3åˆ†ï¼‰'
                },
                'visibility_factor': { 
                    name: 'èƒ½è¦‹åº¦å› å­', 
                    icon: 'ğŸ‘ï¸', 
                    maxScore: 20,
                    explanation: 'å½±éŸ¿æ‹æ”æ¸…æ™°åº¦ï¼ˆ13.3%æ¬Šé‡ï¼‰ï¼šç„¡é™é›¨ï¼ˆ20åˆ†ï¼‰ã€æ¥µè¼•å¾®<2mmï¼ˆ15åˆ†ï¼‰ã€è¼•å¾®<5mmï¼ˆ10åˆ†ï¼‰ã€ä¸­åº¦<10mmï¼ˆ6åˆ†ï¼‰ã€å¤§é›¨<20mmï¼ˆ3åˆ†ï¼‰ã€æš´é›¨â‰¥20mmï¼ˆ1åˆ†ï¼‰'
                },
                'cloud_analysis_factor': { 
                    name: 'é›²å±¤åˆ†æå› å­', 
                    icon: 'â˜ï¸', 
                    maxScore: 35,
                    explanation: 'æœ€é—œéµå› å­ï¼ˆ23.3%æ¬Šé‡ï¼‰ï¼å·²ä¿®æ­£é‚è¼¯ï¼šéƒ¨åˆ†æœ‰é™½å…‰ï¼ˆ35åˆ†ï¼‰ã€çŸ­æš«æœ‰é™½å…‰ï¼ˆ32åˆ†ï¼‰ã€å¤§è‡´å¤šé›²ï¼ˆ28åˆ†ï¼‰ã€å¤šé›²ï¼ˆ25åˆ†ï¼‰ã€å¤§è‡´å¤©æ™´ï¼ˆ18åˆ†ï¼‰ã€å¯†é›²/é™°å¤©ï¼ˆ12åˆ†ï¼‰ã€å¤©æ™´/æ™´æœ—ï¼ˆ3åˆ†ï¼‰â—ï¸ç„¡é›²=ç„¡ç‡’å¤©'
                },
                'uv_factor': { 
                    name: 'UVæŒ‡æ•¸å› å­', 
                    icon: 'â˜€ï¸', 
                    maxScore: 2,
                    explanation: 'åƒ…ä¾›åƒè€ƒï¼ˆ1.3%æ¬Šé‡ï¼‰ï¼šUVâ‰¥5ï¼ˆ2åˆ†ï¼‰ã€3-4ï¼ˆ1.5åˆ†ï¼‰ã€1-2ï¼ˆ1åˆ†ï¼‰ã€<1ï¼ˆ0.5åˆ†ï¼‰ã€‚UVä¸æ˜¯ç‡’å¤©æ±ºå®šæ€§å› ç´ ï¼Œåƒ…ä½œç‚ºé™½å…‰å¼·åº¦åƒè€ƒ'
                },
                'wind_factor': { 
                    name: 'é¢¨é€Ÿå› å­', 
                    icon: 'ğŸ’¨', 
                    maxScore: 15,
                    explanation: 'å½±éŸ¿é›²å±¤æ“´æ•£ï¼ˆ10%æ¬Šé‡ï¼‰ï¼šç†æƒ³6-12km/hï¼ˆ15åˆ†ï¼‰ã€è‰¯å¥½4-16km/hï¼ˆ12åˆ†ï¼‰ã€å¯æ¥å—2-20km/hï¼ˆ9åˆ†ï¼‰ã€åå¤§â‰¤25km/hï¼ˆ5åˆ†ï¼‰ã€å¼·é¢¨â‰¤30km/hï¼ˆ2åˆ†ï¼‰ã€çƒˆé¢¨>30km/hï¼ˆ1åˆ†ï¼‰ã€‚é©åº¦é¢¨é€Ÿæœ‰åŠ©é›²å±¤å½¢æ…‹è®ŠåŒ–'
                },
                'air_quality_factor': { 
                    name: 'ç©ºæ°£å“è³ªå› å­', 
                    icon: 'ğŸŒ«ï¸', 
                    maxScore: 15,
                    explanation: 'å½±éŸ¿è‰²å½©æ¸…æ™°åº¦ï¼ˆ10%æ¬Šé‡ï¼‰ï¼šå„ªè‰¯AQHIâ‰¤3ï¼ˆ15åˆ†ï¼‰ã€è‰¯å¥½â‰¤6ï¼ˆ12åˆ†ï¼‰ã€ä¸€èˆ¬â‰¤7ï¼ˆ8åˆ†ï¼‰ã€ä¸ä½³â‰¤10ï¼ˆ5åˆ†ï¼‰ã€æ¥µå·®>10ï¼ˆ2åˆ†ï¼‰ã€‚ç©ºæ°£è¶Šæ¸…æ¾ˆï¼Œç‡’å¤©è‰²å½©è¶Šé®®è±”'
                }
            };
            
            // æ‰‹æ©Ÿç‰ˆé»æ“Šåˆ‡æ›åŠŸèƒ½
            function addMobileToggle(card) {
                if (window.innerWidth <= 768) {
                    card.addEventListener('click', function() {
                        this.classList.toggle('expanded');
                    });
                }
            }
            
            // æ·»åŠ è©•åˆ†åˆ†è§£å¡ç‰‡
            if (details.score_breakdown) {
                const breakdown = details.score_breakdown;
                const card = document.createElement('div');
                card.className = 'factor-card';
                card.style.borderLeft = '4px solid #ff6b6b';
                card.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            ğŸ¤– AIæ™ºèƒ½åˆ†æ <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score">${Math.round(breakdown.final_weighted_score)}åˆ†</div>
                    </div>
                    <div class="factor-description">
                        å‚³çµ±ç®—æ³•: ${Math.round(breakdown.traditional_normalized || breakdown.traditional_score)}åˆ†<br>
                        æ©Ÿå™¨å­¸ç¿’: ${Math.round(breakdown.ml_score)}åˆ†<br>
                        åŠ æ¬Šçµæœ: ${Math.round(breakdown.final_weighted_score)}åˆ†<br>
                        ${breakdown.weight_explanation ? `<small style="color: #007acc; font-weight: 500;">ğŸ’¡ ${breakdown.weight_explanation}</small><br>` : ''}
                        <small style="color: #888; font-style: italic;">ğŸ“Š çµåˆå‚³çµ±å¤©æ°£åˆ†æèˆ‡AIæ©Ÿå™¨å­¸ç¿’çš„æ™ºèƒ½ç¶œåˆè©•åˆ†ï¼Œæå‰1-2å°æ™‚é æ¸¬ç‚ºé»ƒé‡‘æ™‚æ®µ(AI 65%æ¬Šé‡)ï¼Œå³æ™‚é æ¸¬æ™‚AI 55%æ¬Šé‡</small>
                    </div>
                `;
                addMobileToggle(card);
                grid.appendChild(card);
            }
            
            for (const [key, value] of Object.entries(details)) {
                if (factorNames[key] && value.description) {
                    const card = document.createElement('div');
                    card.className = 'factor-card';
                    
                    // ç‰¹æ®Šè™•ç†æ™‚é–“å› å­
                    if (key === 'time_factor') {
                        card.innerHTML = `
                            <div class="factor-header">
                                <div class="factor-name">
                                    ${factorNames[key].icon} ${factorNames[key].name} <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                                </div>
                                <div class="factor-score">${value.score}/${value.max_score || factorNames[key].maxScore}åˆ†</div>
                            </div>
                            <div class="factor-description">
                                ${value.description}<br>
                                <small>ç•¶å‰æ™‚é–“: ${value.current_time} | ${value.target_type}æ™‚é–“: ${value.target_time}</small>
                                ${value.advance_hours > 0 ? `<br><small>æå‰é æ¸¬: ${value.advance_hours}å°æ™‚</small>` : ''}
                                <br><small style="color: #888; font-style: italic;">ğŸ“Š ${factorNames[key].explanation}</small>
                            </div>
                        `;
                    }
                    // ç‰¹æ®Šè™•ç†é›²å±¤åˆ†æå› å­
                    else if (key === 'cloud_analysis_factor') {
                        let cloudInfo = '';
                        if (value.detected_types && value.detected_types.length > 0) {
                            cloudInfo = '<br><small>æª¢æ¸¬åˆ°: ' + value.detected_types.map(t => t.type).join(', ') + '</small>';
                        }
                        if (value.favorable_conditions && value.favorable_conditions.length > 0) {
                            cloudInfo += '<br><small style="color: green;">æœ‰åˆ©: ' + value.favorable_conditions.join(', ') + '</small>';
                        }
                        if (value.unfavorable_conditions && value.unfavorable_conditions.length > 0) {
                            cloudInfo += '<br><small style="color: red;">ä¸åˆ©: ' + value.unfavorable_conditions.join(', ') + '</small>';
                        }
                        
                        card.innerHTML = `
                            <div class="factor-header">
                                <div class="factor-name">
                                    ${factorNames[key].icon} ${factorNames[key].name} <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                                </div>
                                <div class="factor-score">${value.score}/${value.max_score || factorNames[key].maxScore}åˆ†</div>
                            </div>
                            <div class="factor-description">
                                ${value.description}${cloudInfo}
                                <br><small style="color: #888; font-style: italic;">ğŸ“Š ${factorNames[key].explanation}</small>
                            </div>
                        `;
                    }
                    else {
                        card.innerHTML = `
                            <div class="factor-header">
                                <div class="factor-name">
                                    ${factorNames[key].icon} ${factorNames[key].name} <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                                </div>
                                <div class="factor-score">${value.score}/${value.max_score || factorNames[key].maxScore}åˆ†</div>
                            </div>
                            <div class="factor-description">
                                ${value.description}
                                <br><small style="color: #888; font-style: italic;">ğŸ“Š ${factorNames[key].explanation}</small>
                            </div>
                        `;
                    }
                    addMobileToggle(card);
                    grid.appendChild(card);
                }
            }
            
            // æ·»åŠ æ©Ÿå™¨å­¸ç¿’é æ¸¬å¡ç‰‡
            if (details.ml_prediction && details.ml_prediction.ml_burnsky_score) {
                const mlCard = document.createElement('div');
                mlCard.className = 'factor-card';
                mlCard.style.borderLeft = '4px solid #764ba2';
                const ml = details.ml_prediction;
                mlCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            ğŸ§  æ©Ÿå™¨å­¸ç¿’é æ¸¬ <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score">${Math.round(ml.ml_burnsky_score)}åˆ†</div>
                    </div>
                    <div class="factor-description">
                        AIé æ¸¬é¡åˆ¥: ${ml.ml_class === 2 ? 'é«˜æ©Ÿç‡' : ml.ml_class === 1 ? 'ä¸­æ©Ÿç‡' : 'ä½æ©Ÿç‡'}<br>
                        <small>æ©Ÿç‡åˆ†å¸ƒ: ä½=${Math.round(ml.ml_class_probabilities.low * 100)}% | 
                        ä¸­=${Math.round(ml.ml_class_probabilities.medium * 100)}% | 
                        é«˜=${Math.round(ml.ml_class_probabilities.high * 100)}%</small>
                        <br><small style="color: #888; font-style: italic;">ğŸ¤– åŸºæ–¼æ­·å²æ°£è±¡æ•¸æ“šè¨“ç·´çš„æ©Ÿå™¨å­¸ç¿’æ¨¡å‹ï¼Œåˆ†æè¤‡é›œæ°£è±¡æ¨¡å¼é€²è¡Œåˆ†é¡é æ¸¬</small>
                    </div>
                `;
                addMobileToggle(mlCard);
                grid.appendChild(mlCard);
            }
            
            // æ·»åŠ æ©Ÿå™¨å­¸ç¿’ç‰¹å¾µé‡è¦æ€§å¡ç‰‡
            if (details.ml_prediction && details.ml_prediction.feature_importance) {
                const featureCard = document.createElement('div');
                featureCard.className = 'factor-card';
                featureCard.style.borderLeft = '4px solid #6c5ce7';
                const importance = details.ml_prediction.feature_importance;
                
                // æŒ‰é‡è¦æ€§æ’åºå‰5å€‹ç‰¹å¾µ
                const sortedFeatures = Object.entries(importance)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);
                
                const featureList = sortedFeatures.map(([feature, value]) => 
                    `<small>â€¢ ${feature}: ${Math.round(value * 100)}%</small>`
                ).join('<br>');
                
                featureCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            ğŸ¯ AIç‰¹å¾µé‡è¦æ€§ <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score">TOP 5</div>
                    </div>
                    <div class="factor-description">
                        <strong>å½±éŸ¿ç‡’å¤©æ©Ÿç‡çš„é—œéµå› å­ï¼š</strong><br>
                        ${featureList}
                        <br><small style="color: #888; font-style: italic;">ğŸ¯ æ©Ÿå™¨å­¸ç¿’æ¨¡å‹åˆ†æå„æ°£è±¡å› å­å°ç‡’å¤©é æ¸¬çš„è²¢ç»ç¨‹åº¦</small>
                    </div>
                `;
                addMobileToggle(featureCard);
                grid.appendChild(featureCard);
            }
            
            // æ·»åŠ ç‡’å¤©ç¨‹åº¦é æ¸¬å¡ç‰‡
            if (details.intensity_prediction) {
                const intensityCard = document.createElement('div');
                intensityCard.className = 'factor-card';
                intensityCard.style.borderLeft = '4px solid #feca57';
                const intensity = details.intensity_prediction;
                intensityCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            ğŸ”¥ ç‡’å¤©ç¨‹åº¦é æ¸¬ <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score">ç­‰ç´š${intensity.level}</div>
                    </div>
                    <div class="factor-description">
                        <strong>${intensity.name}</strong><br>
                        ${intensity.description}<br>
                        <small>é ä¼°æŒçºŒ: ${intensity.duration_estimate} | èƒ½è¦‹åº¦: ${intensity.visibility}</small><br>
                        <small style="color: #666;">ğŸ“¸ ${intensity.photography_advice}</small>
                        <br><small style="color: #888; font-style: italic;">ğŸ”¥ æ ¹æ“šæ°£è±¡æ¢ä»¶é æ¸¬ç‡’å¤©å¼·åº¦ç­‰ç´šï¼Œè©•ä¼°æœ€ä½³æ‹æ”æ™‚æ©Ÿèˆ‡æ•ˆæœ</small>
                    </div>
                `;
                addMobileToggle(intensityCard);
                grid.appendChild(intensityCard);
            }
            
            // æ·»åŠ å³æ™‚ç›¸ç‰‡äº¤å‰é©—è­‰å¡ç‰‡
            const crossCheckCard = document.createElement('div');
            crossCheckCard.className = 'factor-card';
            crossCheckCard.style.borderLeft = '4px solid #00b894';
            crossCheckCard.innerHTML = `
                <div class="factor-header">
                    <div class="factor-name">
                        ğŸ“· å³æ™‚ç›¸ç‰‡é©—è­‰ <span style="opacity: 0.6; font-size: 0.8em;">ğŸ”„</span>
                    </div>
                    <div class="factor-score" id="crossCheckScore">è¼‰å…¥ä¸­...</div>
                </div>
                <div class="factor-description" id="crossCheckContent">
                    <small style="color: #888;">æ­£åœ¨åˆ†æå¤©æ–‡å°å³æ™‚ç›¸ç‰‡...</small>
                </div>
            `;
            addMobileToggle(crossCheckCard);
            grid.appendChild(crossCheckCard);
            
            // ç•°æ­¥è¼‰å…¥cross checkæ•¸æ“š
            loadCrossCheckData();
            
            // æ·»åŠ é›²å±¤åšåº¦èˆ‡é¡è‰²å¯è¦‹åº¦åˆ†æå¡ç‰‡
            if (details.cloud_visibility_analysis) {
                const cloudVisibilityCard = document.createElement('div');
                cloudVisibilityCard.className = 'factor-card';
                cloudVisibilityCard.style.borderLeft = '4px solid #74b9ff';
                const analysis = details.cloud_visibility_analysis;
                
                // é¡è‰²å¯è¦‹åº¦ç™¾åˆ†æ¯”åœ“ç’°
                const visibilityPercentage = analysis.color_visibility_percentage || 50;
                const visibilityCircle = `
                    <div style="display: inline-block; margin: 10px 0;">
                        <svg width="60" height="60" style="transform: rotate(-90deg);">
                            <circle cx="30" cy="30" r="25" fill="none" stroke="#e1e5e9" stroke-width="5"/>
                            <circle cx="30" cy="30" r="25" fill="none" stroke="${visibilityPercentage >= 70 ? '#00b894' : visibilityPercentage >= 40 ? '#fdcb6e' : '#e17055'}" 
                                stroke-width="5" stroke-dasharray="${visibilityPercentage * 1.57} 157" stroke-linecap="round"/>
                        </svg>
                        <div style="margin-top: 5px; text-align: center; font-size: 0.9rem; font-weight: bold;">
                            ${visibilityPercentage}%<br><small>é¡è‰²å¯è¦‹åº¦</small>
                        </div>
                    </div>
                `;
                
                // æ”å½±å»ºè­°åœ–ç¤º
                const photographyIcon = analysis.photography_type === 'color_focused' ? 'ğŸŒˆ' : 
                                      analysis.photography_type === 'contrast_focused' ? 'ğŸŒ«ï¸' : 
                                      analysis.photography_type === 'silhouette_only' ? 'ğŸ–¤' : 'ğŸ“¸';
                
                // é›²å±¤ç­‰ç´šæè¿°
                const cloudLevelDesc = analysis.cloud_thickness_level === 'clear_to_thin' ? 'â˜€ï¸ æ¸…æ™°è‡³è–„é›²' : 
                                     analysis.cloud_thickness_level === 'moderate' ? 'â›… ä¸­ç­‰é›²é‡' : 
                                     analysis.cloud_thickness_level === 'thick' ? 'â˜ï¸ åšé›²' : 
                                     analysis.cloud_thickness_level === 'very_thick_overcast' ? 'ğŸŒ«ï¸ å¯†é›²' : 'â“ æœªçŸ¥';
                
                // é æœŸæ•ˆæœæè¿°
                const effectDesc = analysis.visibility_type === 'excellent_colors' ? 'ğŸŒˆ çµ•ä½³é¡è‰²ç‡’å¤©' : 
                                 analysis.visibility_type === 'good_colors' ? 'ğŸŒ… è‰¯å¥½é¡è‰²ç‡’å¤©' : 
                                 analysis.visibility_type === 'limited_colors' ? 'ğŸŒ¤ï¸ æœ‰é™é¡è‰²ï¼Œä¸»è¦æ˜æš—' : 
                                 analysis.visibility_type === 'brightness_only' ? 'ğŸŒ† ç´”æ˜æš—è®ŠåŒ–' : 'ğŸ”„ æ··åˆæ•ˆæœ';
                
                // æ”å½±é¡å‹æè¿°
                const photoTypeDesc = analysis.photography_type === 'color_focused' ? 'é¡è‰²ç‚ºä¸»' : 
                                     analysis.photography_type === 'contrast_focused' ? 'å°æ¯”ç‚ºä¸»' : 
                                     analysis.photography_type === 'silhouette_only' ? 'å‰ªå½±å°ˆç”¨' : 'æ¨™æº–æ‹æ”';
                
                // æª¢æŸ¥æ˜¯å¦æœ‰è¡›æ˜Ÿåˆ†ææ•¸æ“š
                const satelliteInfo = analysis.satellite_analysis ? 
                    `<div style="margin-top: 8px; padding: 8px; background: rgba(0, 255, 127, 0.1); border-radius: 6px; border-left: 3px solid #00ff7f;">
                        <small style="color: #00aa55; font-weight: bold;">ğŸ“¡ è¡›æ˜Ÿæ•¸æ“šå¢å¼·</small><br>
                        <small style="color: #666;">å¯ä¿¡åº¦: ${analysis.satellite_analysis.data_confidence || 0}% | 
                        é›²è¦†è“‹: ${analysis.satellite_analysis.cloud_analysis?.coverage_estimate || 'N/A'}%</small>
                     </div>` : '';
                
                const analysisMethod = analysis.enhanced_accuracy ? 
                    '<span style="color: #00aa55; font-weight: bold;">ğŸ“¡ è¡›æ˜Ÿå¢å¼·åˆ†æ</span>' : 
                    '<span style="color: #666;">ğŸ“Š åŸºç¤æ°£è±¡åˆ†æ</span>';

                cloudVisibilityCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            â˜ï¸ é›²å±¤åšåº¦åˆ†æ <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score">${Math.round(analysis.technical_details?.combined_score || 50)}/100åˆ†</div>
                    </div>
                    <div class="factor-description">
                        ${visibilityCircle}
                        <strong>é›²å±¤ç­‰ç´š:</strong> ${cloudLevelDesc}<br>
                        <strong>é æœŸæ•ˆæœ:</strong> ${effectDesc}<br>
                        <strong>æ”å½±é¡å‹:</strong> ${photographyIcon} ${photoTypeDesc}<br>
                        <strong>åˆ†ææ–¹å¼:</strong> ${analysisMethod}<br>
                        ${satelliteInfo}
                        ${analysis.specific_recommendations && analysis.specific_recommendations.length > 0 ? 
                          `<div style="margin-top: 10px; padding: 10px; background: rgba(116, 185, 255, 0.1); border-radius: 8px; font-size: 0.9rem;">
                             <strong>å°ˆæ¥­å»ºè­°:</strong><br>
                             ${analysis.specific_recommendations.slice(0, 2).join('<br>')}
                           </div>` : ''}
                        ${analysis.score_adjustment ? 
                          `<br><small style="color: #666; font-style: italic;">âš™ï¸ ${analysis.score_adjustment}</small>` : ''}
                        <br><small style="color: #888; font-style: italic;">â˜ï¸ åŸºæ–¼æ°£è±¡æ•¸æ“šåˆ†æé›²å±¤åšåº¦ï¼Œå€åˆ†é¡è‰²ç‡’å¤©èˆ‡æ˜æš—ç‡’å¤©æ•ˆæœ</small>
                    </div>
                `;
                addMobileToggle(cloudVisibilityCard);
                grid.appendChild(cloudVisibilityCard);
            }

            // æ·»åŠ è¡›æ˜Ÿåˆ†æå°ˆç”¨å¡ç‰‡ï¼ˆå¦‚æœæœ‰è¡›æ˜Ÿæ•¸æ“šï¼‰
            if (details.cloud_thickness_analysis && details.cloud_thickness_analysis.satellite_analysis) {
                const satelliteCard = document.createElement('div');
                satelliteCard.className = 'factor-card cloud-analysis-card'; // æ·»åŠ ç‰¹æ®Šé¡
                satelliteCard.style.borderLeft = '4px solid #00ff7f';
                
                const satellite = details.cloud_thickness_analysis.satellite_analysis;
                
                // å¯ä¿¡åº¦é¡è‰²
                const confidenceColor = (satellite.data_confidence || 0) >= 80 ? '#00aa55' : 
                                       (satellite.data_confidence || 0) >= 60 ? '#ffaa00' : '#ff5555';
                
                satelliteCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            ğŸ“¡ è¡›æ˜Ÿé›²åœ–åˆ†æ <span style="opacity: 0.6; font-size: 0.8em;">ğŸ›°ï¸</span>
                        </div>
                        <div class="factor-score" style="color: ${confidenceColor};">${satellite.data_confidence || 0}%</div>
                    </div>
                    <div class="factor-description">
                        <strong>æ•¸æ“šå¯ä¿¡åº¦:</strong> <span style="color: ${confidenceColor}; font-weight: bold;">${satellite.data_confidence || 0}%</span><br>
                        ${satellite.cloud_analysis ? `<strong>é›²è¦†è“‹ç‡:</strong> ${satellite.cloud_analysis.coverage_estimate}%<br>` : ''}
                        ${satellite.cloud_analysis ? `<strong>ä¸»è¦é›²å‹:</strong> ${satellite.cloud_analysis.dominant_type}<br>` : ''}
                        ${satellite.visibility_prediction ? `<strong>é€æ˜åº¦:</strong> ${satellite.visibility_prediction.transparency_percentage}%<br>` : ''}
                        ${satellite.burnsky_suitability ? `<strong>ç‡’å¤©é©å®œåº¦:</strong> ${satellite.burnsky_suitability.suitability_level}<br>` : ''}
                        <div style="margin-top: 8px; padding: 8px; background: rgba(0, 255, 127, 0.05); border-radius: 6px;">
                            <small style="color: #00aa55; font-weight: bold;">ğŸ›°ï¸ å³æ™‚è¡›æ˜Ÿæ•¸æ“šå¢å¼·é æ¸¬æº–ç¢ºåº¦</small>
                        </div>
                        <br><small style="color: #888; font-style: italic;">ğŸ›°ï¸ çµåˆå³æ™‚è¡›æ˜Ÿé›²åœ–æ•¸æ“šï¼Œæä¾›æ›´ç²¾ç¢ºçš„é›²å±¤åšåº¦èˆ‡ç‡’å¤©é æ¸¬</small>
                    </div>
                `;
                addMobileToggle(satelliteCard);
                grid.appendChild(satelliteCard);
            }
            
            // æ·»åŠ è©³ç´°æ”å½±æŒ‡å°å¡ç‰‡
            if (details.cloud_thickness_analysis && details.cloud_thickness_analysis.photography_guidance) {
                const photographyCard = document.createElement('div');
                photographyCard.className = 'factor-card cloud-analysis-card'; // æ·»åŠ ç‰¹æ®Šé¡
                photographyCard.style.borderLeft = '4px solid #fd79a8';
                
                const guidance = details.cloud_thickness_analysis.photography_guidance;
                
                // è¨­å‚™å»ºè­°
                const equipmentSuggestions = guidance.equipment_suggestions ? 
                    guidance.equipment_suggestions.slice(0, 3).join('<br>') : 'æ¨™æº–æ”å½±è¨­å‚™';
                
                // æ§‹åœ–æç¤º
                const compositionTips = guidance.composition_tips ? 
                    guidance.composition_tips.slice(0, 3).join('<br>') : 'åŸºæœ¬æ§‹åœ–å»ºè­°';
                
                // æ‹æ”è¨­å®š
                const settings = guidance.recommended_settings || {};
                const settingsText = Object.entries(settings)
                    .slice(0, 3)
                    .map(([key, value]) => `${key}: ${value}`)
                    .join('<br>');
                
                photographyCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            ğŸ“¸ å°ˆæ¥­æ”å½±æŒ‡å° <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score">PRO</div>
                    </div>
                    <div class="factor-description">
                        <div style="margin-bottom: 8px;">
                            <strong>ğŸ“± è¨­å‚™å»ºè­°:</strong><br>
                            <small>${equipmentSuggestions}</small>
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>ğŸ¨ æ§‹åœ–æŠ€å·§:</strong><br>
                            <small>${compositionTips}</small>
                        </div>
                        ${settingsText ? `
                        <div style="margin-bottom: 8px;">
                            <strong>âš™ï¸ æ‹æ”è¨­å®š:</strong><br>
                            <small>${settingsText}</small>
                        </div>` : ''}
                        <br><small style="color: #888; font-style: italic;">ğŸ“¸ åŸºæ–¼ç•¶å‰æ°£è±¡æ¢ä»¶é‡èº«å®šåˆ¶çš„å°ˆæ¥­æ”å½±å»ºè­°</small>
                    </div>
                `;
                addMobileToggle(photographyCard);
                grid.appendChild(photographyCard);
            }
            
            // æ·»åŠ ç‡’å¤©é©å®œåº¦è©•ä¼°å¡ç‰‡
            if (details.cloud_thickness_analysis && details.cloud_thickness_analysis.burnsky_suitability) {
                const suitabilityCard = document.createElement('div');
                suitabilityCard.className = 'factor-card cloud-analysis-card'; // æ·»åŠ ç‰¹æ®Šé¡
                suitabilityCard.style.borderLeft = '4px solid #fdcb6e';
                
                const suitability = details.cloud_thickness_analysis.burnsky_suitability;
                
                // é©å®œåº¦ç­‰ç´šé¡è‰²
                const levelColor = suitability.suitability_level === 'excellent' ? '#00b894' :
                                 suitability.suitability_level === 'very_good' ? '#00cec9' :
                                 suitability.suitability_level === 'moderate' ? '#fdcb6e' :
                                 suitability.suitability_level === 'limited' ? '#e17055' : '#d63031';
                
                // é©å®œåº¦ç­‰ç´šæ–‡å­—
                const levelText = suitability.suitability_level === 'excellent' ? 'ğŸ”¥ çµ•ä½³' :
                                suitability.suitability_level === 'very_good' ? 'ğŸŒ… å„ªè‰¯' :
                                suitability.suitability_level === 'moderate' ? 'ğŸŒ¤ï¸ ä¸­ç­‰' :
                                suitability.suitability_level === 'limited' ? 'ğŸŒ«ï¸ æœ‰é™' : 'âŒ ä¸ä½³';
                
                suitabilityCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            ğŸ¯ ç‡’å¤©é©å®œåº¦è©•ä¼° <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score" style="color: ${levelColor};">${levelText}</div>
                    </div>
                    <div class="factor-description">
                        <strong>é©å®œåº¦ç­‰ç´š:</strong> <span style="color: ${levelColor}; font-weight: bold;">${levelText}</span><br>
                        <strong>æˆåŠŸæ©Ÿç‡:</strong> ${suitability.probability || 'N/A'}<br>
                        <strong>é æœŸå“è³ª:</strong> ${suitability.expected_quality || 'N/A'}<br>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(253, 203, 110, 0.1); border-radius: 8px;">
                            <strong>ğŸ’¡ å»ºè­°:</strong><br>
                            <small>${suitability.recommendation || 'åŸºæ–¼ç•¶å‰æ¢ä»¶é€²è¡Œæ‹æ”'}</small>
                        </div>
                        <br><small style="color: #888; font-style: italic;">ğŸ¯ ç¶œåˆæ°£è±¡èˆ‡è¡›æ˜Ÿæ•¸æ“šï¼Œè©•ä¼°ç•¶å‰ç‡’å¤©æ‹æ”çš„æˆåŠŸæ©Ÿç‡</small>
                    </div>
                `;
                addMobileToggle(suitabilityCard);
                grid.appendChild(suitabilityCard);
            }
            
            // æ·»åŠ æŠ€è¡“è©³æƒ…å¡ç‰‡
            if (details.cloud_thickness_analysis && details.cloud_thickness_analysis.technical_details) {
                const technicalCard = document.createElement('div');
                technicalCard.className = 'factor-card cloud-analysis-card'; // æ·»åŠ ç‰¹æ®Šé¡
                technicalCard.style.borderLeft = '4px solid #74b9ff';
                
                const technical = details.cloud_thickness_analysis.technical_details;
                
                // é¡¯ç¤ºä¸»è¦æŠ€è¡“æŒ‡æ¨™
                const technicalMetrics = [];
                if (technical.atmospheric_transparency) technicalMetrics.push(`å¤§æ°£é€æ˜åº¦: ${Math.round(technical.atmospheric_transparency)}%`);
                if (technical.cloud_coverage_factor) technicalMetrics.push(`é›²é‡å½±éŸ¿: ${Math.round(technical.cloud_coverage_factor * 100)}%`);
                if (technical.visibility_confidence) technicalMetrics.push(`å¯ä¿¡åº¦: ${Math.round(technical.visibility_confidence * 100)}%`);
                if (technical.combined_score) technicalMetrics.push(`ç¶œåˆè©•åˆ†: ${Math.round(technical.combined_score)}/100`);
                
                const metricsText = technicalMetrics.length > 0 ? 
                    technicalMetrics.map(metric => `<small>â€¢ ${metric}</small>`).join('<br>') :
                    '<small>â€¢ åŸºæœ¬æŠ€è¡“åˆ†æ</small>';
                
                // åˆ†ææ–¹æ³•èªªæ˜
                const analysisMethod = technical.analysis_method || 'æ°£è±¡æ•¸æ“šåˆ†æ';
                const dataSource = technical.data_sources ? technical.data_sources.join(', ') : 'HKOå¤©æ–‡å°æ•¸æ“š';
                
                technicalCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            ğŸ”¬ æŠ€è¡“è©³æƒ… <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score">è©³ç´°</div>
                    </div>
                    <div class="factor-description">
                        <strong>æŠ€è¡“æŒ‡æ¨™:</strong><br>
                        ${metricsText}<br>
                        <div style="margin-top: 8px;">
                            <strong>åˆ†ææ–¹æ³•:</strong> ${analysisMethod}<br>
                            <strong>æ•¸æ“šä¾†æº:</strong> ${dataSource}
                        </div>
                        ${technical.algorithm_version ? `
                        <div style="margin-top: 8px; padding: 6px; background: rgba(116, 185, 255, 0.1); border-radius: 6px;">
                            <small style="color: #0984e3;">ğŸ§¬ ç®—æ³•ç‰ˆæœ¬: ${technical.algorithm_version}</small>
                        </div>` : ''}
                        <br><small style="color: #888; font-style: italic;">ğŸ”¬ æ·±åº¦æŠ€è¡“åˆ†æçµæœï¼Œä¾›å°ˆæ¥­ç”¨æˆ¶åƒè€ƒ</small>
                    </div>
                `;
                addMobileToggle(technicalCard);
                grid.appendChild(technicalCard);
            }

            // æ·»åŠ é¡è‰²é æ¸¬å¡ç‰‡
            if (details.color_prediction) {
                const colorCard = document.createElement('div');
                colorCard.className = 'factor-card';
                colorCard.style.borderLeft = '4px solid #ee5a52';
                const color = details.color_prediction;
                
                // ç”Ÿæˆé¡è‰²æ¨£æœ¬
                let colorSamples = '';
                if (color.color_hex_codes) {
                    colorSamples = '<div style="margin-top: 10px; display: flex; gap: 5px; flex-wrap: wrap;">';
                    for (const [colorName, hexCode] of Object.entries(color.color_hex_codes)) {
                        colorSamples += `<div style="background: ${hexCode}; width: 25px; height: 25px; border-radius: 4px; border: 1px solid #ddd;" title="${colorName}"></div>`;
                    }
                    colorSamples += '</div>';
                }
                
                colorCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            ğŸ¨ é¡è‰²é æ¸¬ <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score">${color.color_intensity}</div>
                    </div>
                    <div class="factor-description">
                        <strong>ä¸»è¦é¡è‰²:</strong> ${color.primary_colors ? color.primary_colors.join(', ') : 'é æ¸¬ä¸­'}<br>
                        <strong>æ¬¡è¦é¡è‰²:</strong> ${color.secondary_colors ? color.secondary_colors.join(', ') : 'é æ¸¬ä¸­'}<br>
                        <small>æŒçºŒæ™‚é–“: ${color.color_duration ? color.color_duration.total : 'æœªçŸ¥'} | å³°å€¼: ${color.color_duration ? color.color_duration.peak : 'æœªçŸ¥'}</small>
                        ${colorSamples}
                        <br><small style="color: #888; font-style: italic;">ğŸ¨ åˆ†æå¤§æ°£æ•£å°„æ¢ä»¶ï¼Œé æ¸¬ç‡’å¤©å¯èƒ½å‘ˆç¾çš„è‰²å½©æ•ˆæœèˆ‡è®ŠåŒ–è¶¨å‹¢</small>
                    </div>
                `;
                addMobileToggle(colorCard);
                grid.appendChild(colorCard);
            }
            
            // æ·»åŠ å¤©æ°£è­¦å‘Šå½±éŸ¿åˆ†æå¡ç‰‡ï¼ˆå¦‚æœæœ‰è­¦å‘Šæ•¸æ“šï¼‰
            if (window.currentWarningData && window.currentWarningData.detailed_analysis && window.currentWarningData.detailed_analysis.length > 0) {
                const warningAnalysisCard = document.createElement('div');
                warningAnalysisCard.className = 'factor-card';
                warningAnalysisCard.style.borderLeft = '4px solid #ff6b6b';
                
                const warnings = window.currentWarningData.detailed_analysis;
                const totalImpact = Math.min(window.currentWarningData.total_warning_impact || 0, 10); // é™åˆ¶æœ€é«˜ 10 åˆ†
                
                // è¨ˆç®—å½±éŸ¿ç­‰ç´šé¡è‰²
                const impactColor = totalImpact >= 8 ? '#d63031' : 
                                  totalImpact >= 5 ? '#e17055' : 
                                  totalImpact >= 3 ? '#fdcb6e' : '#00b894';
                
                // ç”Ÿæˆè­¦å‘Šå½±éŸ¿æ‘˜è¦
                const impactSummary = warnings.map(warning => {
                    const severity = warning.severity || 'moderate';
                    const severityMap = {
                        'extreme': 'æ¥µç«¯',
                        'severe': 'åš´é‡', 
                        'moderate': 'ä¸­ç­‰',
                        'low': 'è¼•å¾®'
                    };
                    const severityDesc = severityMap[severity] || severity;
                    
                    let typeIcon = 'âš ï¸';
                    if (warning.category === 'thunderstorm') typeIcon = 'â›ˆï¸';
                    else if (warning.category === 'temperature') typeIcon = 'ğŸŒ¡ï¸';
                    else if (warning.category === 'wind_storm') typeIcon = 'ğŸ’¨';
                    else if (warning.category === 'rain') typeIcon = 'ğŸŒ§ï¸';
                    
                    return `${typeIcon} ${severityDesc} (å½±éŸ¿: ${warning.impact_score || 0}/10)`;
                }).join('<br>');
                
                // ä¸»è¦å½±éŸ¿å› å­
                const allImpactFactors = warnings.reduce((factors, warning) => {
                    if (warning.impact_factors) {
                        factors.push(...warning.impact_factors);
                    }
                    return factors;
                }, []);
                const uniqueFactors = [...new Set(allImpactFactors)];
                
                warningAnalysisCard.innerHTML = `
                    <div class="factor-header">
                        <div class="factor-name">
                            âš ï¸ å¤©æ°£è­¦å‘Šå½±éŸ¿åˆ†æ <span style="opacity: 0.6; font-size: 0.8em;">ğŸ‘ï¸</span>
                        </div>
                        <div class="factor-score" style="color: ${impactColor};">${Math.round(totalImpact)}/10</div>
                    </div>
                    <div class="factor-description">
                        <strong>ç¾è¡Œè­¦å‘Š (${warnings.length}å€‹):</strong><br>
                        ${impactSummary}<br><br>
                        <strong>å°ç‡’å¤©é æ¸¬çš„å½±éŸ¿:</strong><br>
                        <div style="margin: 8px 0; padding: 8px; background: rgba(255, 107, 107, 0.1); border-radius: 6px;">
                            ${uniqueFactors.length > 0 ? uniqueFactors.map(factor => `â€¢ ${factor}`).join('<br>') : 'â€¢ é™ä½æ•´é«”é æ¸¬æº–ç¢ºåº¦<br>â€¢ å½±éŸ¿å¤©ç©ºèƒ½è¦‹åº¦<br>â€¢ å¯èƒ½é˜»æ“‹æ—¥ç…§'}
                        </div>
                        <strong>å®‰å…¨å»ºè­°:</strong> 
                        ${window.currentWarningData.has_severe_warnings ? 
                            '<span style="color: #d63031;">âš ï¸ å»ºè­°å–æ¶ˆæˆ¶å¤–æ”å½±æ´»å‹•</span>' : 
                            '<span style="color: #fdcb6e;">âš ï¸ æ³¨æ„å¤©æ°£è®ŠåŒ–ï¼Œåšå¥½é˜²è­·æªæ–½</span>'
                        }<br>
                        <br><small style="color: #888; font-style: italic;">âš ï¸ æ ¹æ“šé¦™æ¸¯å¤©æ–‡å°è­¦å‘Šåˆ†æå°ç‡’å¤©é æ¸¬çš„æ½›åœ¨å½±éŸ¿</small>
                    </div>
                `;
                addMobileToggle(warningAnalysisCard);
                grid.appendChild(warningAnalysisCard);
            }
        }

        // é¦™æ¸¯å¤©æ–‡å°å¤©æ°£åœ–æ¨™ä»£ç¢¼å°ç…§è¡¨
        const HKO_WEATHER_ICONS = {
            50: "æ™´æœ—",
            51: "éƒ¨åˆ†æ™‚é–“æœ‰é™½å…‰", 
            52: "çŸ­æš«æ™‚é–“æœ‰é™½å…‰",
            53: "éƒ¨åˆ†æ™‚é–“æœ‰é™½å…‰ï¼Œæœ‰ä¸€å…©é™£é©Ÿé›¨",
            54: "çŸ­æš«æ™‚é–“æœ‰é™½å…‰ï¼Œæœ‰å¹¾é™£é©Ÿé›¨",
            60: "å¤šé›²",
            61: "å¯†é›²", 
            62: "å¾®é›¨",
            63: "é›¨",
            64: "å¤§è‡´å¤šé›²ï¼Œæœ‰é›·æš´",
            65: "é›·æš´",
            70: "å¤©è‰²è‰¯å¥½",
            71: "å¤§è‡´å¤©æ™´",
            72: "å¤§è‡´å¤šé›²",
            73: "å¤šé›²ï¼ŒçŸ­æš«æ™‚é–“æœ‰é™½å…‰",
            74: "å¤šé›²",
            75: "è–„éœ§",
            76: "éœ§",
            77: "é„",  // æ–°å¢ä»£ç¢¼ 77
            78: "å¾®é›¨",
            79: "é©Ÿé›¨",
            80: "å¤§é¢¨",
            81: "ä¹¾ç‡¥",
            82: "æ½®æ¿•", 
            83: "éœœå‡",
            84: "æ²™å¡µæš´",
            85: "ç…™éœ",
            90: "ç†±",
            91: "æš–",
            92: "æ¶¼",
            93: "å†·",
            94: "éå¸¸ç†±",
            95: "éå¸¸å†·"
        };

        function getWeatherIconDescription(iconCode) {
            return HKO_WEATHER_ICONS[iconCode] || `æœªçŸ¥å¤©æ°£ç‹€æ³ (ä»£ç¢¼: ${iconCode})`;
        }

        function updateWeatherData(weatherData) {
            const container = document.getElementById('weatherData');
            container.innerHTML = '';
            
            if (!weatherData) {
                container.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.8);">æš«ç„¡å¤©æ°£æ•¸æ“š</p>';
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºç°¡åŒ–çš„æ¸¬è©¦æ•¸æ“šæ ¼å¼
            if (typeof weatherData.temperature === 'number') {
                // ç°¡åŒ–æ•¸æ“šæ ¼å¼ (æ¸¬è©¦æœå‹™å™¨)
                const cards = [];
                
                // æº«åº¦
                if (weatherData.temperature) {
                    let tempDescription = 'ç•¶å‰æº«åº¦';
                    if (weatherData.temperature >= 32) tempDescription += '<br><small>åç†±ï¼Œæœ‰åˆ©ç‡’å¤©å½¢æˆ</small>';
                    else if (weatherData.temperature >= 25) tempDescription += '<br><small>ç†æƒ³ç‡’å¤©æº«åº¦</small>';
                    else if (weatherData.temperature >= 20) tempDescription += '<br><small>é©ä¸­æº«åº¦</small>';
                    else tempDescription += '<br><small>åæ¶¼</small>';
                    
                    cards.push(`
                        <div class="weather-card">
                            <div class="weather-icon">ğŸŒ¡ï¸</div>
                            <div class="weather-value">${weatherData.temperature}Â°C</div>
                            <div class="weather-label">${tempDescription}</div>
                        </div>
                    `);
                }
                
                // æ¿•åº¦
                if (weatherData.humidity) {
                    let humidityDescription = 'ç›¸å°æ¿•åº¦';
                    if (weatherData.humidity >= 80) humidityDescription += '<br><small>åé«˜ï¼Œä¸åˆ©ç‡’å¤©</small>';
                    else if (weatherData.humidity >= 50) humidityDescription += '<br><small>é©ä¸­ï¼Œæœ‰åˆ©ç‡’å¤©</small>';
                    else humidityDescription += '<br><small>åä½</small>';
                    
                    cards.push(`
                        <div class="weather-card">
                            <div class="weather-icon">ğŸ’§</div>
                            <div class="weather-value">${weatherData.humidity}%</div>
                            <div class="weather-label">${humidityDescription}</div>
                        </div>
                    `);
                }
                
                // é›²é‡
                if (weatherData.cloud_cover) {
                    let cloudDescription = 'é›²å±¤è¦†è“‹';
                    if (weatherData.cloud_cover >= 80) cloudDescription += '<br><small>å¤šé›²ï¼Œä¸åˆ©ç‡’å¤©</small>';
                    else if (weatherData.cloud_cover >= 40) cloudDescription += '<br><small>é©é‡é›²å±¤ï¼Œæœ‰åˆ©ç‡’å¤©</small>';
                    else cloudDescription += '<br><small>å°‘é›²</small>';
                    
                    cards.push(`
                        <div class="weather-card">
                            <div class="weather-icon">â˜ï¸</div>
                            <div class="weather-value">${weatherData.cloud_cover}%</div>
                            <div class="weather-label">${cloudDescription}</div>
                        </div>
                    `);
                }
                
                // é¢¨é€Ÿ
                if (weatherData.wind_speed) {
                    let windDescription = 'é¢¨é€Ÿ';
                    if (weatherData.wind_speed >= 20) windDescription += '<br><small>é¢¨è¼ƒå¤§ï¼Œé›²å±¤ç§»å‹•å¿«</small>';
                    else if (weatherData.wind_speed >= 10) windDescription += '<br><small>å¾®é¢¨ï¼Œé©åˆæ‹æ”</small>';
                    else windDescription += '<br><small>è¼•é¢¨</small>';
                    
                    cards.push(`
                        <div class="weather-card">
                            <div class="weather-icon">ğŸ’¨</div>
                            <div class="weather-value">${weatherData.wind_speed} km/h</div>
                            <div class="weather-label">${windDescription}</div>
                        </div>
                    `);
                }
                
                // æ°£å£“
                if (weatherData.pressure) {
                    let pressureDescription = 'æ°£å£“';
                    if (weatherData.pressure >= 1020) pressureDescription += '<br><small>é«˜æ°£å£“ï¼Œå¤©æ°£ç©©å®š</small>';
                    else if (weatherData.pressure >= 1000) pressureDescription += '<br><small>æ­£å¸¸æ°£å£“</small>';
                    else pressureDescription += '<br><small>ä½æ°£å£“</small>';
                    
                    cards.push(`
                        <div class="weather-card">
                            <div class="weather-icon">ğŸ“Š</div>
                            <div class="weather-value">${weatherData.pressure} hPa</div>
                            <div class="weather-label">${pressureDescription}</div>
                        </div>
                    `);
                }
                
                // èƒ½è¦‹åº¦
                if (weatherData.visibility) {
                    let visibilityDescription = 'èƒ½è¦‹åº¦';
                    if (weatherData.visibility >= 15) visibilityDescription += '<br><small>æ¥µä½³ï¼Œé©åˆæ‹æ”</small>';
                    else if (weatherData.visibility >= 10) visibilityDescription += '<br><small>è‰¯å¥½</small>';
                    else visibilityDescription += '<br><small>ä¸€èˆ¬</small>';
                    
                    cards.push(`
                        <div class="weather-card">
                            <div class="weather-icon">ğŸ‘ï¸</div>
                            <div class="weather-value">${weatherData.visibility} km</div>
                            <div class="weather-label">${visibilityDescription}</div>
                        </div>
                    `);
                }
                
                container.innerHTML = cards.join('');
                return;
            }
            
            // åŸæœ‰çš„HKOè¤‡é›œæ•¸æ“šæ ¼å¼è™•ç†
            // æº«åº¦æ•¸æ“š
            if (weatherData.temperature && weatherData.temperature.data) {
                const hkoTemp = weatherData.temperature.data.find(t => t.place === 'é¦™æ¸¯å¤©æ–‡å°');
                if (hkoTemp) {
                    let tempDescription = 'é¦™æ¸¯å¤©æ–‡å°æ¸¬é‡';
                    if (hkoTemp.value >= 32) tempDescription += '<br><small>åç†±ï¼Œæœ‰åˆ©ç‡’å¤©å½¢æˆ</small>';
                    else if (hkoTemp.value >= 25) tempDescription += '<br><small>ç†æƒ³ç‡’å¤©æº«åº¦</small>';
                    else if (hkoTemp.value >= 20) tempDescription += '<br><small>é©ä¸­æº«åº¦</small>';
                    else tempDescription += '<br><small>åæ¶¼</small>';
                    
                    container.innerHTML += `
                        <div class="weather-card">
                            <div class="weather-icon">ğŸŒ¡ï¸</div>
                            <div class="weather-value">${hkoTemp.value}Â°C</div>
                            <div class="weather-label">${tempDescription}</div>
                        </div>
                    `;
                }
            }
            
            // æ¿•åº¦æ•¸æ“š
            if (weatherData.humidity && weatherData.humidity.data) {
                const hkoHumidity = weatherData.humidity.data.find(h => h.place === 'é¦™æ¸¯å¤©æ–‡å°');
                if (hkoHumidity) {
                    let humidityDescription = 'ç›¸å°æ¿•åº¦';
                    if (hkoHumidity.value >= 80) humidityDescription += '<br><small>åé«˜ï¼Œä¸åˆ©ç‡’å¤©</small>';
                    else if (hkoHumidity.value >= 50) humidityDescription += '<br><small>é©ä¸­ï¼Œæœ‰åˆ©ç‡’å¤©</small>';
                    else humidityDescription += '<br><small>åä½ï¼Œéœ€æ³¨æ„ç©ºæ°£å“è³ª</small>';
                    
                    container.innerHTML += `
                        <div class="weather-card">
                            <div class="weather-icon">ğŸ’§</div>
                            <div class="weather-value">${hkoHumidity.value}%</div>
                            <div class="weather-label">${humidityDescription}</div>
                        </div>
                    `;
                }
            }
            
            // UVæŒ‡æ•¸ - ç¸½æ˜¯é¡¯ç¤º UV æŒ‡æ•¸å¡ç‰‡
            let uvValue = '';
            let uvDescription = 'UVæŒ‡æ•¸';
            
            // å˜—è©¦å¾ä¸åŒæ ¼å¼ä¸­æå– UV å€¼
            if (typeof weatherData.uvindex === 'object' && weatherData.uvindex.data && weatherData.uvindex.data.length > 0) {
                uvValue = weatherData.uvindex.data[0].value;
            } else if (typeof weatherData.uvindex === 'string' && weatherData.uvindex.trim() !== '') {
                uvValue = weatherData.uvindex.trim();
            } else if (typeof weatherData.uvindex === 'number') {
                uvValue = weatherData.uvindex;
            }
            
            // å¦‚æœæœ‰æœ‰æ•ˆçš„ UV å€¼ï¼Œé¡¯ç¤ºæ­£å¸¸çš„ UV å¡ç‰‡
            if (uvValue !== '' && uvValue !== undefined && uvValue !== null && !isNaN(uvValue)) {
                const uvNum = parseFloat(uvValue);
                if (uvNum >= 8) uvDescription += '<br><small>æ¥µé«˜ï¼Œæ—¥ç…§å……è¶³</small>';
                else if (uvNum >= 6) uvDescription += '<br><small>é«˜ï¼Œæ—¥ç…§è‰¯å¥½</small>';
                else if (uvNum >= 3) uvDescription += '<br><small>ä¸­ç­‰</small>';
                else if (uvNum > 0) uvDescription += '<br><small>ä½</small>';
                else uvDescription += '<br><small>ç„¡æˆ–æ¥µä½</small>';
                
                container.innerHTML += `
                    <div class="weather-card">
                        <div class="weather-icon">â˜€ï¸</div>
                        <div class="weather-value">${uvValue}</div>
                        <div class="weather-label">${uvDescription}</div>
                    </div>
                `;
            } else {
                // ç•¶UVæ•¸æ“šç‚ºç©ºæˆ–ç„¡æ•ˆæ™‚ï¼Œç¸½æ˜¯é¡¯ç¤ºå¤œé–“ç‹€æ…‹
                container.innerHTML += `
                    <div class="weather-card">
                        <div class="weather-icon">ğŸŒ™</div>
                        <div class="weather-value">--</div>
                        <div class="weather-label">UVæŒ‡æ•¸<br><small>å¤œé–“æˆ–ç„¡æ•¸æ“š</small></div>
                    </div>
                `;
            }
            
            // é¢¨é€Ÿæ•¸æ“š
            if (weatherData.wind && weatherData.wind.description) {
                const windData = weatherData.wind;
                let windComment = '';
                
                // æ ¹æ“šé¢¨ç´šçµ¦å‡ºç‡’å¤©å½±éŸ¿è©•ä¼°
                const avgBeaufort = (windData.speed_beaufort_min + windData.speed_beaufort_max) / 2;
                if (avgBeaufort <= 2) windComment = '<br><small>å¾®é¢¨ï¼Œæœ‰åˆ©ç‡’å¤©æŒçºŒ</small>';
                else if (avgBeaufort <= 4) windComment = '<br><small>å’Œé¢¨ï¼Œæ¢ä»¶é©ä¸­</small>';
                else if (avgBeaufort <= 6) windComment = '<br><small>å¼·é¢¨ï¼Œå¯èƒ½å½±éŸ¿ç‡’å¤©</small>';
                else windComment = '<br><small>çƒˆé¢¨ï¼Œä¸åˆ©ç‡’å¤©å½¢æˆ</small>';
                
                // é¡¯ç¤ºé¢¨ç´šç¯„åœ
                let windLevel = '';
                if (windData.speed_beaufort_min === windData.speed_beaufort_max) {
                    windLevel = `${windData.speed_beaufort_min}ç´š`;
                } else {
                    windLevel = `${windData.speed_beaufort_min}-${windData.speed_beaufort_max}ç´š`;
                }
                
                // å¾åŸå§‹æè¿°ä¸­æå–é¢¨å‘ï¼Œè€Œä¸æ˜¯ä½¿ç”¨è‹±æ–‡ç¸®å¯«
                let windDirection = '';
                const description = windData.description || '';
                
                // å¾æè¿°ä¸­åŒ¹é…é¢¨å‘ - æŒ‰é•·åº¦æ’åºï¼Œé¿å…èª¤åŒ¹é…
                if (description.includes('æ±åŒ—é¢¨')) windDirection = 'æ±åŒ—';
                else if (description.includes('æ±å—é¢¨')) windDirection = 'æ±å—';
                else if (description.includes('è¥¿å—é¢¨')) windDirection = 'è¥¿å—';
                else if (description.includes('è¥¿åŒ—é¢¨')) windDirection = 'è¥¿åŒ—';
                else if (description.includes('ååŒ—é¢¨')) windDirection = 'ååŒ—';
                else if (description.includes('åæ±é¢¨')) windDirection = 'åæ±';
                else if (description.includes('åå—é¢¨')) windDirection = 'åå—';
                else if (description.includes('åè¥¿é¢¨')) windDirection = 'åè¥¿';
                else if (description.includes('åŒ—é¢¨')) windDirection = 'åŒ—';
                else if (description.includes('æ±é¢¨')) windDirection = 'æ±';
                else if (description.includes('å—é¢¨')) windDirection = 'å—';
                else if (description.includes('è¥¿é¢¨')) windDirection = 'è¥¿';
                else {
                    // å¦‚æœæ²’æœ‰åŒ¹é…åˆ°ï¼Œä½¿ç”¨è‹±æ–‡ç¸®å¯«è½‰æ›
                    const directionMap = {
                        'N': 'åŒ—', 'NE': 'æ±åŒ—', 'E': 'æ±', 'SE': 'æ±å—',
                        'S': 'å—', 'SW': 'è¥¿å—', 'W': 'è¥¿', 'NW': 'è¥¿åŒ—'
                    };
                    windDirection = directionMap[windData.direction] || windData.direction || '';
                }
                
                container.innerHTML += `
                    <div class="weather-card">
                        <div class="weather-icon">ğŸ’¨</div>
                        <div class="weather-value">${windLevel}</div>
                        <div class="weather-label">${windDirection}é¢¨ (${windData.speed_kmh_min}-${windData.speed_kmh_max}km/h)${windComment}</div>
                    </div>
                `;
            }
            
            // å¤©æ°£åœ–æ¨™
            if (weatherData.icon && weatherData.icon.length > 0) {
                const iconCode = weatherData.icon[0];
                const iconDescription = getWeatherIconDescription(iconCode);
                container.innerHTML += `
                    <div class="weather-card">
                        <div class="weather-icon">ğŸŒ¤ï¸</div>
                        <div class="weather-value">${iconDescription}</div>
                        <div class="weather-label">ç•¶å‰å¤©æ°£ç‹€æ³</div>
                    </div>
                `;
            }
            
            // é™é›¨é‡æ•¸æ“š
            if (weatherData.rainfall && weatherData.rainfall.data) {
                let totalRainfall = 0;
                weatherData.rainfall.data.forEach(r => {
                    if (typeof r === 'object' && r.value && r.value > 0) {
                        totalRainfall += r.value;
                    }
                });
                
                let rainDescription = 'éå»ä¸€å°æ™‚é™é›¨é‡';
                if (totalRainfall === 0) rainDescription += '<br><small>ç„¡é™é›¨ï¼Œç©ºæ°£æ¸…æ™°</small>';
                else if (totalRainfall < 5) rainDescription += '<br><small>è¼•å¾®é™é›¨</small>';
                else if (totalRainfall < 15) rainDescription += '<br><small>ä¸­ç­‰é™é›¨</small>';
                else rainDescription += '<br><small>å¤§é›¨ï¼Œä¸åˆ©ç‡’å¤©</small>';
                
                container.innerHTML += `
                    <div class="weather-card">
                        <div class="weather-icon">ğŸŒ§ï¸</div>
                        <div class="weather-value">${totalRainfall.toFixed(1)}mm</div>
                        <div class="weather-label">${rainDescription}</div>
                    </div>
                `;
            }
            
            // å¤©æ°£è­¦å‘Š
            if (weatherData.warningMessage && weatherData.warningMessage.length > 0) {
                // å–å¾—ç¬¬ä¸€å€‹è­¦å‘Šçš„ä¸»è¦å…§å®¹ï¼Œå»é™¤æ™‚æ•ˆä¿¡æ¯
                let warningContent = weatherData.warningMessage[0];
                // æˆªå–è­¦å‘Šçš„ä¸»è¦éƒ¨åˆ† (å»é™¤æ™‚æ•ˆèªªæ˜)
                let mainWarning = warningContent.split('ï¼Œ')[0]; // å–ç¬¬ä¸€éƒ¨åˆ†
                if (mainWarning.includes('è­¦å‘Š')) {
                    mainWarning = mainWarning.replace(/ç¾æ­£ç”Ÿæ•ˆ.*/, '').trim();
                }
                
                container.innerHTML += `
                    <div class="weather-card" style="border-left: 4px solid #ff6b6b;">
                        <div class="weather-icon">âš ï¸</div>
                        <div class="weather-value" style="font-size: 1.3rem;">${mainWarning}</div>
                        <div class="weather-label">å¤©æ°£è­¦å‘Šç”Ÿæ•ˆä¸­<br><small>å¯èƒ½å½±éŸ¿æ‹æ”æ¢ä»¶</small></div>
                    </div>
                `;
            }
        }
        
        function updateAirQualityData(airQualityData) {
            const container = document.getElementById('weatherData');
            
            // ç©ºæ°£å“è³ªæ•¸æ“š
            if (airQualityData) {
                const aqhi = airQualityData.aqhi || 4;
                const level = airQualityData.level || 'ä¸­';
                const pm25 = airQualityData.pm25 || 25;
                const impact = airQualityData.impact || 'ä¸€èˆ¬';
                const source = airQualityData.source || 'æœªçŸ¥';
                
                // æ ¹æ“š AQHI é¸æ“‡åœ–æ¨™å’Œé¡è‰²
                let icon = 'ğŸŒ«ï¸';
                let borderColor = '#4CAF50';
                let description = 'ç©ºæ°£å“è³ªä¸€èˆ¬';
                
                if (aqhi <= 3) {
                    icon = 'âœ¨';
                    borderColor = '#4CAF50';
                    description = `ç©ºæ°£æ¸…æ¾ˆé€æ˜<br><small>æ¥µä½³ç‡’å¤©æ¢ä»¶</small>`;
                } else if (aqhi <= 6) {
                    icon = 'ğŸŒ«ï¸';
                    borderColor = '#FFC107';
                    description = `ç©ºæ°£å“è³ªä¸€èˆ¬<br><small>è‰¯å¥½ç‡’å¤©æ¢ä»¶</small>`;
                } else if (aqhi <= 9) {
                    icon = 'ğŸ˜·';
                    borderColor = '#FF9800';
                    description = `ç©ºæ°£å“è³ªæ¬ ä½³<br><small>å½±éŸ¿è‰²å½©é£½å’Œåº¦</small>`;
                } else {
                    icon = 'ğŸš«';
                    borderColor = '#F44336';
                    description = `ç©ºæ°£æ±¡æŸ“åš´é‡<br><small>å¤§å¹…å½±éŸ¿ç‡’å¤©å“è³ª</small>`;
                }
                
                container.innerHTML += `
                    <div class="weather-card" style="border-left: 4px solid ${borderColor};">
                        <div class="weather-icon">${icon}</div>
                        <div class="weather-value">AQHI ${aqhi}</div>
                        <div class="weather-label">${description}<br><small>PM2.5: ${pm25}Î¼g/mÂ³ | ${source}</small></div>
                    </div>
                `;
            }
        }

        function updateAnalysisSummary(summary) {
            const container = document.getElementById('analysisSummary');
            container.innerHTML = '';
            
            if (summary && Array.isArray(summary)) {
                // ä¸»è¦çµè«– - ç”¨æ›´å¤§çš„æ¨£å¼çªå‡ºé¡¯ç¤º
                if (summary.length > 0) {
                    const mainConclusion = document.createElement('div');
                    mainConclusion.className = 'summary-item';
                    mainConclusion.style.cssText = `
                        background: rgba(255,255,255,0.3);
                        font-size: 1.1rem;
                        font-weight: 600;
                        text-align: center;
                        margin-bottom: 15px;
                        padding: 18px 20px;
                        border-radius: 15px;
                        box-shadow: 0 4px 15px rgba(255,255,255,0.1);
                    `;
                    mainConclusion.textContent = summary[0];
                    container.appendChild(mainConclusion);
                }
                
                // é—œéµå› å­ - ç”¨ç°¡æ½”çš„æ°´å¹³æ’åˆ—
                if (summary.length > 1) {
                    const keyFactors = document.createElement('div');
                    keyFactors.className = 'summary-item';
                    keyFactors.style.cssText = `
                        background: rgba(255,255,255,0.2);
                        font-size: 0.95rem;
                        text-align: center;
                        margin-bottom: 12px;
                        padding: 12px 16px;
                        border-radius: 12px;
                        border-left: 3px solid rgba(255,255,255,0.4);
                    `;
                    keyFactors.textContent = summary[1];
                    container.appendChild(keyFactors);
                }
                
                // ç‡’å¤©ç¨‹åº¦å’Œæ‹æ”å»ºè­° - æ–°å¢å€å¡Š
                if (summary.length > 2) {
                    const burnskyDetails = document.createElement('div');
                    burnskyDetails.className = 'summary-item';
                    burnskyDetails.style.cssText = `
                        background: rgba(255,255,255,0.25);
                        font-size: 0.9rem;
                        text-align: center;
                        margin-bottom: 12px;
                        padding: 12px 16px;
                        border-radius: 12px;
                        border-left: 3px solid rgba(255,100,100,0.8);
                        line-height: 1.4;
                    `;
                    burnskyDetails.textContent = summary[2];
                    container.appendChild(burnskyDetails);
                }
                
                // ä¸»è¦è‰²å½©å’Œè‰²å½©å¼·åº¦ - æ–°å¢å€å¡Š
                if (summary.length > 3) {
                    const colorInfo = document.createElement('div');
                    colorInfo.className = 'summary-item';
                    colorInfo.style.cssText = `
                        background: rgba(255,255,255,0.25);
                        font-size: 0.9rem;
                        text-align: center;
                        margin-bottom: 12px;
                        padding: 12px 16px;
                        border-radius: 12px;
                        border-left: 3px solid rgba(150,100,255,0.8);
                        line-height: 1.4;
                    `;
                    colorInfo.textContent = summary[3];
                    container.appendChild(colorInfo);
                }
                
                // æ“ä½œå»ºè­° - ç”¨è¡Œå‹•è‰²å½©
                if (summary.length > 4) {
                    const actionAdvice = document.createElement('div');
                    actionAdvice.className = 'summary-item';
                    actionAdvice.style.cssText = `
                        background: rgba(255,255,255,0.25);
                        font-size: 0.9rem;
                        text-align: center;
                        padding: 10px 14px;
                        border-radius: 10px;
                        border-left: 3px solid rgba(255,200,0,0.8);
                        font-style: italic;
                    `;
                    actionAdvice.textContent = summary[4];
                    container.appendChild(actionAdvice);
                }
            } else {
                // å¦‚æœæ²’æœ‰æ‘˜è¦æ•¸æ“šï¼Œé¡¯ç¤ºé è¨­è¨Šæ¯
                const defaultMsg = document.createElement('div');
                defaultMsg.className = 'summary-item';
                defaultMsg.style.cssText = `
                    background: rgba(255,255,255,0.2);
                    font-size: 0.95rem;
                    text-align: center;
                    color: rgba(255,255,255,0.8);
                    font-style: italic;
                `;
                defaultMsg.textContent = 'â³ æ­£åœ¨åˆ†æå¤©æ°£æ•¸æ“š...';
                container.appendChild(defaultMsg);
            }
        }

        function updateCurrentTime() {
            const currentTimeElement = document.getElementById('currentTime');
            const hkTime = new Date().toLocaleString('zh-TW', {
                timeZone: 'Asia/Hong_Kong',
                weekday: 'long',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            currentTimeElement.textContent = `ğŸ• é¦™æ¸¯æ™‚é–“: ${hkTime}`;
        }

        // ç¸®æ”¾è©³ç´°åˆ†æå› å­å€å¡Š
        function toggleFactorsSection() {
            const grid = document.getElementById('analysisGrid');
            const icon = document.getElementById('factorsToggleIcon');
            
            if (grid.style.maxHeight === '0px' || grid.style.maxHeight === '') {
                // æ”¶èµ·ç‹€æ…‹ -> å±•é–‹
                grid.style.maxHeight = 'none';
                grid.style.opacity = '1';
                grid.style.marginTop = '30px';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = 'ğŸ”¼';
                
                // å„²å­˜ç”¨æˆ¶åå¥½
                localStorage.setItem('factorsExpanded', 'true');
            } else {
                // å±•é–‹ç‹€æ…‹ -> æ”¶èµ·
                grid.style.maxHeight = '0px';
                grid.style.opacity = '0';
                grid.style.marginTop = '0px';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = 'ğŸ”½';
                
                // å„²å­˜ç”¨æˆ¶åå¥½
                localStorage.setItem('factorsExpanded', 'false');
            }
        }

        // ç¸®æ”¾ç…§ç‰‡ä¸Šå‚³å€å¡Š
        function togglePhotoUploadSection() {
            const content = document.getElementById('photoUploadContent');
            const icon = document.getElementById('photoUploadToggleIcon');
            
            if (content.style.display === 'none' || content.style.display === '') {
                // æ”¶èµ·ç‹€æ…‹ -> å±•é–‹
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = 'ğŸ”¼';
                
                // å„²å­˜ç”¨æˆ¶åå¥½
                localStorage.setItem('photoUploadExpanded', 'true');
            } else {
                // å±•é–‹ç‹€æ…‹ -> æ”¶èµ·
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = 'ğŸ”½';
                
                // å„²å­˜ç”¨æˆ¶åå¥½
                localStorage.setItem('photoUploadExpanded', 'false');
            }
        }

        // æ›´æ–°è©•åˆ†é¡¯ç¤º
        function updateRatingDisplay(value) {
            const display = document.getElementById('ratingDisplay');
            const ratingTexts = {
                1: '1/10 ğŸ˜', 2: '2/10 ğŸ˜', 3: '3/10 ğŸ™‚', 4: '4/10 ğŸ˜Š', 5: '5/10 ğŸ˜€',
                6: '6/10 ğŸ˜', 7: '7/10 ğŸ¤©', 8: '8/10 ğŸ”¥', 9: '9/10 ğŸŒŸ', 10: '10/10 âœ¨'
            };
            display.textContent = ratingTexts[value] || `${value}/10`;
        }

        // ç…§ç‰‡ä¸Šå‚³è™•ç†
        document.addEventListener('DOMContentLoaded', function() {
            const photoForm = document.getElementById('photoUploadForm');
            if (photoForm) {
                photoForm.addEventListener('submit', handlePhotoUpload);
            }

            // è¼‰å…¥ç”¨æˆ¶åå¥½
            if (localStorage.getItem('photoUploadExpanded') === 'true') {
                togglePhotoUploadSection();
            }

            // æ›´æ–°æ¡ˆä¾‹æ•¸é‡
            loadPhotoCasesCount();
        });

        async function handlePhotoUpload(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const resultDiv = document.getElementById('photoAnalysisResult');
            
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>
                    <p>ğŸ” æ­£åœ¨åˆ†æç…§ç‰‡...</p>
                </div>
            `;
            
            try {
                const result = await APIUtils.fetchAPI('/api/upload-photo', {
                    method: 'POST',
                    body: formData
                });
                
                if (result.status === 'success') {
                    displayPhotoAnalysisResult(result);
                    loadPhotoCasesCount(); // æ›´æ–°æ¡ˆä¾‹æ•¸é‡
                    form.reset(); // æ¸…ç©ºè¡¨å–®
                    updateRatingDisplay(5); // é‡ç½®è©•åˆ†é¡¯ç¤º
                    
                    // é¡¯ç¤ºå„²å­˜ç‹€æ…‹
                    if (result.saved) {
                        console.log(`ğŸ“ ç…§ç‰‡å·²å„²å­˜: ${result.saved_path}`);
                    } else {
                        console.log('ğŸ“¸ ç…§ç‰‡åƒ…åšåˆ†æï¼Œæœªå„²å­˜');
                    }
                    
                    // é¡¯ç¤ºé æ¸¬æ›´æ–°ç‹€æ…‹
                    if (result.prediction_updated) {
                        showPredictionUpdateNotification();
                        // å¯é¸ï¼šè‡ªå‹•é‡æ–°è¼‰å…¥é æ¸¬
                        setTimeout(() => {
                            console.log('ğŸ”„ é‡æ–°è¼‰å…¥é æ¸¬ä»¥åæ˜ æ–°æ¡ˆä¾‹...');
                            // é€™è£¡å¯ä»¥è§¸ç™¼é æ¸¬é‡æ–°è¼‰å…¥
                            window.location.reload(); // ç°¡å–®çš„é‡æ–°è¼‰å…¥æ–¹å¼
                        }, 2000);
                    }
                } else {
                    throw new Error(result.message || 'ä¸Šå‚³å¤±æ•—');
                }
                
            } catch (error) {
                console.error('âŒ ç…§ç‰‡ä¸Šå‚³éŒ¯èª¤:', error);
                APIUtils.showToast(`ç…§ç‰‡ä¸Šå‚³å¤±æ•—: ${error.message}`, 'error');
                
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; border: 1px solid #f5c6cb;">
                        <h4 style="margin: 0 0 10px 0;">âŒ ä¸Šå‚³å¤±æ•—</h4>
                        <p style="margin: 0;">${error.message}</p>
                    </div>
                `;
            }
        }

        function displayPhotoAnalysisResult(result) {
            const resultDiv = document.getElementById('photoAnalysisResult');
            const analysis = result.photo_analysis;
            
            let qualityClass = 'success';
            let qualityIcon = 'ğŸ”¥';
            if (analysis.quality_score < 4) {
                qualityClass = 'warning';
                qualityIcon = 'ğŸ˜';
            } else if (analysis.quality_score < 7) {
                qualityClass = 'info';
                qualityIcon = 'âœ¨';
            }
            
            resultDiv.innerHTML = `
                <div style="background: white; border: 2px solid #28a745; border-radius: 12px; padding: 20px; margin-top: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #28a745;">ğŸ”¥ ç‡’å¤©é æ¸¬çµæœ</h3>
                    
                    <!-- ç¸½é«”è©•åˆ† -->
                    <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%); color: white; border-radius: 8px;">
                        <h2 style="margin: 0; font-size: 2rem;">${qualityIcon} ${analysis.quality_score.toFixed(1)}/10</h2>
                        <p style="margin: 5px 0 0 0; opacity: 0.9;">${analysis.recommendation}</p>
                    </div>
                    
                    <!-- è©³ç´°åˆ†æ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        ${analysis.color_analysis ? `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #ff6b6b;">
                            <h4 style="margin: 0 0 10px 0; color: #ff6b6b;">ğŸŒˆ é¡è‰²åˆ†æ</h4>
                            <p style="margin: 5px 0;">å¼·åº¦: ${(analysis.color_analysis.intensity * 10).toFixed(1)}/10</p>
                            <p style="margin: 5px 0;">å°æ¯”: ${(analysis.color_analysis.contrast * 10).toFixed(1)}/10</p>
                            <p style="margin: 5px 0;">æš–è‰²æ¯”ä¾‹: ${(analysis.color_analysis.warm_ratio * 100).toFixed(1)}%</p>
                        </div>
                        ` : ''}
                        
                        ${analysis.cloud_analysis ? `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #4ecdc4;">
                            <h4 style="margin: 0 0 10px 0; color: #4ecdc4;">â˜ï¸ é›²å±¤åˆ†æ</h4>
                            <p style="margin: 5px 0;">è®ŠåŒ–: ${(analysis.cloud_analysis.variation * 10).toFixed(1)}/10</p>
                            <p style="margin: 5px 0;">å±¤æ¬¡: ${(analysis.cloud_analysis.layers * 10).toFixed(1)}/10</p>
                            <p style="margin: 5px 0;">è¼ªå»“: ${(analysis.cloud_analysis.edge_definition * 10).toFixed(1)}/10</p>
                        </div>
                        ` : ''}
                        
                        ${analysis.lighting_analysis ? `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #feca57;">
                            <h4 style="margin: 0 0 10px 0; color: #feca57;">ğŸ’¡ å…‰ç·šåˆ†æ</h4>
                            <p style="margin: 5px 0;">äº®åº¦: ${(analysis.lighting_analysis.brightness * 10).toFixed(1)}/10</p>
                            <p style="margin: 5px 0;">é»ƒé‡‘æ¯”ä¾‹: ${(analysis.lighting_analysis.golden_ratio * 10).toFixed(1)}/10</p>
                            <p style="margin: 5px 0;">æŸ”å’Œåº¦: ${(analysis.lighting_analysis.softness * 10).toFixed(1)}/10</p>
                        </div>
                        ` : ''}
                    </div>
                    
                    <!-- æ”¹é€²å»ºè­° -->
                    ${result.suggestions.improvement_tips.length > 0 ? `
                    <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #0066cc; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #0066cc;">ğŸ’¡ æ”¹é€²å»ºè­°</h4>
                        <ul style="margin: 0; padding-left: 20px;">
                            ${result.suggestions.improvement_tips.map(tip => `<li style="margin: 5px 0;">${tip}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    <!-- ä¸‹æ¬¡æ‹æ”å»ºè­° -->
                    <div style="background: #f0f8f0; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                        <h4 style="margin: 0 0 10px 0; color: #28a745;">ğŸ“… ä¸‹æ¬¡æ‹æ”å»ºè­°</h4>
                        <p style="margin: 0;">${result.suggestions.next_shoot_advice}</p>
                    </div>
                    
                    <!-- ç”¨æˆ¶åé¥‹å€åŸŸ -->
                    <div id="feedbackSection" style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin-top: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #856404;">ğŸ“¸ å¯¦éš›ç‡’å¤©å¦‚ä½•ï¼Ÿ</h4>
                        <p style="margin: 0 0 10px 0; font-size: 0.9rem; color: #856404;">å¹«åŠ©æˆ‘å€‘æ”¹é€²é æ¸¬æº–ç¢ºç‡</p>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">å¯¦éš›ç‡’å¤©è©•åˆ† (0-100)ï¼š</label>
                            <input type="range" id="userRating" min="0" max="100" value="50" 
                                   style="width: 100%; margin-bottom: 5px;"
                                   oninput="document.getElementById('ratingValue').textContent = this.value">
                            <div style="text-align: center; font-size: 1.2rem; font-weight: bold; color: #856404;">
                                <span id="ratingValue">50</span> åˆ†
                            </div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">è£œå……èªªæ˜ï¼ˆé¸å¡«ï¼‰ï¼š</label>
                            <textarea id="feedbackComment" rows="2" 
                                      style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"
                                      placeholder="ä¾‹å¦‚ï¼šå¯¦éš›é¡è‰²æ›´è±å¯Œã€é›²å±¤è¼ƒé æœŸåš..."></textarea>
                        </div>
                        <button onclick="submitFeedback()" 
                                style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; width: 100%;">
                            âœ… æäº¤åé¥‹
                        </button>
                    </div>
                </div>
            `;
        }

        async function loadPhotoCases() {
            try {
                const result = await APIUtils.fetchAPI('/api/photo-cases');
                
                if (result.status === 'success') {
                    displayPhotoCases(result);
                }
            } catch (error) {
                console.error('âŒ è¼‰å…¥ç…§ç‰‡æ¡ˆä¾‹éŒ¯èª¤:', error);
                APIUtils.showToast('è¼‰å…¥ç…§ç‰‡æ¡ˆä¾‹å¤±æ•—', 'error');
            }
        }
        
        // æäº¤ç”¨æˆ¶åé¥‹
        let currentPredictedScore = null;
        let currentPredictionTimestamp = null;
        
        async function submitFeedback() {
            try {
                const userRating = parseInt(document.getElementById('userRating').value);
                const comment = document.getElementById('feedbackComment').value;
                
                if (currentPredictedScore === null) {
                    APIUtils.showToast('è«‹å…ˆé€²è¡Œç‡’å¤©é æ¸¬', 'warning');
                    return;
                }
                
                const button = event.target;
                button.disabled = true;
                button.textContent = 'â³ æäº¤ä¸­...';
                
                const response = await fetch('/api/submit-feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        predicted_score: currentPredictedScore,
                        user_rating: userRating,
                        comment: comment,
                        prediction_timestamp: currentPredictionTimestamp
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    APIUtils.showToast('æ„Ÿè¬æ‚¨çš„åé¥‹ï¼æ‚¨çš„è²¢ç»å¹«åŠ©æˆ‘å€‘æ”¹é€²é æ¸¬æº–ç¢ºç‡', 'success');
                    
                    // é¡¯ç¤ºæº–ç¢ºç‡çµ±è¨ˆ
                    if (result.accuracy_stats && result.accuracy_stats.has_data) {
                        const stats = result.accuracy_stats;
                        document.getElementById('feedbackSection').innerHTML = `
                            <div style="text-align: center; padding: 20px;">
                                <div style="font-size: 2rem; margin-bottom: 10px;">âœ…</div>
                                <h4 style="margin: 0 0 10px 0; color: #28a745;">åé¥‹å·²æäº¤</h4>
                                <p style="margin: 5px 0; color: #666;">ç•¶å‰ç³»çµ±æº–ç¢ºç‡: <strong>${stats.accuracy}%</strong></p>
                                <p style="margin: 5px 0; color: #666;">åŸºæ–¼ ${stats.feedback_count} å€‹ç”¨æˆ¶åé¥‹</p>
                                <p style="margin: 5px 0; color: #666; font-size: 0.9rem;">
                                    ${stats.within_10_points}% çš„é æ¸¬èª¤å·®åœ¨ 10 åˆ†å…§
                                </p>
                            </div>
                        `;
                    }
                } else {
                    APIUtils.showToast(result.message || 'æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
                    button.disabled = false;
                    button.textContent = 'âœ… æäº¤åé¥‹';
                }
            } catch (error) {
                console.error('âŒ æäº¤åé¥‹éŒ¯èª¤:', error);
                APIUtils.showToast('ç¶²çµ¡éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
                event.target.disabled = false;
                event.target.textContent = 'âœ… æäº¤åé¥‹';
            }
        }

        async function loadPhotoCasesCount() {
            try {
                const result = await APIUtils.fetchAPI('/api/photo-cases');
                
                if (result.status === 'success') {
                    const countElement = document.getElementById('casesCount');
                    if (countElement) {
                        countElement.textContent = result.total_cases;
                    }
                }
            } catch (error) {
                console.error('âŒ è¼‰å…¥æ¡ˆä¾‹æ•¸é‡éŒ¯èª¤:', error);
            }
        }
        
        // è¼‰å…¥å³æ™‚ç›¸ç‰‡äº¤å‰é©—è­‰æ•¸æ“š
        async function loadCrossCheckData() {
            try {
                const data = await APIUtils.fetchAPI('/api/prediction/cross-check');
                
                if (data.status === 'success') {
                    const crossCheck = data.cross_check;
                    const webcam = data.webcam_data;
                    
                    // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
                    const scoreElement = document.getElementById('crossCheckScore');
                    const contentElement = document.getElementById('crossCheckContent');
                    
                    if (scoreElement && contentElement) {
                        // æ ¹æ“šä¸€è‡´æ€§è¨­å®šé¡è‰²
                        let consistencyColor = '#00b894';
                        if (crossCheck.consistency === 'excellent') consistencyColor = '#00b894';
                        else if (crossCheck.consistency === 'good') consistencyColor = '#fdcb6e';
                        else if (crossCheck.consistency === 'fair') consistencyColor = '#e17055';
                        else consistencyColor = '#d63031';
                        
                        scoreElement.textContent = crossCheck.consistency_text;
                        scoreElement.style.color = consistencyColor;
                        
                        // æ§‹å»ºå…§å®¹
                        let content = `
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
                                <div style="text-align: center; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${crossCheck.prediction_score}</div>
                                    <div style="font-size: 0.85rem; color: #666;">ç®—æ³•é æ¸¬</div>
                                </div>
                                <div style="text-align: center; padding: 10px; background: rgba(0, 184, 148, 0.1); border-radius: 8px;">
                                    <div style="font-size: 1.5rem; font-weight: bold; color: #00b894;">${crossCheck.webcam_score}</div>
                                    <div style="font-size: 0.85rem; color: #666;">å³æ™‚ç›¸ç‰‡</div>
                                </div>
                            </div>
                            <div style="margin: 10px 0; padding: 10px; background: rgba(${consistencyColor === '#00b894' ? '0, 184, 148' : consistencyColor === '#fdcb6e' ? '253, 203, 110' : '214, 48, 49'}, 0.1); border-radius: 8px; border-left: 3px solid ${consistencyColor};">
                                <strong>è©•ä¼°ï¼š</strong>${crossCheck.consistency_text}<br>
                                <small>åˆ†æ•¸å·®ç•°: ${crossCheck.score_difference}åˆ†</small>
                            </div>
                        `;
                        
                        if (!webcam.is_sunset_time) {
                            content += `<small style="color: #e17055;">â° ç•¶å‰éç‡’å¤©æ™‚æ®µï¼Œå¯¦æ³åˆ†æ•¸å·²èª¿æ•´</small><br>`;
                        }
                        
                        if (data.analysis_notes && data.analysis_notes.length > 0) {
                            content += `<small style="color: #666;">ğŸ’¡ ${data.analysis_notes.join(' | ')}</small><br>`;
                        }
                        
                        content += `<br><small style="color: #888; font-style: italic;">ğŸ“Š ${data.recommendation}</small>`;
                        content += `<br><br><small style="color: #999;">å·²åˆ†æ ${webcam.webcam_count} å€‹æ”å½±æ©Ÿä½ç½®</small>`;
                        
                        contentElement.innerHTML = content;
                    }
                }
            } catch (error) {
                console.error('âŒ è¼‰å…¥äº¤å‰é©—è­‰å¤±æ•—:', error);
                const scoreElement = document.getElementById('crossCheckScore');
                const contentElement = document.getElementById('crossCheckContent');
                if (scoreElement) scoreElement.textContent = 'è¼‰å…¥å¤±æ•—';
                if (contentElement) contentElement.innerHTML = '<small style="color: #999;">ç„¡æ³•è¼‰å…¥å³æ™‚ç›¸ç‰‡åˆ†æ</small>';
            }
        }

        function displayPhotoCases(result) {
            const resultDiv = document.getElementById('photoAnalysisResult');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div style="background: white; border: 2px solid #667eea; border-radius: 12px; padding: 20px; margin-top: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #667eea;">ğŸ§  ç…§ç‰‡æ¡ˆä¾‹å­¸ç¿’ç‹€æ…‹</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <h4 style="margin: 0 0 10px 0; color: #667eea;">ğŸ“Š ç¸½æ¡ˆä¾‹æ•¸</h4>
                            <div style="font-size: 2rem; font-weight: bold; color: #333;">${result.total_cases}</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <h4 style="margin: 0 0 10px 0; color: #28a745;">âœ… æˆåŠŸæ¡ˆä¾‹</h4>
                            <div style="font-size: 2rem; font-weight: bold; color: #333;">${result.successful_cases || 0}</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <h4 style="margin: 0 0 10px 0; color: #ffa500;">ğŸ¯ å­¸ç¿’æ•ˆæœ</h4>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #333;">æå‡ä¸­</div>
                        </div>
                    </div>
                    
                    ${result.patterns && result.patterns.successful_conditions ? `
                    <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #0066cc;">
                        <h4 style="margin: 0 0 10px 0; color: #0066cc;">ğŸ“ˆ å­¸ç¿’æ¨¡å¼</h4>
                        <p style="margin: 0;">ç³»çµ±å·²åˆ†ææˆåŠŸæ¡ˆä¾‹çš„æ¨¡å¼ï¼Œæ­£åœ¨æŒçºŒæ”¹é€²é æ¸¬ç®—æ³•çš„æº–ç¢ºåº¦</p>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function showPredictionUpdateNotification() {
            // å‰µå»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
                font-family: inherit;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="font-size: 24px;">ğŸš€</div>
                    <div>
                        <div style="font-weight: bold; margin-bottom: 5px;">é æ¸¬å·²æ›´æ–°</div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">æ–°ç…§ç‰‡æ¡ˆä¾‹å·²åŠ å…¥å­¸ç¿’ç³»çµ±ï¼Œé é¢å°‡è‡ªå‹•é‡æ–°è¼‰å…¥</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // 3ç§’å¾Œç§»é™¤é€šçŸ¥
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        async function manualUpdatePrediction() {
            try {
                const result = await APIUtils.fetchAPI('/api/prediction/update', {
                    method: 'POST'
                });
                
                if (result.status === 'success') {
                    showPredictionUpdateNotification();
                    console.log(`ğŸš€ æ‰‹å‹•è§¸ç™¼é æ¸¬æ›´æ–°: æ¸…é™¤äº† ${result.cleared_cache_count} å€‹å¿«å–`);
                    
                    // é‡æ–°è¼‰å…¥é æ¸¬
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    console.error('é æ¸¬æ›´æ–°å¤±æ•—:', result.message);
                    APIUtils.showToast(`é æ¸¬æ›´æ–°å¤±æ•—: ${result.message}`, 'error');
                }
            } catch (error) {
                console.error('âŒ é æ¸¬æ›´æ–°éŒ¯èª¤:', error);
                APIUtils.showToast('é æ¸¬æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦', 'error');
            }
        }

        async function checkPredictionStatus() {
            try {
                const result = await APIUtils.fetchAPI('/api/prediction/status');
                
                if (result.status === 'success') {
                    const system = result.prediction_system;
                    console.log(`ğŸ“Š é æ¸¬ç³»çµ±ç‹€æ…‹:`, {
                        ç¸½æ¡ˆä¾‹æ•¸: system.total_cases,
                        å¿«å–é …ç›®: system.cache_status.total_cache_items,
                        é æ¸¬å¿«å–: system.cache_status.prediction_cache_items,
                        å­¸ç¿’å•Ÿç”¨: system.learning_active
                    });
                    return system;
                }
            } catch (error) {
                console.error('âŒ ç²å–é æ¸¬ç‹€æ…‹éŒ¯èª¤:', error);
                // ç‹€æ…‹æŸ¥è©¢å¤±æ•—ä¸é¡¯ç¤º Toastï¼Œä¸å½±éŸ¿ä½¿ç”¨è€…é«”é©—
            }
            return null;
        }

        // åˆå§‹åŒ–è©³ç´°åˆ†æå› å­å€å¡Šç‹€æ…‹
        function initializeFactorsSection() {
            const grid = document.getElementById('analysisGrid');
            const icon = document.getElementById('factorsToggleIcon');
            const expanded = localStorage.getItem('factorsExpanded');
            
            // é è¨­å±•é–‹ï¼Œé™¤éç”¨æˆ¶ä¹‹å‰æ”¶èµ·é
            if (expanded === 'false') {
                grid.style.maxHeight = '0px';
                grid.style.opacity = '0';
                grid.style.marginTop = '0px';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = 'ğŸ”½';
            } else {
                grid.style.maxHeight = 'none';
                grid.style.opacity = '1';
                grid.style.marginTop = '30px';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = 'ğŸ”¼';
            }
        }

        // åˆ‡æ›ç‡’å¤©æŒ‡æ•¸å°ç…§è¡¨
        function toggleScoreReference() {
            const content = document.getElementById('scoreReferenceContent');
            const icon = document.getElementById('scoreReferenceToggleIcon');
            
            if (content.style.display === 'none' || content.style.display === '') {
                // æ”¶èµ·ç‹€æ…‹ -> å±•é–‹
                content.style.display = 'block';
                content.style.animation = 'slideDown 0.3s ease';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = 'ğŸ”¼';
                
                // é«˜äº®ç•¶å‰åˆ†æ•¸ç¯„åœ
                highlightCurrentScoreRange();
                
                // å„²å­˜ç”¨æˆ¶åå¥½
                localStorage.setItem('scoreReferenceExpanded', 'true');
            } else {
                // å±•é–‹ç‹€æ…‹ -> æ”¶èµ·
                content.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    content.style.display = 'none';
                }, 280);
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = 'ğŸ”½';
                
                // å„²å­˜ç”¨æˆ¶åå¥½
                localStorage.setItem('scoreReferenceExpanded', 'false');
            }
        }

        // é«˜äº®ç•¶å‰ç‡’å¤©åˆ†æ•¸å°æ‡‰çš„ç¯„åœ
        function highlightCurrentScoreRange() {
            const scoreElement = document.getElementById('scoreNumber');
            const currentScore = parseInt(scoreElement.textContent) || 0;
            const scoreItems = document.querySelectorAll('.score-range-item');
            
            // æ¸…é™¤æ‰€æœ‰é«˜äº®
            scoreItems.forEach(item => {
                item.style.transform = 'scale(1)';
                item.style.boxShadow = 'none';
                item.style.border = 'none';
            });
            
            // æ ¹æ“šåˆ†æ•¸é«˜äº®å°æ‡‰ç¯„åœ
            let targetItem = null;
            if (currentScore >= 80) {
                targetItem = scoreItems[0]; // 80-100
            } else if (currentScore >= 65) {
                targetItem = scoreItems[1]; // 65-79
            } else if (currentScore >= 50) {
                targetItem = scoreItems[2]; // 50-64
            } else if (currentScore >= 30) {
                targetItem = scoreItems[3]; // 30-49
            } else {
                targetItem = scoreItems[4]; // 0-29
            }
            
            if (targetItem) {
                targetItem.style.transform = 'scale(1.05)';
                targetItem.style.boxShadow = '0 6px 20px rgba(255,255,255,0.3), 0 0 0 3px rgba(255,255,255,0.5)';
                targetItem.style.border = '2px solid rgba(255,255,255,0.8)';
                
                // æ·»åŠ è„ˆè¡å‹•ç•«
                targetItem.style.animation = 'pulse 2s infinite';
            }
        }

        // æ›´æ–°ç•¶å‰è­¦å‘Šé¡¯ç¤º - ä¿®æ”¹ç‚ºå¡ç‰‡æ¨¡å¼æ·»åŠ åˆ°å¤©æ°£æ•¸æ“š
        function updateCurrentWarnings(analysisDetails) {
            console.log('ğŸ” updateCurrentWarnings è¢«èª¿ç”¨', analysisDetails);
            
            if (!analysisDetails || !analysisDetails.weather_warnings) {
                console.log('âŒ æ²’æœ‰è­¦å‘Šæ•¸æ“š');
                return;
            }

            const weatherWarnings = analysisDetails.weather_warnings;
            console.log('ğŸš¨ weather_warnings æ•¸æ“š:', weatherWarnings);
            
            // æª¢æŸ¥æ˜¯å¦æœ‰è­¦å‘Š
            if (!weatherWarnings.detailed_analysis || weatherWarnings.detailed_analysis.length === 0) {
                console.log('âŒ ç„¡è©³ç´°è­¦å‘Šåˆ†ææ•¸æ“š');
                return;
            }

            console.log(`âœ… ç™¼ç¾ ${weatherWarnings.detailed_analysis.length} å€‹è­¦å‘Šï¼Œå°‡ä»¥å¡ç‰‡å½¢å¼æ·»åŠ åˆ°å¤©æ°£æ•¸æ“š`);
            
            // å–å¾—å¤©æ°£æ•¸æ“šå®¹å™¨
            const weatherContainer = document.getElementById('weatherData');
            if (!weatherContainer) {
                console.log('âŒ æ‰¾ä¸åˆ° weatherData å®¹å™¨');
                return;
            }
            
            // ç‚ºæ¯å€‹è­¦å‘Šå‰µå»ºå¤©æ°£å¡ç‰‡
            weatherWarnings.detailed_analysis.forEach((warning, index) => {
                // æ ¹æ“šè­¦å‘Šé¡å‹è¨­å®šåœ–ç¤ºå’Œé¡è‰²
                let icon = 'âš ï¸';
                let typeDesc = 'æ°£è±¡è­¦å‘Š';
                
                if (warning.category === 'thunderstorm') {
                    icon = 'â›ˆï¸';
                    typeDesc = 'é›·æš´è­¦å‘Š';
                } else if (warning.category === 'temperature') {
                    icon = 'ğŸŒ¡ï¸';
                    typeDesc = 'æº«åº¦è­¦å‘Š';
                } else if (warning.category === 'wind_storm') {
                    icon = 'ğŸ’¨';
                    typeDesc = 'é¢¨æš´è­¦å‘Š';
                } else if (warning.category === 'rain') {
                    icon = 'ğŸŒ§ï¸';
                    typeDesc = 'é™é›¨è­¦å‘Š';
                }

                // åš´é‡ç­‰ç´š
                const severityMap = {
                    'extreme': 'æ¥µç«¯',
                    'severe': 'åš´é‡', 
                    'moderate': 'ä¸­ç­‰',
                    'low': 'è¼•å¾®'
                };
                const severityDesc = severityMap[warning.severity] || warning.severity || 'ä¸­ç­‰';
                const levelDesc = warning.level ? `${warning.level}ç´š` : '';

                // å‰µå»ºè­¦å‘Šå¡ç‰‡
                const warningCard = `
                    <div class="weather-card" style="border-left: 4px solid #ff6b6b;">
                        <div class="weather-icon">${icon}</div>
                        <div class="weather-value" style="font-size: 1.2rem;">${typeDesc}</div>
                        <div class="weather-label">
                            ${severityDesc}${levelDesc ? ` â€¢ ${levelDesc}` : ''}<br>
                            <small>ç¾æ­£ç”Ÿæ•ˆä¸­</small>
                        </div>
                    </div>
                `;
                
                weatherContainer.innerHTML += warningCard;
            });

            // å„²å­˜è­¦å‘Šæ•¸æ“šä¾›åˆ†æå› å­ä½¿ç”¨
            window.currentWarningData = weatherWarnings;
        }

        // åˆå§‹åŒ–ç‡’å¤©æŒ‡æ•¸å°ç…§è¡¨ç‹€æ…‹
        function initializeScoreReferenceSection() {
            const content = document.getElementById('scoreReferenceContent');
            const icon = document.getElementById('scoreReferenceToggleIcon');
            const expanded = localStorage.getItem('scoreReferenceExpanded');
            
            // é è¨­æ”¶èµ·ï¼Œç”¨æˆ¶é»æ“Šå¾Œæ‰å±•é–‹
            if (expanded === 'true') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = 'ğŸ”¼';
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = 'ğŸ”½';
            }
        }

        // ç‡’å¤©æ­·å²çµ±è¨ˆç›¸é—œåŠŸèƒ½
        // ä¿å­˜åœ–è¡¨å¯¦ä¾‹ä»¥ä¾¿éŠ·æ¯€é‡å»º
        let burnskyCharts = {
            scoreDistChart: null,
            typeChart: null,
            trendChart: null,
            comparisonChart: null
        };
        
        function toggleBurnskyHistorySection() {
            const content = document.getElementById('burnskyHistoryContent');
            const icon = document.getElementById('burnskyHistoryToggleIcon');
            
            if (content.style.display === 'none' || content.style.display === '') {
                // æ”¶èµ·ç‹€æ…‹ -> å±•é–‹
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = 'ğŸ”¼';
                
                // åˆ‡æ›åˆ°ç¸½è¦½æ¨™ç±¤ï¼ˆæœƒè‡ªå‹•è¼‰å…¥æ•¸æ“šå’Œåœ–è¡¨ï¼‰
                switchBurnskyTab('overview');
                
                // å„²å­˜ç”¨æˆ¶åå¥½
                localStorage.setItem('burnskyHistoryExpanded', 'true');
            } else {
                // å±•é–‹ç‹€æ…‹ -> æ”¶èµ·
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = 'ğŸ”½';
                
                // å„²å­˜ç”¨æˆ¶åå¥½
                localStorage.setItem('burnskyHistoryExpanded', 'false');
            }
        }

        function switchBurnskyTab(tabName) {
            // æ›´æ–°æ¨™ç±¤æŒ‰éˆ•ç‹€æ…‹
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.classList.remove('active');
                btn.style.color = '#666';
                btn.style.borderBottomColor = 'transparent';
                btn.style.background = 'none';
            });
            
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.color = '#667eea';
                activeBtn.style.borderBottomColor = '#667eea';
                activeBtn.style.background = 'rgba(102, 126, 234, 0.1)';
            }
            
            // æ›´æ–°å…§å®¹å€åŸŸ
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });
            
            const activeContent = document.getElementById(`${tabName}Tab`);
            if (activeContent) {
                activeContent.style.display = 'block';
                activeContent.classList.add('active');
            }
            
            // æ ¹æ“šé¸é …å¡è¼‰å…¥å°æ‡‰æ•¸æ“š
            switch(tabName) {
                case 'overview':
                    loadBurnskyOverview();
                    setTimeout(() => loadBurnskyCharts(), 100);
                    break;
                case 'trends':
                    loadBurnskyTrends();
                    break;
                case 'comparison':
                    loadBurnskyComparison();
                    break;
                case 'insights':
                    loadBurnskyInsights();
                    break;
            }
        }

        async function loadBurnskyOverview() {
            try {
                const timestamp = Date.now();
                const data = await APIUtils.fetchAPI(`/api/burnsky/history?_refresh=${timestamp}`);
                
                // æ›´æ–°çµ±è¨ˆå¡ç‰‡
                document.getElementById('totalPredictions').textContent = data.summary.total_predictions || '0';
                document.getElementById('highScoreCount').textContent = data.summary.high_score_count || '0';
                document.getElementById('mediumScoreCount').textContent = data.summary.medium_score_count || '0';
                document.getElementById('successRate').textContent = data.summary.success_rate ? `${data.summary.success_rate}%` : '-';
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥ç‡’å¤©æ­·å²æ•¸æ“šå¤±æ•—:', error);
                document.getElementById('totalPredictions').textContent = '0';
                document.getElementById('highScoreCount').textContent = '0';
                document.getElementById('mediumScoreCount').textContent = '0';
                document.getElementById('successRate').textContent = '-';
            }
        }

        async function loadBurnskyCharts() {
            try {
                const data = await APIUtils.fetchAPI('/api/burnsky/history');
                
                // è©•åˆ†åˆ†å¸ƒåœ–
                const scoreDistContainer = document.getElementById('scoreDistributionChart');
                if (scoreDistContainer && data.summary) {
                    // å…ˆéŠ·æ¯€æ‰€æœ‰åœ–è¡¨å¯¦ä¾‹
                    if (burnskyCharts.scoreDistChart) {
                        try { burnskyCharts.scoreDistChart.destroy(); } catch(e) {}
                        burnskyCharts.scoreDistChart = null;
                    }
                    
                    // ä½¿ç”¨æ™‚é–“æˆ³å‰µå»ºå”¯ä¸€IDé¿å…Chart.jsè¿½è¹¤è¡çª
                    const canvasId = 'scoreDistChartCanvas_' + Date.now();
                    scoreDistContainer.innerHTML = `<canvas id="${canvasId}" style="width: 100%; height: 100%;"></canvas>`;
                    
                    // ç­‰å¾…DOMæ›´æ–°
                    await new Promise(resolve => setTimeout(resolve, 10));
                    
                    const scoreDistCanvas = document.getElementById(canvasId);
                    const ctx = scoreDistCanvas.getContext('2d');
                    burnskyCharts.scoreDistChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['é«˜åˆ† (â‰¥70)', 'ä¸­åˆ† (50-69)', 'ä½åˆ† (<50)'],
                            datasets: [{
                                data: [
                                    data.summary.high_score_count || 0,
                                    data.summary.medium_score_count || 0,
                                    data.summary.low_score_count || 0
                                ],
                                backgroundColor: ['#4CAF50', '#a855f7', '#FF5252'],
                                borderWidth: 2,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: { color: '#333', font: { size: 12 } }
                                }
                            }
                        }
                    });
                }
                
                // é æ¸¬é¡å‹çµ±è¨ˆåœ–
                const typeContainer = document.getElementById('predictionTypeChart');
                if (typeContainer && data.by_type) {
                    // å…ˆéŠ·æ¯€æ‰€æœ‰åœ–è¡¨å¯¦ä¾‹
                    if (burnskyCharts.typeChart) {
                        try { burnskyCharts.typeChart.destroy(); } catch(e) {}
                        burnskyCharts.typeChart = null;
                    }
                    
                    // ä½¿ç”¨æ™‚é–“æˆ³å‰µå»ºå”¯ä¸€ID
                    const canvasId = 'typeChartCanvas_' + Date.now();
                    typeContainer.innerHTML = `<canvas id="${canvasId}" style="width: 100%; height: 100%;"></canvas>`;
                    
                    // ç­‰å¾…DOMæ›´æ–°
                    await new Promise(resolve => setTimeout(resolve, 10));
                    
                    const typeCanvas = document.getElementById(canvasId);
                    const types = Object.keys(data.by_type);
                    const counts = types.map(t => data.by_type[t].count);
                    const avgScores = types.map(t => data.by_type[t].avg_score);
                    
                    const ctx = typeCanvas.getContext('2d');
                    burnskyCharts.typeChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: types.map(t => t === 'sunrise' ? 'æ—¥å‡º' : t === 'sunset' ? 'æ—¥è½' : 'ä¸€èˆ¬'),
                            datasets: [
                                {
                                    label: 'é æ¸¬æ¬¡æ•¸',
                                    data: counts,
                                    backgroundColor: 'rgba(102, 126, 234, 0.6)',
                                    borderColor: '#667eea',
                                    borderWidth: 2,
                                    yAxisID: 'y'
                                },
                                {
                                    label: 'å¹³å‡è©•åˆ†',
                                    data: avgScores,
                                    type: 'line',
                                    borderColor: '#ff6b6b',
                                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                                    borderWidth: 3,
                                    yAxisID: 'y1',
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'é æ¸¬æ¬¡æ•¸', color: '#666' }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'å¹³å‡è©•åˆ†', color: '#666' },
                                    grid: { drawOnChartArea: false }
                                }
                            }
                        }
                    });
                }
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥ç‡’å¤©åœ–è¡¨å¤±æ•—:', error);
            }
        }

        async function loadBurnskyTrends() {
            try {
                console.log('ğŸ” é–‹å§‹è¼‰å…¥è©•åˆ†è¶¨å‹¢...');
                const data = await APIUtils.fetchAPI('/api/burnsky/history');
                console.log('ğŸ“Š æ”¶åˆ°æ•¸æ“š:', data);
                
                const trendContainer = document.getElementById('dailyTrendChart');
                console.log('ğŸ“¦ å®¹å™¨å…ƒç´ :', trendContainer);
                
                if (!trendContainer) {
                    console.error('âŒ å®¹å™¨å…ƒç´ ä¸å­˜åœ¨!');
                    return;
                }
                
                if (!data.daily_trends || data.daily_trends.length === 0) {
                    console.warn('âš ï¸ æ²’æœ‰è¶¨å‹¢æ•¸æ“š');
                    trendContainer.innerHTML = '<div style="text-align: center; padding: 50px; color: #999;">æš«ç„¡è©•åˆ†è¶¨å‹¢æ•¸æ“š</div>';
                    return;
                }
                
                // é‡æ–°å‰µå»ºcanvasï¼ˆä½¿ç”¨å”¯ä¸€IDï¼‰
                const canvasId = 'trendChartCanvas_' + Date.now();
                trendContainer.innerHTML = `<canvas id="${canvasId}" style="width: 100%; height: 100%;"></canvas>`;
                
                // ç­‰å¾…DOMæ›´æ–°
                await new Promise(resolve => setTimeout(resolve, 10));
                
                const trendCanvas = document.getElementById(canvasId);
                
                const dates = data.daily_trends.map(d => d.date).reverse();
                const scores = data.daily_trends.map(d => d.avg_score).reverse();
                console.log('ğŸ“… æ—¥æœŸ:', dates);
                console.log('ğŸ“ˆ åˆ†æ•¸:', scores);
                
                // ç¢ºä¿canvaså·²å¯è¦‹å†æ¸²æŸ“
                setTimeout(() => {
                    console.log('ğŸ¨ é–‹å§‹æ¸²æŸ“åœ–è¡¨...');
                    console.log('Canvaså¯¬åº¦:', trendCanvas.width, 'é«˜åº¦:', trendCanvas.height);
                    console.log('Canvas offsetWidth:', trendCanvas.offsetWidth, 'offsetHeight:', trendCanvas.offsetHeight);
                    
                    const ctx = trendCanvas.getContext('2d');
                    burnskyCharts.trendChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: 'æ¯æ—¥å¹³å‡è©•åˆ†',
                                data: scores,
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    title: { display: true, text: 'è©•åˆ†', color: '#666' }
                                },
                                x: {
                                    title: { display: true, text: 'æ—¥æœŸ', color: '#666' }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: true,
                                    labels: { color: '#333', font: { size: 12 } }
                                }
                            }
                        }
                    });
                    console.log('âœ… åœ–è¡¨æ¸²æŸ“å®Œæˆ!', burnskyCharts.trendChart);
                }, 200);
            } catch (error) {
                console.error('âŒ è¼‰å…¥è©•åˆ†è¶¨å‹¢å¤±æ•—:', error);
                APIUtils.showToast('è©•åˆ†è¶¨å‹¢è¼‰å…¥å¤±æ•—', 'warning', 3000);
            }
        }

        async function loadBurnskyComparison() {
            try {
                console.log('ğŸ” é–‹å§‹è¼‰å…¥æ—¥å‡ºæ—¥è½å°æ¯”...');
                const data = await APIUtils.fetchAPI('/api/burnsky/history');
                console.log('ğŸ“Š æ”¶åˆ°æ•¸æ“š:', data);
                
                if (data.by_type) {
                    const sunriseData = data.by_type.sunrise || {};
                    const sunsetData = data.by_type.sunset || {};
                    console.log('ğŸŒ… æ—¥å‡ºæ•¸æ“š:', sunriseData);
                    console.log('ğŸŒ‡ æ—¥è½æ•¸æ“š:', sunsetData);
                    
                    // æ›´æ–°çµ±è¨ˆå¡ç‰‡
                    document.getElementById('sunriseAvg').textContent = sunriseData.avg_score ? sunriseData.avg_score.toFixed(1) : '-';
                    document.getElementById('sunsetAvg').textContent = sunsetData.avg_score ? sunsetData.avg_score.toFixed(1) : '-';
                    
                    const better = (sunriseData.avg_score || 0) > (sunsetData.avg_score || 0) ? 'æ—¥å‡º' : 'æ—¥è½';
                    document.getElementById('betterType').textContent = better;
                    console.log('ğŸ† è¡¨ç¾è¼ƒä½³:', better);
                    
                    // è¼‰å…¥å°æ¯”åœ–è¡¨
                    const compContainer = document.getElementById('comparisonChart');
                    console.log('ğŸ“¦ å°æ¯”å®¹å™¨å…ƒç´ :', compContainer);
                    
                    if (compContainer) {
                        // å…ˆéŠ·æ¯€èˆŠåœ–è¡¨
                        if (burnskyCharts.comparisonChart) {
                            try { burnskyCharts.comparisonChart.destroy(); } catch(e) {}
                            burnskyCharts.comparisonChart = null;
                        }
                        
                        // å»¶é²æ¸²æŸ“ç¢ºä¿canvaså¯è¦‹
                        setTimeout(async () => {
                            // é‡æ–°å‰µå»ºcanvasï¼ˆä½¿ç”¨å”¯ä¸€IDï¼‰
                            const canvasId = 'comparisonChartCanvas_' + Date.now();
                            compContainer.innerHTML = `<canvas id="${canvasId}" style="width: 100%; height: 100%;"></canvas>`;
                            
                            // ç­‰å¾…DOMæ›´æ–°
                            await new Promise(resolve => setTimeout(resolve, 10));
                            
                            const compCanvas = document.getElementById(canvasId);
                            
                            console.log('ğŸ¨ é–‹å§‹æ¸²æŸ“å°æ¯”åœ–è¡¨...');
                            const ctx = compCanvas.getContext('2d');
                            burnskyCharts.comparisonChart = new Chart(ctx, {
                            type: 'radar',
                            data: {
                                labels: ['å¹³å‡è©•åˆ†', 'æœ€é«˜è©•åˆ†', 'é æ¸¬æ¬¡æ•¸', 'é«˜åˆ†ç‡'],
                                datasets: [
                                    {
                                        label: 'æ—¥å‡º',
                                        data: [
                                            sunriseData.avg_score || 0,
                                            sunriseData.max_score || 0,
                                            (sunriseData.count || 0) / 10,
                                            ((sunriseData.high_score_count || 0) / (sunriseData.count || 1)) * 100
                                        ],
                                        borderColor: '#FF6B6B',
                                        backgroundColor: 'rgba(255, 107, 107, 0.2)',
                                        borderWidth: 2
                                    },
                                    {
                                        label: 'æ—¥è½',
                                        data: [
                                            sunsetData.avg_score || 0,
                                            sunsetData.max_score || 0,
                                            (sunsetData.count || 0) / 10,
                                            ((sunsetData.high_score_count || 0) / (sunsetData.count || 1)) * 100
                                        ],
                                        borderColor: '#4ECDC4',
                                        backgroundColor: 'rgba(78, 205, 196, 0.2)',
                                        borderWidth: 2
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    r: {
                                        beginAtZero: true,
                                        max: 100
                                    }
                                }
                            }
                        });
                        console.log('âœ… å°æ¯”åœ–è¡¨æ¸²æŸ“å®Œæˆ!');
                        }, 100); // å»¶é²100msç¢ºä¿DOMå·²æ¸²æŸ“
                    }
                }
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥æ—¥å‡ºæ—¥è½å°æ¯”å¤±æ•—:', error);
                APIUtils.showToast('å°æ¯”æ•¸æ“šè¼‰å…¥å¤±æ•—', 'warning', 3000);
            }
        }

        async function loadBurnskyInsights() {
            try {
                const data = await APIUtils.fetchAPI('/api/burnsky/history');
                
                // æœ€ä½³æ‹æ”æ™‚æ®µ
                if (data.best_hours) {
                    const hours = data.best_hours.slice(0, 5);
                    const hoursHtml = hours.map(h => 
                        `<div style="padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 6px; margin-bottom: 8px;">
                            <strong>${h.hour}:00</strong> - å¹³å‡è©•åˆ†: ${h.avg_score.toFixed(1)} (${h.count}æ¬¡é æ¸¬)
                        </div>`
                    ).join('');
                    document.getElementById('bestHoursInsight').innerHTML = hoursHtml || 'æš«ç„¡æ•¸æ“š';
                }
                
                // çµ±è¨ˆç¸½çµ
                if (data.summary) {
                    const statsHtml = `
                        <p>éå»30å¤©å…±é€²è¡Œäº† <strong>${data.summary.total_predictions}</strong> æ¬¡ç‡’å¤©é æ¸¬ï¼Œ
                        å¹³å‡è©•åˆ†ç‚º <strong>${data.summary.avg_score.toFixed(1)}</strong>ã€‚
                        å…¶ä¸­æœ‰ <strong>${data.summary.high_score_count}</strong> æ¬¡ç²å¾—é«˜åˆ†è©•åƒ¹ï¼ˆâ‰¥70åˆ†ï¼‰ï¼Œ
                        æˆåŠŸç‡é” <strong>${data.summary.success_rate}%</strong>ã€‚</p>
                        <p>æœ€é«˜è©•åˆ†: <strong>${data.summary.max_score}</strong>ï¼Œ
                        æœ€ä½è©•åˆ†: <strong>${data.summary.min_score}</strong>ã€‚</p>
                    `;
                    document.getElementById('statisticsSummary').innerHTML = statsHtml;
                }
                
                // AI åˆ†æå»ºè­°
                if (data.insights && data.insights.length > 0) {
                    const insightsHtml = '<ul style="padding-left: 20px;">' +
                        data.insights.map(insight => `<li style="margin-bottom: 8px;">${insight}</li>`).join('') +
                        '</ul>';
                    document.getElementById('aiInsights').innerHTML = insightsHtml;
                } else {
                    document.getElementById('aiInsights').innerHTML = '<p style="color: #999;">æš«ç„¡åˆ†æå»ºè­°</p>';
                }
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥æ•¸æ“šæ´å¯Ÿå¤±æ•—:', error);
                APIUtils.showToast('æ•¸æ“šæ´å¯Ÿè¼‰å…¥å¤±æ•—', 'warning', 3000);
            }
        }



        // (èˆŠè­¦å‘Šåˆ†æå‡½æ•¸å·²åˆªé™¤ - å·²é‡æ§‹ç‚ºç‡’å¤©æ­·å²åˆ†æ)

        // è­¦å‘Šåœ–è¡¨è®Šé‡
        let timelineChart = null;
        let categoryChart = null;

        // è¼‰å…¥è­¦å‘Šåœ–è¡¨
        async function loadWarningCharts() {
            try {
                // è¼‰å…¥æ™‚é–“è»¸åœ–è¡¨
                await loadTimelineChart();
                // è¼‰å…¥é¡åˆ¥åˆ†å¸ƒåœ–è¡¨  
                await loadCategoryChart();
            } catch (error) {
                console.error('è¼‰å…¥è­¦å‘Šåœ–è¡¨å¤±æ•—:', error);
            }
        }

        // è¼‰å…¥æ™‚é–“è»¸åœ–è¡¨
        async function loadTimelineChart() {
            try {
                const response = await fetch('/api/warnings/timeline-simple');
                const data = await response.json();
                
                const ctx = document.getElementById('timelineChartCanvas');
                if (!ctx) return;
                
                // éŠ·æ¯€ç¾æœ‰åœ–è¡¨
                if (timelineChart) {
                    timelineChart.destroy();
                }
                
                timelineChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'è­¦å‘Šæ¬¡æ•¸',
                            data: data.data,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: '#667eea',
                                borderWidth: 1,
                                cornerRadius: 8,
                                displayColors: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    color: '#666'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    color: '#666'
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('âŒ è¼‰å…¥æ™‚é–“è»¸åœ–è¡¨å¤±æ•—:', error);
                APIUtils.showToast('æ™‚é–“è»¸åœ–è¡¨è¼‰å…¥å¤±æ•—', 'warning', 3000);
                document.getElementById('warningTimelineChart').innerHTML = '<div style="text-align: center; color: #999; padding: 50px;">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦</div>';
            }
        }

        // è¼‰å…¥é¡åˆ¥åˆ†å¸ƒåœ–è¡¨
        async function loadCategoryChart() {
            try {
                const data = await APIUtils.fetchAPI('/api/warnings/category-simple');
                
                const ctx = document.getElementById('categoryChartCanvas');
                if (!ctx) return;
                
                // éŠ·æ¯€ç¾æœ‰åœ–è¡¨
                if (categoryChart) {
                    categoryChart.destroy();
                }
                
                categoryChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            data: data.data,
                            backgroundColor: [
                                '#FF6B6B',
                                '#4ECDC4', 
                                '#45B7D1',
                                '#FFA07A',
                                '#98D8C8',
                                '#F7DC6F',
                                '#BB8FCE',
                                '#85C1E9'
                            ],
                            borderWidth: 0,
                            hoverBorderWidth: 2,
                            hoverBorderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#333',
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: '#667eea',
                                borderWidth: 1,
                                cornerRadius: 8,
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return `${context.label}: ${context.parsed} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('âŒ è¼‰å…¥é¡åˆ¥åˆ†å¸ƒåœ–è¡¨å¤±æ•—:', error);
                APIUtils.showToast('é¡åˆ¥åˆ†å¸ƒåœ–è¡¨è¼‰å…¥å¤±æ•—', 'warning', 3000);
                document.getElementById('warningCategoryChart').innerHTML = '<div style="text-align: center; color: #999; padding: 50px;">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦</div>';
            }
        }

        // æ¯ç§’æ›´æ–°æ™‚é–“
        setInterval(updateCurrentTime, 1000);
        
        // é é¢è¼‰å…¥æ™‚ç«‹å³æ›´æ–°æ™‚é–“å’Œåˆå§‹åŒ–ç‹€æ…‹
        updateCurrentTime();
        
        // ==================== é é¢åˆå§‹åŒ– ====================
        // ä¸¦è¡Œè¼‰å…¥å„ªåŒ–ç‰ˆæœ¬ - æ‰€æœ‰APIåŒæ™‚è¼‰å…¥
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ é–‹å§‹ä¸¦è¡Œè¼‰å…¥é é¢æ•¸æ“š...');
            const startTime = performance.now();
            
            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            APIUtils.showGlobalLoading('æ­£åœ¨è¼‰å…¥ç‡’å¤©é æ¸¬ç³»çµ±...');
            
            try {
                // ğŸŒ… è‡ªå‹•æ ¹æ“šæ™‚é–“è¨­ç½®é æ¸¬é¡å‹ï¼ˆæ—¥è½å¾Œè‡ªå‹•åˆ‡æ›åˆ°æ—¥å‡ºï¼‰
                initAutoPredictionType();
                
                // åˆå§‹åŒ–å€å¡Šç‹€æ…‹ï¼ˆåŒæ­¥æ“ä½œï¼Œä¸è€—æ™‚ï¼‰
                initializeFactorsSection();
                initializeScoreReferenceSection();
                
                // ä¸¦è¡Œè¼‰å…¥æ‰€æœ‰æ•¸æ“š
                const requests = [
                    { name: 'ä¸»é æ¸¬æ•¸æ“š', fn: () => loadPrediction() },
                    { name: 'ç…§ç‰‡æ¡ˆä¾‹æ•¸é‡', fn: () => loadPhotoCasesCount() }
                ];
                
                APIUtils.updateLoadingProgress(0, requests.length);
                
                // ä½¿ç”¨ Promise.allSettled ç¢ºä¿æ‰€æœ‰è«‹æ±‚éƒ½å®Œæˆï¼ˆå³ä½¿éƒ¨åˆ†å¤±æ•—ï¼‰
                const results = await Promise.allSettled(
                    requests.map((req, index) => {
                        return req.fn().then(result => {
                            APIUtils.updateLoadingProgress(index + 1, requests.length);
                            console.log(`âœ… ${req.name} è¼‰å…¥å®Œæˆ`);
                            return result;
                        });
                    })
                );
                
                // çµ±è¨ˆçµæœ
                const successCount = results.filter(r => r.status === 'fulfilled').length;
                const failCount = results.length - successCount;
                
                const endTime = performance.now();
                const loadTime = ((endTime - startTime) / 1000).toFixed(2);
                
                console.log(`ğŸ‰ é é¢è¼‰å…¥å®Œæˆï¼è€—æ™‚ ${loadTime}ç§’ (æˆåŠŸ: ${successCount}, å¤±æ•—: ${failCount})`);
                
                // é¡¯ç¤ºæˆåŠŸæç¤º
                if (failCount === 0) {
                    APIUtils.showToast(`é é¢è¼‰å…¥æˆåŠŸ (${loadTime}ç§’)`, 'success', 3000);
                } else {
                    APIUtils.showToast(`é é¢éƒ¨åˆ†è¼‰å…¥æˆåŠŸ (${failCount}å€‹è«‹æ±‚å¤±æ•—)`, 'warning', 4000);
                }
                
                // è™•ç†å¤±æ•—çš„è«‹æ±‚
                results.forEach((result, index) => {
                    if (result.status === 'rejected') {
                        console.error(`âŒ ${requests[index].name} è¼‰å…¥å¤±æ•—:`, result.reason);
                    }
                });
                
            } catch (error) {
                console.error('âŒ é é¢åˆå§‹åŒ–éŒ¯èª¤:', error);
                APIUtils.showToast('é é¢è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error', 8000);
            } finally {
                // éš±è—è¼‰å…¥ç‹€æ…‹
                APIUtils.hideGlobalLoading();
            }
        });
        
        // æ¯5åˆ†é˜è‡ªå‹•æ›´æ–°ï¼ˆåŒæ¨£ä¸¦è¡Œè¼‰å…¥ï¼‰
        setInterval(async () => {
            console.log('ğŸ”„ è‡ªå‹•æ›´æ–°é æ¸¬æ•¸æ“š...');
            try {
                // ğŸŒ… æ¯æ¬¡æ›´æ–°æ™‚ä¹Ÿæª¢æŸ¥æ˜¯å¦éœ€è¦åˆ‡æ›é æ¸¬é¡å‹
                initAutoPredictionType();
                
                await Promise.allSettled([
                    loadPrediction(),
                    loadPhotoCasesCount()
                ]);
            } catch (error) {
                console.error('è‡ªå‹•æ›´æ–°å¤±æ•—:', error);
            }
        }, 300000);
    </script>
</body>
</html>
