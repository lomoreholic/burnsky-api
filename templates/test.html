<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‡’å¤©é æ¸¬æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #loading { display: block; color: blue; }
        #content { display: none; }
        button { padding: 10px 20px; margin: 10px; }
    </style>
</head>
<body>
    <h1>ç‡’å¤©é æ¸¬ç³»çµ±æ¸¬è©¦</h1>
    
    <div id="loading">è¼‰å…¥ä¸­...</div>
    
    <div id="content">
        <h2>é æ¸¬çµæœ</h2>
        <p>ç‡’å¤©æŒ‡æ•¸: <span id="scoreNumber">-</span></p>
        <p>é æ¸¬ç­‰ç´š: <span id="predictionLevel">-</span></p>
        <p>æ©Ÿç‡: <span id="probability">-</span></p>
        
        <button onclick="loadPrediction()">ğŸ”„ é‡æ–°é æ¸¬</button>
        <button onclick="testAPI()">ğŸ§ª æ¸¬è©¦API</button>
    </div>

    <div id="debug"></div>

    <script>
        async function testAPI() {
            const debug = document.getElementById('debug');
            debug.innerHTML = 'æ¸¬è©¦APIä¸­...';
            
            try {
                const response = await fetch('/predict/sunset?advance_hours=2');
                const data = await response.json();
                debug.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                debug.innerHTML = `éŒ¯èª¤: ${error.message}`;
            }
        }

        async function loadPrediction() {
            const loading = document.getElementById('loading');
            const content = document.getElementById('content');
            const debug = document.getElementById('debug');
            
            loading.style.display = 'block';
            content.style.display = 'none';
            debug.innerHTML = 'é–‹å§‹è¼‰å…¥é æ¸¬...';
            
            try {
                const apiUrl = `/predict/sunset?advance_hours=2&_=${Date.now()}`;
                debug.innerHTML += `<br>API URL: ${apiUrl}`;
                
                const response = await fetch(apiUrl, {
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });
                
                debug.innerHTML += `<br>Response status: ${response.status}`;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                debug.innerHTML += `<br>Data received: ${JSON.stringify(data).substring(0, 100)}...`;
                
                // æ›´æ–°ç‡’å¤©æŒ‡æ•¸
                document.getElementById('scoreNumber').textContent = Math.round(data.burnsky_score || data.score || 0);
                
                // æ›´æ–°é æ¸¬ç­‰ç´š
                document.getElementById('predictionLevel').textContent = data.prediction_level || data.level || 'æœªçŸ¥';
                
                // æ›´æ–°æ©Ÿç‡
                document.getElementById('probability').textContent = data.probability || 'æœªçŸ¥';
                
                loading.style.display = 'none';
                content.style.display = 'block';
                debug.innerHTML += '<br>âœ… è¼‰å…¥æˆåŠŸï¼';
                
            } catch (error) {
                debug.innerHTML += `<br>âŒ éŒ¯èª¤: ${error.message}`;
                loading.innerHTML = `
                    <div style="color: #ff6b6b;">
                        <h3>è¼‰å…¥å¤±æ•—</h3>
                        <p>ç„¡æ³•å–å¾—é æ¸¬æ•¸æ“šï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥æˆ–ç¨å¾Œå†è©¦</p>
                        <button onclick="loadPrediction()" style="margin-top: 15px;">ğŸ”„ é‡æ–°è¼‰å…¥</button>
                    </div>
                `;
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            loadPrediction();
        });
    </script>
</body>
</html>
