<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>燒天機器學習預測測試 - 燒天預測系統</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <style>
            <na    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-row">
                <a href="/">🏠 首頁</a>
                <a href="/photo-analysis">📸 照片分析</a>
                <a href="/warning-dashboard">⚠️ 警告台</a>
                <a href="/ml-test">🤖 ML測試</a>
                <a href="/api-docs">📚 API 文檔</a>
                <a href="/photography-guide">📸 攝影指南</a>
            </div>
            <div class="nav-row">
                <a href="/best-locations">📍 最佳地點</a>
                <a href="/faq">❓ FAQ</a>
                <a href="/weather-terms">📚 天氣術語</a>
                <a href="/terms">📄 條款</a>
                <a href="/privacy">🔒 私隱</a>
            </div>
        </div>
    </nav>tainer">
        <div class="glass-card">        <div class="nav-container">
            <div class="nav-row">
                <a href="/">🏠 首頁</a>
                <a href="/photo-analysis">📸 照片分析</a>
                <a href="/warning-dashboard">⚠️ 警告台</a>
                <a href="/ml-test">🤖 ML測試</a>
                <a href="/api-docs">📚 API 文檔</a>
                <a href="/photography-guide">📸 攝影指南</a>
            </div>
            <div class="nav-row">
                <a href="/best-locations">📍 最佳地點</a>
                <a href="/faq">❓ FAQ</a>
                <a href="/weather-terms">📚 天氣術語</a>
                <a href="/terms">📄 條款</a>
                <a href="/privacy">🔒 私隱</a>
            </div>
        </div>
    </nav> --primary-color: #FF6B35;
            --secondary-color: #004E89;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-light: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-light);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-light);
        }

        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            backdrop-filter: blur(5px);
        }

        .form-group select option {
            background: #2c3e50;
            color: white;
        }

        .btn {
            background: linear-gradient(45deg, var(--primary-color), #FF8E53);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .result {
            margin-top: 30px;
            display: none;
        }

        .result.show {
            display: block;
        }

        .prediction-score {
            text-align: center;
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
        }

        .prediction-possibility {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .ml-info {
            background: rgba(0, 123, 255, 0.1);
            border-left: 4px solid #007bff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .recommendations {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .recommendations ul {
            list-style: none;
            padding-left: 0;
        }

        .recommendations li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .recommendations li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }

        .feature-importance {
            background: rgba(108, 117, 125, 0.1);
            border-left: 4px solid #6c757d;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .feature-bar {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }

        .feature-name {
            width: 150px;
            font-size: 14px;
        }

        .feature-progress {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 0 10px;
            overflow: hidden;
        }

        .feature-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, var(--primary-color), #FF8E53);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .feature-value {
            width: 50px;
            text-align: right;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .glass-card {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .prediction-score {
                font-size: 2em;
            }
        }
        
        /* 頂部導航樣式 */
        .top-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        }

        .nav-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 5px;
        }

        .nav-row:last-child {
            margin-bottom: 0;
        }

        .nav-row a {
            color: #333;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .nav-row a:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .nav-row {
                flex-wrap: wrap;
                gap: 10px;
            }

            .nav-row a {
                font-size: 12px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-row">
                <a href="/" class="nav-link">📊 即時數據</a>
                <a href="/history" class="nav-link">� 歷史趨勢</a>
                <a href="/warning" class="nav-link">⚠️ 警告台</a>
            </div>
            <div class="nav-row">
                <a href="/photo_analysis" class="nav-link">� 照片分析</a>
                <a href="/best_locations" class="nav-link">🏔️ 最佳位置</a>
                <a href="/photography_guide" class="nav-link">� 攝影指南</a>
            </div>
            <div class="nav-row">
                <a href="/weather_terms" class="nav-link">🌤️ 天氣術語</a>
                <a href="/faq" class="nav-link">❓ 常見問答</a>
                <a href="/api_docs" class="nav-link">📚 API 文檔</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="glass-card">
            <h1 style="text-align: center; margin-bottom: 30px; font-size: 2.5em;">
                🤖 燒天機器學習預測測試
            </h1>
            
            <div style="text-align: center; margin-bottom: 30px; opacity: 0.9;">
                <p>使用先進的機器學習算法，結合歷史案例和實時天氣數據，提供更精準的燒天預測</p>
            </div>

            <form id="mlTestForm">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="form-group">
                        <label for="cloud_coverage">☁️ 雲量覆蓋</label>
                        <select id="cloud_coverage" name="cloud_coverage" required>
                            <option value="">請選擇雲量條件</option>
                            <option value="晴朗">晴朗</option>
                            <option value="少雲">少雲</option>
                            <option value="適中" selected>適中</option>
                            <option value="適宜">適宜</option>
                            <option value="多雲">多雲</option>
                            <option value="較厚">較厚</option>
                            <option value="陰天">陰天</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="visibility">👁️ 能見度</label>
                        <select id="visibility" name="visibility" required>
                            <option value="">請選擇能見度</option>
                            <option value="極差">極差</option>
                            <option value="差">差</option>
                            <option value="一般">一般</option>
                            <option value="良好" selected>良好</option>
                            <option value="極佳">極佳</option>
                            <option value="完美">完美</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="humidity">💧 濕度</label>
                        <select id="humidity" name="humidity" required>
                            <option value="">請選擇濕度條件</option>
                            <option value="低">低</option>
                            <option value="中等" selected>中等</option>
                            <option value="較高">較高</option>
                            <option value="高">高</option>
                            <option value="極高">極高</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="temperature">🌡️ 溫度</label>
                        <select id="temperature" name="temperature" required>
                            <option value="">請選擇溫度條件</option>
                            <option value="冬季溫度">冬季溫度</option>
                            <option value="春季溫度">春季溫度</option>
                            <option value="夏季溫度" selected>夏季溫度</option>
                            <option value="秋季溫度">秋季溫度</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="wind">💨 風力</label>
                        <select id="wind" name="wind" required>
                            <option value="">請選擇風力條件</option>
                            <option value="無風">無風</option>
                            <option value="輕微" selected>輕微</option>
                            <option value="微風">微風</option>
                            <option value="適中">適中</option>
                            <option value="強風">強風</option>
                            <option value="暴風">暴風</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="air_quality">🌫️ 空氣質量</label>
                        <select id="air_quality" name="air_quality" required>
                            <option value="">請選擇空氣質量</option>
                            <option value="極佳">極佳</option>
                            <option value="良好" selected>良好</option>
                            <option value="一般">一般</option>
                            <option value="差">差</option>
                            <option value="很差">很差</option>
                            <option value="城市環境">城市環境</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn" style="margin-top: 30px;">
                    🔮 開始ML預測分析
                </button>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>機器學習模型正在分析中...</p>
            </div>

            <div class="result" id="result">
                <h2 style="text-align: center; margin-bottom: 20px;">📊 AI預測結果</h2>
                
                <div class="prediction-score" id="score" style="color: #FF6644;"></div>
                <div class="prediction-possibility" id="possibility"></div>
                
                <div class="ml-info" id="mlInfo">
                    <h4>🤖 機器學習信息</h4>
                    <p id="mlDetails"></p>
                    <p><strong>預測方法:</strong> <span id="predictionMethod"></span></p>
                    <p><strong>相似案例數量:</strong> <span id="similarCases"></span></p>
                </div>

                <div class="recommendations" id="recommendations">
                    <h4>💡 智能建議</h4>
                    <ul id="recommendationList"></ul>
                </div>

                <div class="feature-importance" id="featureImportance">
                    <h4>📈 特徵重要性分析</h4>
                    <div id="featureList"></div>
                </div>

                <button class="btn" onclick="testAnotherCondition()" style="margin-top: 20px;">
                    🔄 測試其他條件
                </button>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('mlTestForm');
        const loading = document.getElementById('loading');
        const result = document.getElementById('result');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // 顯示載入動畫
            loading.classList.add('show');
            result.classList.remove('show');
            
            // 收集表單數據
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            try {
                const response = await fetch('/api/ml-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result_data = await response.json();
                
                if (result_data.status === 'success') {
                    displayResult(result_data.analysis);
                } else {
                    alert('預測失敗: ' + result_data.message);
                }
            } catch (error) {
                alert('網絡錯誤: ' + error.message);
            } finally {
                loading.classList.remove('show');
            }
        });

        function displayResult(analysis) {
            // 顯示分數和可能性
            document.getElementById('score').textContent = analysis.combined_score + '/10';
            document.getElementById('score').style.color = analysis.color;
            document.getElementById('possibility').textContent = analysis.possibility;
            
            // ML信息
            document.getElementById('mlDetails').textContent = analysis.ml_info;
            document.getElementById('predictionMethod').textContent = analysis.prediction_method;
            document.getElementById('similarCases').textContent = analysis.similar_cases_count;
            
            // 建議
            const recommendationList = document.getElementById('recommendationList');
            recommendationList.innerHTML = '';
            analysis.recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                recommendationList.appendChild(li);
            });
            
            // 特徵重要性
            const featureList = document.getElementById('featureList');
            featureList.innerHTML = '';
            
            if (analysis.analysis_details.feature_importance) {
                const features = analysis.analysis_details.feature_importance;
                const featureNames = {
                    'hour': '時間',
                    'cloud_coverage_num': '雲量',
                    'visibility_num': '能見度',
                    'humidity_num': '濕度',
                    'temperature_num': '溫度',
                    'wind_num': '風力',
                    'air_quality_num': '空氣質量',
                    'season_num': '季節'
                };
                
                Object.entries(features).forEach(([key, value]) => {
                    const featureDiv = document.createElement('div');
                    featureDiv.className = 'feature-bar';
                    
                    const percentage = (value * 100).toFixed(1);
                    
                    featureDiv.innerHTML = `
                        <div class="feature-name">${featureNames[key] || key}</div>
                        <div class="feature-progress">
                            <div class="feature-progress-bar" style="width: ${percentage}%"></div>
                        </div>
                        <div class="feature-value">${percentage}%</div>
                    `;
                    
                    featureList.appendChild(featureDiv);
                });
            }
            
            result.classList.add('show');
        }

        function testAnotherCondition() {
            result.classList.remove('show');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
