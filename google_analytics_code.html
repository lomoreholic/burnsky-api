<!-- Google Analytics 集成代碼 -->
<!-- 將此代碼添加到 templates/index.html, privacy.html, terms.html 的 <head> 部分 -->

<!-- Google tag (gtag.js) - GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'GA_MEASUREMENT_ID', {
    // 基本配置
    'page_title': document.title,
    'page_location': window.location.href,
    'language': 'zh-TW',
    
    // 隱私設置
    'anonymize_ip': true,
    'cookie_flags': 'secure;samesite=lax',
    
    // 自定義維度 (可選)
    'custom_map': {
      'dimension1': 'prediction_type',
      'dimension2': 'burnsky_score'
    }
  });

  // 自定義事件追蹤
  
  // 燒天預測事件
  function trackPrediction(type, score) {
    gtag('event', 'burnsky_prediction', {
      'event_category': 'Prediction',
      'event_label': type,
      'value': score,
      'custom_parameters': {
        'prediction_type': type,
        'burnsky_score': score
      }
    });
  }

  // 頁面互動事件
  function trackInteraction(action, element) {
    gtag('event', 'user_interaction', {
      'event_category': 'Engagement',
      'event_label': element,
      'custom_parameters': {
        'interaction_type': action
      }
    });
  }

  // API 調用事件
  function trackAPICall(endpoint, success) {
    gtag('event', 'api_call', {
      'event_category': 'API',
      'event_label': endpoint,
      'value': success ? 1 : 0,
      'custom_parameters': {
        'api_endpoint': endpoint,
        'call_success': success
      }
    });
  }

  // 錯誤追蹤
  window.addEventListener('error', function(e) {
    gtag('event', 'javascript_error', {
      'event_category': 'Error',
      'event_label': e.message,
      'custom_parameters': {
        'error_message': e.message,
        'error_source': e.filename,
        'error_line': e.lineno
      }
    });
  });

  // 性能追蹤
  window.addEventListener('load', function() {
    // 計算頁面載入時間
    const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
    
    gtag('event', 'page_load_time', {
      'event_category': 'Performance',
      'value': Math.round(loadTime),
      'custom_parameters': {
        'load_time_ms': loadTime
      }
    });
  });
</script>

<!-- Google AdSense 自動廣告 (可選) -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3552699426860096"
     crossorigin="anonymous"></script>

<!-- Facebook Pixel (可選) -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');

fbq('init', 'YOUR_FACEBOOK_PIXEL_ID');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=YOUR_FACEBOOK_PIXEL_ID&ev=PageView&noscript=1"
/></noscript>
